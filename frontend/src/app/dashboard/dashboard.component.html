<div class="dashboard-container">
  <div class="p-6 dashboard-grid relative z-10">
    <!-- Loading State -->
    <table *ngIf="isLoading" class="w-full border-collapse">
      <tr>
        <td colspan="3" class="text-center py-24">
          <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-xl font-medium">Lade Statistiken...</p>
          </div>
        </td>
      </tr>
    </table>

    <!-- Error State -->
    <table *ngIf="hasError && !isLoading" class="w-full border-collapse">
      <tr>
        <td colspan="3" class="text-center py-24">
          <div class="error-message max-w-md mx-auto">
            <h3 class="text-xl font-bold mb-2">Fehler beim Laden</h3>
            <p class="mb-4">{{ errorMessage }}</p>
            <button (click)="refreshStats()" class="refresh-button">
              Erneut versuchen
            </button>
          </div>
        </td>
      </tr>
    </table>

    <!-- Main Content -->
    <table
      *ngIf="!isLoading && !hasError"
      class="w-full border-collapse dashboard-table"
    >
      <tr>
        <!-- Stats Overview (spans 2 columns) -->
        <td colspan="2" rowspan="1" class="stats-overview align-top p-2">
          <div class="stats-card p-6 rounded-2xl auto-height">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
              <!-- Kills -->
              <div
                class="stat-item"
                style="--stat-color: #10b981; --stat-color-light: #34d399"
              >
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">Absch√ºsse</h5>
                  <p class="stat-value m-0">
                    {{ userStatistics.kills | number: '1.0-0' }}
                  </p>
                </div>
              </div>

              <!-- Deaths -->
              <div
                class="stat-item"
                style="--stat-color: #3b82f6; --stat-color-light: #60a5fa"
              >
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">Todesf√§lle</h5>
                  <p class="stat-value m-0">
                    {{ userStatistics.deaths | number: '1.0-0' }}
                  </p>
                </div>
              </div>

              <!-- Playtime -->
              <div
                class="stat-item"
                style="--stat-color: #eab308; --stat-color-light: #facc15"
              >
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">Spielzeit</h5>
                  <p class="stat-value m-0">
                    {{ playtimeFormatted }}
                  </p>
                </div>
              </div>
              <!-- K/D Ratio -->
              <div
                class="stat-item"
                style="--stat-color: #8b5cf6; --stat-color-light: #a78bfa"
              >
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">K/D Ratio</h5>
                  <p class="stat-value m-0">
                    {{ kdRatio }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </td>

        <!-- Player Card -->
        <td rowspan="2" class="player-card-container align-top p-2">
          <div class="player-card">
            <!-- Avatar Header -->
            <div
              class="player-avatar-container"
              *ngIf="userStatistics?.avatarFull"
            >
              <img
                class="player-avatar"
                [src]="getAvatarUrl(userStatistics.avatarFull)"
                [alt]="userStatistics.username || 'Player Avatar'"
                loading="lazy"
                (error)="onImageError($event)"
              />
            </div>

            <!-- Player Info -->
            <div class="p-6">
              <h2 class="text-2xl font-bold text-white mb-2 cardHeader">
                Willkommen zur√ºck,<br />
                <span class="text-gradient">{{
                  userStatistics.username || 'Spieler'
                }}</span>
              </h2>

              <p class="text-lg text-gray-300 mb-6">
                {{ leaderboardText }}
              </p>

              <!-- Stats List -->
              <div class="space-y-3">
                <div class="player-info-item">
                  <span class="player-info-label">Gespielte Runden:</span>
                  <span class="player-info-value">{{
                    userStatistics.roundsplayed | number: '1.0-0'
                  }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Spielzeit:</span>
                  <span class="player-info-value">{{ playtimeFormatted }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Benutzte Medkits:</span>
                  <span class="player-info-value">{{
                    userStatistics.usedmedkits | number: '1.0-0'
                  }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Getrunkene Colas:</span>
                  <span class="player-info-value">{{
                    userStatistics.usedcolas | number: '1.0-0'
                  }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Pocket Escapes:</span>
                  <span class="player-info-value">{{
                    userStatistics.pocketescapes | number: '1.0-0'
                  }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Benutzte Adrenalin:</span>
                  <span class="player-info-value">{{
                    userStatistics.usedadrenaline | number: '1.0-0'
                  }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Snake Highscore:</span>
                  <span class="player-info-value">{{
                    userStatistics.snakehighscore | number: '1.0-0'
                  }}</span>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <!-- ZV Coins Widget -->
        <td colspan="2" class="zvcoins-container align-top p-2">
          <div class="stats-card p-6 rounded-2xl">
            <h3
              class="text-xl font-bold text-white mb-4 cardHeader flex items-center justify-between"
            >
              <span>ü™ô Zeitvertreib Coins</span>
              <span class="zvcoins-balance-inline">
                {{ userStatistics.experience | number: '1.0-0' }} ZVC
              </span>
            </h3>

            <!-- Code Redemption and Transfer Combined -->
            <div class="zvcoins-balance-code-section mb-6">
              <div class="zvcoins-combined-card">
                <!-- Code Redemption Area -->
                <div class="zvcoins-code-area">
                  <div class="zvcoins-code-header">
                    <div class="zvcoins-code-icon">üé´</div>
                    <div class="zvcoins-code-info">
                      <p class="zvcoins-code-label">Code einl√∂sen</p>
                    </div>
                  </div>

                  <!-- Code Info Tip -->
                  <div class="zvcoins-code-tip">
                    <div class="code-tip-icon">üí°</div>
                    <div class="code-tip-text">
                      Codes kannst du auf unserem
                      <strong>Discord-Server</strong> oder bei speziellen Events
                      gewinnen!!
                    </div>
                  </div>

                  <div class="zvcoins-code-input-section">
                    <div class="zvcoins-code-input-group">
                      <input
                        type="text"
                        [(ngModel)]="redeemCode"
                        placeholder="Gib deinen Code hier ein..."
                        class="zvcoins-code-input"
                        (keyup.enter)="redeemCodeAction()"
                        [disabled]="codeRedemptionLoading"
                      />
                      <button
                        class="zvcoins-code-btn"
                        (click)="redeemCodeAction()"
                        [disabled]="!redeemCode || codeRedemptionLoading"
                      >
                        <span *ngIf="!codeRedemptionLoading">üéÅ Einl√∂sen</span>
                        <span *ngIf="codeRedemptionLoading"
                          >‚è≥ Wird eingel√∂st...</span
                        >
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Vertical Divider -->
                <div class="zvcoins-divider"></div>

                <!-- ZVC Transfer Area -->
                <div class="zvcoins-transfer-area">
                  <div class="zvcoins-transfer-header">
                    <div class="zvcoins-transfer-icon">üí∏</div>
                    <div class="zvcoins-transfer-info">
                      <p class="zvcoins-transfer-label">
                        Zeitvertreib Coins senden
                      </p>
                    </div>
                  </div>

                  <!-- Transaction Tax Disclaimer -->
                  <div class="zvcoins-transfer-disclaimer">
                    <div class="transfer-disclaimer-icon">‚ö†Ô∏è</div>
                    <div class="transfer-disclaimer-text">
                      <strong>Transaktionsgeb√ºhr:</strong> Auf jede Transaktion
                      wird eine 10% Steuer erhoben.
                      <strong>Mindestbetrag:</strong> 100 ZVC.
                    </div>
                  </div>

                  <!-- Transfer Cost Info -->
                  <div
                    *ngIf="transferAmount && transferAmount > 0"
                    class="zvcoins-transfer-cost-info"
                  >
                    <div class="transfer-cost-item">
                      <span class="cost-label">Betrag:</span>
                      <span class="cost-value">{{ transferAmount }} ZVC</span>
                    </div>
                    <div class="transfer-cost-item">
                      <span class="cost-label">Steuer (10%):</span>
                      <span class="cost-value"
                        >{{ getTransferTax(transferAmount) }} ZVC</span
                      >
                    </div>
                    <div class="transfer-cost-item transfer-cost-total">
                      <span class="cost-label">Gesamt:</span>
                      <span class="cost-value"
                        >{{ getTransferTotalCost(transferAmount) }} ZVC</span
                      >
                    </div>
                  </div>

                  <div class="zvcoins-transfer-input-section">
                    <div class="zvcoins-transfer-input-group">
                      <input
                        type="text"
                        [(ngModel)]="transferRecipient"
                        placeholder="Steam ID oder Benutzername"
                        class="zvcoins-transfer-input zvcoins-transfer-recipient"
                        [disabled]="transferLoading"
                      />
                      <input
                        type="text"
                        [(ngModel)]="transferAmount"
                        placeholder="Betrag"
                        class="zvcoins-transfer-input zvcoins-transfer-amount"
                        [disabled]="transferLoading"
                      />
                      <button
                        class="zvcoins-transfer-btn"
                        (click)="transferZVC()"
                        [disabled]="
                          !transferRecipient ||
                          !transferAmount ||
                          transferAmount <= 0 ||
                          transferAmount < 100 ||
                          transferAmount > 50000 ||
                          getTransferTotalCost(transferAmount) >
                            (userStatistics.experience || 0) ||
                          transferLoading
                        "
                      >
                        <span *ngIf="!transferLoading">üí∏ Senden</span>
                        <span *ngIf="transferLoading">‚è≥ Wird gesendet...</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Message displays outside the card for better visibility -->
              <div
                *ngIf="codeRedemptionMessage"
                class="zvcoins-message mt-3"
                [class.success]="codeRedemptionSuccess"
                [class.error]="!codeRedemptionSuccess"
              >
                {{ codeRedemptionMessage }}
              </div>
              <div
                *ngIf="transferMessage"
                class="zvcoins-message mt-3"
                [class.success]="transferSuccess"
                [class.error]="!transferSuccess"
              >
                {{ transferMessage }}
              </div>
            </div>

            <!-- Redeemable Items -->
            <div class="zvcoins-rewards-section mb-4">
              <h4 class="zvcoins-section-title">üéÅ Belohnungen einl√∂sen</h4>

              <!-- Loading State -->
              <div *ngIf="redeemablesLoading" class="text-center py-8">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-lg text-white">Lade Belohnungen...</p>
              </div>

              <!-- Error State -->
              <div
                *ngIf="redeemablesError && !redeemablesLoading"
                class="text-center py-8"
              >
                <div class="text-red-400 mb-4">‚ö†Ô∏è</div>
                <p class="text-red-400">{{ redeemablesError }}</p>
                <button
                  (click)="loadRedeemables()"
                  class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
                >
                  Erneut versuchen
                </button>
              </div>

              <!-- Redeemables Grid -->
              <div
                *ngIf="!redeemablesLoading && !redeemablesError"
                class="zvcoins-rewards-grid"
              >
                <div
                  *ngFor="let redeemable of redeemables"
                  class="zvcoins-reward-card"
                  [class.zvcoins-affordable]="
                    canAfford(redeemable.price) && isAvailable(redeemable)
                  "
                  [class.zvcoins-limited-time]="isLimitedTime(redeemable)"
                  [class.zvcoins-expired]="isExpired(redeemable)"
                  [class.zvcoins-sold-out]="isSoldOut(redeemable)"
                >
                  <!-- Limited Time Badge -->
                  <div
                    *ngIf="
                      isLimitedTime(redeemable) &&
                      !isExpired(redeemable) &&
                      !isSoldOut(redeemable)
                    "
                    class="zvcoins-limited-badge"
                  >
                    ‚è∞ Limitiert: {{ getTimeLeft(redeemable.redeemableuntil) }}
                  </div>

                  <!-- Expired Badge -->
                  <div
                    *ngIf="isExpired(redeemable)"
                    class="zvcoins-expired-badge"
                  >
                    ‚ùå Nicht mehr verf√ºgbar
                  </div>

                  <!-- Sold Out Badge -->
                  <div
                    *ngIf="isSoldOut(redeemable)"
                    class="zvcoins-sold-out-badge"
                  >
                    üö´ Ausverkauft
                  </div>

                  <div class="zvcoins-reward-header">
                    <div class="zvcoins-reward-icon-large">
                      {{ redeemable.emoji }}
                    </div>
                    <div class="zvcoins-reward-details">
                      <h5 class="zvcoins-reward-title">
                        {{ redeemable.name }}
                      </h5>
                      <p class="zvcoins-reward-description">
                        {{ redeemable.description }}
                      </p>
                    </div>
                    <div class="zvcoins-reward-price">
                      <span class="zvcoins-price-amount">{{
                        redeemable.price | number: '1.0-0'
                      }}</span>
                      <span class="zvcoins-price-currency">ZVC</span>
                    </div>
                  </div>
                  <div class="zvcoins-reward-progress">
                    <div class="zvcoins-progress-container">
                      <div class="zvcoins-progress-track">
                        <div
                          class="zvcoins-progress-bar-fill"
                          [style.width.%]="
                            getProgressPercentage(
                              userStatistics.experience || 0,
                              redeemable.price
                            )
                          "
                        ></div>
                      </div>
                      <span class="zvcoins-progress-text">
                        {{
                          getProgressPercentage(
                            userStatistics.experience || 0,
                            redeemable.price
                          ) | number: '1.0-0'
                        }}%
                      </span>
                    </div>
                    <button
                      class="zvcoins-redeem-btn"
                      [disabled]="!canRedeem(redeemable)"
                      [class.zvcoins-redeem-available]="canRedeem(redeemable)"
                      [class.zvcoins-expired]="isExpired(redeemable)"
                      [class.zvcoins-sold-out]="isSoldOut(redeemable)"
                      (click)="redeemItem(redeemable)"
                    >
                      {{ getAvailabilityText(redeemable) }}
                    </button>
                  </div>
                </div>

                <!-- No redeemables available message -->
                <div
                  *ngIf="redeemables.length === 0"
                  class="text-center py-8 col-span-full"
                >
                  <div class="text-6xl mb-4">üéÅ</div>
                  <p class="text-lg text-gray-300">
                    Keine Belohnungen verf√ºgbar
                  </p>
                  <p class="text-sm text-gray-400 mt-2">
                    Schau sp√§ter wieder vorbei!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr></tr>
      <tr>
        <!-- Custom Spray Card -->
        <td rowspan="2" colspan="1" class="spray-card-container align-top p-2">
          <div class="stats-card p-6 rounded-2xl auto-height">
            <!-- Help Popup (replaces entire card content when shown) -->
            <div *ngIf="showSprayHelp" class="help-popup h-full">
              <div class="help-content h-full">
                <div class="help-title">
                  Custom Spray - Dein pers√∂nliches Zeichen! üé®
                </div>
                <div class="help-text">
                  Mit einem Custom Spray kannst du dein eigenes Bild als
                  pers√∂nliches Zeichen im Spiel verwenden.
                </div>
                <div class="help-text">
                  <strong>Wie funktioniert es?</strong><br />
                  ‚Ä¢ Lade ein beliebiges Bild oder GIF hoch<br />
                  ‚Ä¢ PNG/JPG bis 10MB, GIFs bis 2MB (max. 20 Frames)<br />
                  ‚Ä¢ Das Bild wird automatisch optimiert und ins Spiel
                  √ºbertragen<br />
                  ‚Ä¢ Nutze es, um W√§nde oder Oberfl√§chen zu markieren
                </div>
                <div class="help-text">
                  <strong>Tipp:</strong> Einfache Designs und klare Formen
                  funktionieren am besten! GIFs werden animiert dargestellt.
                </div>
                <button (click)="showSprayHelp = false" class="help-close-btn">
                  Verstanden! ‚ú®
                </button>
              </div>
            </div>

            <!-- Regular Card Content -->
            <div *ngIf="!showSprayHelp">
              <h3
                class="text-xl font-bold text-white flex items-center justify-between cardHeader"
              >
                <div class="flex items-center gap-2">
                  üé® <span>Custom Spray</span>
                </div>
                <button
                  (click)="showSprayHelp = true"
                  class="help-button"
                  title="Hilfe anzeigen"
                >
                  ?
                </button>
              </h3>

              <!-- Banned State -->
              <div *ngIf="isSprayBanned" class="fakerank-not-allowed">
                <div class="not-allowed-icon">üö´</div>
                <div class="not-allowed-message">
                  <p class="not-allowed-title">Spray-Uploads gesperrt!</p>
                  <p class="not-allowed-text">
                    Du wurdest von Spray-Uploads ausgeschlossen.
                    <span *ngIf="sprayBanStatus && sprayBanStatus.banReason">
                      <br /><strong>Grund:</strong>
                      {{ sprayBanStatus.banReason }}
                    </span>
                  </p>
                  <p
                    class="not-allowed-link"
                    *ngIf="sprayBanStatus && sprayBanStatus.permanent"
                  >
                    <strong>Diese Sperre ist permanent.</strong>
                  </p>
                  <p
                    class="not-allowed-link"
                    *ngIf="sprayBanStatus && !sprayBanStatus.permanent"
                  >
                    Kontaktiere die Moderation unter
                    <a href="https://dsc.gg/zeit" style="text-decoration: none"
                      ><strong>dsc.gg/zeit</strong></a
                    >
                    f√ºr weitere Informationen.
                  </p>
                </div>
              </div>

              <!-- Normal Spray Functionality (only if not banned) -->
              <div *ngIf="!isSprayBanned">
                <!-- Current Spray Display -->
                <div *ngIf="hasSpray" class="current-spray mb-4 text-center">
                  <div class="spray-preview-container mx-auto relative">
                    <div class="spray-preview">
                      <img
                        [src]="currentSprayImage"
                        alt="Current Spray"
                        class="spray-image"
                      />
                    </div>
                    <button
                      (click)="removeSpray()"
                      class="remove-spray-button"
                      [disabled]="sprayUploadLoading"
                      title="Spray l√∂schen"
                    >
                      √ó
                    </button>
                  </div>
                </div>

                <!-- No Spray State -->
                <div
                  *ngIf="!hasSpray && !selectedFile"
                  class="text-center py-4"
                >
                  <div class="text-4xl mb-2">üé®</div>
                  <p class="text-gray-300 text-sm">Kein Spray hochgeladen</p>
                </div>

                <!-- Upload Section with Drag & Drop -->
                <div class="spray-upload">
                  <div
                    class="upload-area"
                    [class.has-file]="selectedFile && !sprayUploadLoading"
                    [class.loading]="sprayUploadLoading"
                    [class.drag-over]="isDragOver"
                    (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event)"
                  >
                    <input
                      type="file"
                      id="sprayFileInput"
                      accept="image/png,image/jpeg,image/jpg,image/webp"
                      (change)="onFileSelected($event)"
                      class="file-input"
                    />
                    <label for="sprayFileInput" class="upload-label">
                      <div class="upload-content">
                        <div
                          *ngIf="
                            !sprayUploadLoading &&
                            !selectedFile &&
                            !backgroundRemovalProcessing
                          "
                          class="text-center"
                        >
                          <div class="text-2xl mb-2">üìÅ</div>
                          <p class="font-medium">Klicken oder hierher ziehen</p>
                          <p class="text-sm opacity-75">PNG, JPG, WEBP</p>
                          <p
                            class="text-xs opacity-60 mt-1"
                            *ngIf="uploadLimits"
                          >
                            {{ uploadLimits.message }}
                          </p>
                          <p
                            class="text-xs opacity-60 mt-1"
                            *ngIf="!uploadLimits"
                          >
                            Max: 5MB (Bilder)
                          </p>
                        </div>

                        <!-- Original File Preview -->
                        <div
                          *ngIf="
                            selectedFile &&
                            selectedFilePreview &&
                            !sprayUploadLoading &&
                            !backgroundRemovalProcessing
                          "
                          class="text-center"
                        >
                          <div class="file-preview-container mb-2">
                            <div
                              class="preview-wrapper"
                              [class.bg-removed]="processedImagePreview"
                            >
                              <img
                                [src]="
                                  processedImagePreview || selectedFilePreview
                                "
                                alt="Selected Image Preview"
                                class="file-preview-image"
                              />
                              <!-- Subtle glow effect for background removed images -->
                              <div
                                *ngIf="processedImagePreview"
                                class="bg-removed-glow"
                              ></div>
                            </div>
                          </div>
                          <p class="font-medium">{{ selectedFileName }}</p>
                          <div class="preview-status">
                            <p class="text-sm opacity-75">
                              {{
                                processedImagePreview
                                  ? 'Bereit zum Upload'
                                  : 'Bereit zum Upload'
                              }}
                            </p>
                            <!-- Clean status indicator below the image -->
                            <div
                              *ngIf="processedImagePreview"
                              class="bg-removed-status"
                            >
                              <span class="status-icon">‚ú®</span>
                              <span class="status-text"
                                >Hintergrund entfernt</span
                              >
                            </div>
                          </div>
                          <p
                            *ngIf="removeBackground && !processedImagePreview"
                            class="text-xs mt-1 px-2 py-1 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-500/30"
                          >
                            ü™Ñ Hintergrund wird entfernt
                          </p>
                        </div>

                        <div
                          *ngIf="backgroundRemovalProcessing"
                          class="text-center"
                        >
                          <div class="loading-spinner mx-auto mb-2"></div>
                          <p class="font-medium">Entferne Hintergrund...</p>
                          <p class="text-sm opacity-75">
                            Dies kann einen Moment dauern
                          </p>
                        </div>
                        <div *ngIf="sprayUploadLoading" class="text-center">
                          <div class="loading-spinner mx-auto mb-2"></div>
                          <p class="font-medium">Wird hochgeladen...</p>
                        </div>
                      </div>
                    </label>
                  </div>

                  <div
                    *ngIf="selectedFile && !sprayUploadLoading"
                    class="upload-actions mt-3"
                  >
                    <button
                      (click)="uploadSpray()"
                      class="upload-button"
                      [disabled]="backgroundRemovalProcessing"
                      [class.disabled]="backgroundRemovalProcessing"
                    >
                      {{
                        backgroundRemovalProcessing
                          ? 'Wird verarbeitet...'
                          : 'Hochladen'
                      }}
                    </button>
                    <button (click)="clearAllPreviews()" class="cancel-button">
                      Abbrechen
                    </button>
                  </div>
                </div>

                <!-- Background Removal Toggle -->
                <div class="background-removal-toggle mt-4">
                  <div class="toggle-container">
                    <div class="toggle-header">
                      <div class="toggle-info">
                        <div class="toggle-icon">ü™Ñ</div>
                        <div class="toggle-content">
                          <h4 class="toggle-title">
                            Automatische Hintergrundentfernung
                          </h4>
                          <p class="toggle-description">
                            Entfernt automatisch den Hintergrund mit KI - √ºber
                            unseren Server!
                          </p>
                        </div>
                      </div>
                      <div class="toggle-switch-container">
                        <label class="toggle-switch">
                          <input
                            type="checkbox"
                            [(ngModel)]="removeBackground"
                            [disabled]="
                              sprayUploadLoading || backgroundRemovalProcessing
                            "
                            (change)="onBackgroundRemovalToggle()"
                          />
                          <span class="toggle-slider"></span>
                        </label>
                      </div>
                    </div>

                    <!-- Status indicator -->
                    <div
                      class="toggle-status"
                      [class.active]="removeBackground"
                    >
                      <span class="status-indicator"></span>
                      <span class="status-text">
                        {{
                          removeBackground
                            ? 'Aktiviert - Hintergrund wird mit KI entfernt'
                            : 'Deaktiviert - Originalbild wird verwendet'
                        }}
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Privacy Policy Notice -->
                <div
                  class="privacy-warning mt-4 bg-yellow-900/30 border border-yellow-500/50 rounded-lg"
                >
                  <!-- Compact Default State -->
                  <div
                    *ngIf="!showPrivacyDetails"
                    class="flex items-center gap-3 p-4 md:p-5"
                  >
                    <div class="text-yellow-400 text-xl leading-none">‚ö†Ô∏è</div>
                    <div class="text-sm text-yellow-100 leading-relaxed">
                      <strong>Datenschutzhinweis:</strong>
                      <span
                        class="text-yellow-300 underline decoration-yellow-400/70 hover:text-yellow-200 cursor-pointer ml-1"
                        (click)="showPrivacyDetails = true"
                        >Details anzeigen
                      </span>
                    </div>
                  </div>

                  <!-- Expanded Privacy Details -->
                  <div
                    *ngIf="showPrivacyDetails"
                    id="privacy-details"
                    class="privacy-expanded p-4 md:p-5"
                  >
                    <div class="flex items-start gap-3 mb-3">
                      <div class="text-yellow-400 text-xl leading-none">‚ö†Ô∏è</div>
                      <h4
                        class="text-sm md:text-base font-semibold text-yellow-100 flex-1 cardHeader"
                      >
                        Datenschutzhinweis - Wichtige Informationen
                      </h4>

                      <span
                        class="privacy-close-btn text-yellow-300 hover:text-yellow-200 text-xs md:text-sm cursor-pointer"
                        (click)="showPrivacyDetails = false"
                        title="Schlie√üen"
                        role="button"
                        aria-label="Datenschutzhinweis schlie√üen"
                        aria-expanded="true"
                        aria-controls="privacy-details"
                      >
                        ‚úï
                      </span>
                    </div>

                    <ul
                      class="privacy-list text-sm text-yellow-100 space-y-3 pl-1"
                    >
                      <li class="leading-relaxed">
                        <span class="font-semibold"
                          >√ñffentliche Verf√ºgbarkeit und Daten√ºbertragung:</span
                        >
                        Ihr hochgeladenes Bild wird √∂ffentlich zug√§nglich und
                        kann an unseren Discord-Server √ºbertragen werden,
                        welcher auf US-amerikanischen Servern au√üerhalb unserer
                        direkten Kontrolle gehostet wird. Diese √úbertragung
                        erfolgt zur technischen Bereitstellung des Services.
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold"
                          >Datenl√∂schung und Persistenz:</span
                        >
                        Eine L√∂schung des Bildes durch Sie garantiert nicht die
                        vollst√§ndige und endg√ºltige Entfernung von unseren
                        Systemen, Discord-Servern oder beteiligten
                        Drittsystemen. Kopien k√∂nnen in Backups, Caches oder
                        anderen technischen Systemen verbleiben.
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold"
                          >Automatisierte Inhaltsmoderation:</span
                        >
                        Alle hochgeladenen Bilder werden automatisiert mittels
                        OpenAI-Moderation (Modell ‚Äûomni-moderation-latest‚Äú)
                        gepr√ºft. Dabei k√∂nnen Ihre Bilddaten an OpenAI
                        √ºbermittelt werden. Die Verarbeitung erfolgt zur
                        Erkennung und Vermeidung unzul√§ssiger Inhalte.
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold"
                          >Moderationsma√ünahmen und Account-Sperrung:</span
                        >
                        Wir behalten uns vor, hochgeladene Bilder jederzeit und
                        ohne Vorank√ºndigung zu l√∂schen. Bei Verst√∂√üen gegen
                        diese Hinweise, gegen gesetzliche Vorgaben oder bei
                        missbr√§uchlicher Nutzung kann Ihr Account ohne vorherige
                        Warnung gesperrt werden.
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold"
                          >Internationale Daten√ºbertragung:</span
                        >
                        Durch die Nutzung von Discord-Servern und die Einbindung
                        des OpenAI-Moderationsdienstes kann eine √úbertragung
                        Ihrer Daten in die USA und ggf. weitere Drittl√§nder
                        erfolgen, in denen ein anderes Datenschutzniveau als in
                        Deutschland/EU gilt.
                      </li>

                      <li class="leading-relaxed font-semibold p-2 rounded">
                        <span class="font-semibold"
                          >Einverst√§ndniserkl√§rung:</span
                        >
                        Durch das Hochladen eines Bildes erkl√§ren Sie sich mit
                        den oben genannten Bedingungen einverstanden und
                        best√§tigen, dass Sie die rechtlichen Konsequenzen
                        verstanden haben.
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- Rules Widget -->
                <div
                  class="privacy-warning mt-4 bg-yellow-900/30 border border-yellow-500/50 rounded-lg"
                >
                  <!-- Compact Default State -->
                  <div
                    *ngIf="!showRulesDetails"
                    class="flex items-center gap-3 p-4 md:p-5"
                  >
                    <div class="text-yellow-400 text-xl leading-none">üìã</div>
                    <div class="text-sm text-yellow-100 leading-relaxed">
                      <strong>Regeln f√ºr Inhalte:</strong>
                      <span
                        class="text-yellow-300 underline decoration-yellow-400/70 hover:text-yellow-200 cursor-pointer ml-1"
                        (click)="showRulesDetails = true"
                        >Details anzeigen
                      </span>
                    </div>
                  </div>

                  <!-- Expanded Rules Details -->
                  <div
                    *ngIf="showRulesDetails"
                    id="rules-details"
                    class="privacy-expanded p-4 md:p-5"
                  >
                    <div class="flex items-start gap-3 mb-3">
                      <div class="text-yellow-400 text-xl leading-none">üìã</div>
                      <h4
                        class="text-sm md:text-base font-semibold text-yellow-100 flex-1 cardHeader"
                      >
                        Inhaltsregeln - Was ist nicht erlaubt
                      </h4>

                      <span
                        class="privacy-close-btn text-yellow-300 hover:text-yellow-200 text-xs md:text-sm cursor-pointer"
                        (click)="showRulesDetails = false"
                        title="Schlie√üen"
                        role="button"
                        aria-label="Regeln schlie√üen"
                        aria-expanded="true"
                        aria-controls="rules-details"
                      >
                        ‚úï
                      </span>
                    </div>

                    <ul
                      class="privacy-list text-sm text-yellow-100 space-y-3 pl-1"
                    >
                      <li class="leading-relaxed">
                        <span class="font-semibold block text-yellow-200"
                          >I. Unzul√§ssige Inhalte:</span
                        >
                        <ul class="pl-4 space-y-2 list-disc">
                          <li>
                            Pornographische, erotische oder sexuelle Inhalte
                            sowie Darstellungen von Nacktheit.
                          </li>
                          <li>
                            Politische Inhalte jeglicher Art, unabh√§ngig von der
                            Ausrichtung.
                          </li>
                          <li>
                            Ausschnitte oder Teilansichten aus verbotenem
                            Material, auch wenn diese keine explizite
                            Darstellung enthalten.
                          </li>
                        </ul>
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold block text-yellow-200"
                          >II. Flaggen:</span
                        >
                        <ul class="pl-4 space-y-2 list-disc">
                          <li>
                            Zul√§ssig sind ausschlie√ülich Flaggen existierender
                            Staaten, die von den Vereinten Nationen anerkannt
                            sind.
                          </li>
                          <li>
                            Eigene, selbst entworfene Flaggen sind erlaubt,
                            sofern sie keinen Bezug zu bestehenden Nationen
                            aufweisen.
                          </li>
                        </ul>
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold block text-yellow-200"
                          >III. Kommunikation und Verhalten:</span
                        >
                        <ul class="pl-4 space-y-2 list-disc">
                          <li>
                            Hasserf√ºllte Aussagen, diskriminierende √Ñu√üerungen
                            oder Beleidigungen sind nicht gestattet.
                          </li>
                        </ul>
                      </li>

                      <li class="leading-relaxed">
                        <span class="font-semibold block text-yellow-200"
                          >IV. Abbildungen von Personen:</span
                        >
                        <ul class="pl-4 space-y-2 list-disc">
                          <li>
                            Darstellungen von Kindern oder Jugendlichen sind
                            strikt untersagt.
                          </li>
                          <li>
                            Dies gilt auch f√ºr Personen, die minderj√§hrig
                            wirken, selbst wenn sie tats√§chlich vollj√§hrig sind.
                          </li>
                        </ul>
                      </li>

                      <li
                        class="leading-relaxed font-semibold p-2 rounded bg-yellow-800/30"
                      >
                        <span class="font-semibold"
                          >V. Konsequenzen bei Verst√∂√üen:</span
                        >
                        Bei Zuwiderhandlungen wird der betreffende Account ohne
                        vorherige Ank√ºndigung gesperrt.
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- Messages -->
                <div *ngIf="sprayUploadError" class="error-message mt-3">
                  {{ sprayUploadError }}
                </div>
                <div *ngIf="sprayUploadSuccess" class="success-message mt-3">
                  Spray erfolgreich hochgeladen!
                </div>
                <div *ngIf="sprayDeleteSuccess" class="success-message mt-3">
                  Spray erfolgreich gel√∂scht!
                </div>
              </div>
              <!-- End of non-banned functionality -->
            </div>
          </div>
        </td>

        <!-- Fakerank Card -->
        <td rowspan="1" colspan="1" class="align-top p-2">
          <div
            id="fakerank-card"
            class="stats-card p-6 rounded-2xl auto-height"
          >
            <!-- Help Popup (replaces entire card content when shown) -->
            <div *ngIf="showFakerankHelp" class="help-popup h-full">
              <div class="help-content h-full">
                <div class="help-title">
                  Fakerank - Dein pers√∂nlicher Spitzname! ‚ú®
                </div>
                <div class="help-text">
                  Ein Fakerank ist einfach ein cooler Spitzname, den du dir
                  selbst geben kannst! Es hat nichts mit deinem echten Rang im
                  Spiel zu tun - es ist nur zur Dekoration und macht dein Profil
                  pers√∂nlicher.
                </div>
                <div class="help-text">
                  <strong>Wann kannst du es nutzen?</strong><br />
                  Jederzeit! Sei kreativ - ob "Pizza Liebhaber", "Sniper Pro"
                  oder "Chaos K√∂nig" - es ist dein pers√∂nlicher Touch.
                </div>
                <div class="help-text">
                  <strong>Tipp:</strong> W√§hle etwas, das deine Pers√∂nlichkeit
                  oder deinen Spielstil widerspiegelt. Andere Spieler werden es
                  sehen k√∂nnen!
                </div>
                <button
                  (click)="showFakerankHelp = false"
                  class="help-close-btn"
                >
                  Verstanden! ‚ú®
                </button>
              </div>
            </div>

            <!-- Regular Card Content -->
            <div *ngIf="!showFakerankHelp">
              <h3
                class="text-xl font-bold text-white mb-4 flex items-center gap-2 justify-between cardHeader"
              >
                <div class="flex items-center gap-2">
                  ‚ú® <span>Fakerank</span>
                  <!-- Timer Badge -->
                  <span
                    *ngIf="fakerankTimeRemaining > 0"
                    class="fakerank-timer-badge"
                  >
                    {{ formatTimeRemaining(fakerankTimeRemaining) }}
                  </span>
                  <!-- Admin Badge -->
                  <span
                    *ngIf="fakerankAdminTimeRemaining > 0"
                    class="fakerank-admin-badge"
                  >
                    Admin
                  </span>
                </div>
                <div class="flex items-center gap-2">
                  <button
                    (click)="showFakerankHelp = true"
                    class="help-button"
                    title="Was ist ein Fakerank?"
                  >
                    ?
                  </button>
                </div>
              </h3>

              <!-- Display Mode -->
              <div *ngIf="!isEditingFakerank" class="fakerank-display">
                <!-- Check if user can edit fakeranks -->
                <div *ngIf="fakerankAllowed">
                  <!-- Show override info if user has override (but can still edit) -->
                  <div
                    *ngIf="hasFakerankOverride && !isFakerankReadOnly"
                    class="override-info-banner"
                  >
                    <div class="override-banner-icon">üõ°Ô∏è</div>
                    <div class="override-banner-text">
                      <span class="override-banner-title"
                        >Admin-Override aktiv</span
                      >
                      <span
                        class="override-banner-subtitle"
                        *ngIf="fakerankOverrideTimeRemaining > 0"
                      >
                        Du kannst trotzdem bearbeiten ¬∑ Verbleibt:
                        {{ formatTimeRemaining(fakerankOverrideTimeRemaining) }}
                      </span>
                    </div>
                  </div>

                  <div class="nickname-container mb-4">
                    <div
                      class="nickname-preview"
                      [class.nickname-empty]="!currentFakerank"
                    >
                      <div *ngIf="currentFakerank" class="nickname-display">
                        <div class="nickname-icon">‚ú®</div>
                        <div class="nickname-text">
                          <span class="nickname-label">Dein Spitzname:</span>
                          <span
                            class="nickname-value"
                            [style.color]="getColorHex(currentFakerankColor)"
                            >{{ currentFakerank }}</span
                          >
                          <div class="nickname-color-info">
                            <span
                              class="color-indicator"
                              [style.background-color]="
                                getColorHex(currentFakerankColor)
                              "
                            ></span>
                            {{ getColorName(currentFakerankColor) }}
                          </div>
                        </div>
                      </div>
                      <div
                        *ngIf="!currentFakerank"
                        class="nickname-empty-state"
                      >
                        <div class="nickname-icon">üí≠</div>
                        <div class="nickname-text">
                          <span class="nickname-label"
                            >Noch kein Spitzname</span
                          >
                          <span class="nickname-subtitle"
                            >Gib dir einen coolen Namen!</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="fakerank-actions">
                    <button
                      (click)="startEditingFakerank()"
                      class="fakerank-btn fakerank-btn-primary"
                      [disabled]="fakerankLoading"
                    >
                      {{ currentFakerank ? '‚úèÔ∏è √Ñndern' : '‚ûï Erstellen' }}
                    </button>
                    <button
                      *ngIf="currentFakerank"
                      (click)="deleteFakerank()"
                      class="fakerank-btn fakerank-btn-danger"
                      [disabled]="fakerankLoading"
                    >
                      üóëÔ∏è L√∂schen
                    </button>

                    <!-- Admin Button -->
                    <button
                      *ngIf="isFakerankAdmin()"
                      [routerLink]="['/fakerank']"
                      class="fakerank-btn fakerank-btn-admin"
                      title="Fakerank Administration"
                    >
                      üõ°Ô∏è Admin Panel
                    </button>

                    <!-- Disabled Admin Button for non-admins (optional visual indicator) -->
                    <button
                      *ngIf="!isFakerankAdmin()"
                      class="fakerank-btn fakerank-btn-admin-disabled"
                      disabled
                      title="Nur f√ºr Fakerank-Administratoren verf√ºgbar"
                    >
                      üõ°Ô∏è Admin Panel
                    </button>
                  </div>
                </div>

                <!-- Override fakerank (read-only, set by admin) -->
                <div *ngIf="isFakerankReadOnly" class="fakerank-override">
                  <div class="nickname-container mb-4">
                    <div
                      class="nickname-preview"
                      [class.nickname-empty]="!currentFakerank"
                    >
                      <div
                        *ngIf="currentFakerank"
                        class="nickname-display override-display"
                      >
                        <div class="nickname-icon">üîí</div>
                        <div class="nickname-text">
                          <span class="nickname-label">Admin-Spitzname:</span>
                          <span
                            class="nickname-value"
                            [style.color]="getColorHex(currentFakerankColor)"
                            >{{ currentFakerank }}</span
                          >
                        </div>
                        <div class="override-badge">
                          <span class="override-text">Override</span>
                          <span
                            class="override-timer"
                            *ngIf="fakerankOverrideTimeRemaining > 0"
                          >
                            {{
                              formatTimeRemaining(fakerankOverrideTimeRemaining)
                            }}
                          </span>
                        </div>
                      </div>
                      <div
                        *ngIf="!currentFakerank"
                        class="nickname-empty-display"
                      >
                        <div class="nickname-icon">üîí</div>
                        <span class="nickname-placeholder"
                          >Admin kann dir einen Spitzname zuweisen</span
                        >
                      </div>
                    </div>
                  </div>

                  <div class="override-info">
                    <div class="override-icon">üõ°Ô∏è</div>
                    <div class="override-message">
                      <p class="override-title">Admin-Override aktiv</p>
                      <p class="override-text">
                        Dein Spitzname wurde von einem Admin gesetzt und kann
                        nicht bearbeitet werden.
                        <span *ngIf="fakerankOverrideTimeRemaining > 0">
                          Verbleibt:
                          <strong>{{
                            formatTimeRemaining(fakerankOverrideTimeRemaining)
                          }}</strong>
                        </span>
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Not allowed message -->
                <div *ngIf="!fakerankAllowed" class="fakerank-not-allowed">
                  <div class="not-allowed-icon">üîí</div>
                  <div class="not-allowed-message">
                    <p class="not-allowed-title">Noch nicht freigeschaltet!</p>
                    <p class="not-allowed-text">
                      Du bist noch nicht f√ºr diese Zeitvertreib-Funktion
                      freigeschaltet! Du kannst entweder den Discord-Server
                      <strong>boosten</strong>, √ºber
                      <strong style="white-space: nowrap">ko-fi.com</strong>
                      spenden oder durch sehr aktives Spielen auf dem SCP-Server
                      <strong>VIP</strong> werden.
                    </p>
                    <p class="not-allowed-link">
                      Tritt dem Discord unter
                      <a
                        href="https://dsc.gg/zeit"
                        style="text-decoration: none"
                        ><strong>dsc.gg/zeit</strong></a
                      >
                      bei f√ºr weitere Informationen.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Edit Mode -->
              <div
                *ngIf="isEditingFakerank && fakerankAllowed"
                class="fakerank-edit"
              >
                <div class="nickname-editor mb-4">
                  <label class="editor-label"> ‚ú® Dein neuer Spitzname </label>
                  <div class="fakerank-input-container">
                    <input
                      type="text"
                      [(ngModel)]="fakerankValue"
                      placeholder="z.B. Pizza Liebhaber, Sniper Pro, Chaos K√∂nig..."
                      maxlength="50"
                      class="nickname-input"
                      [disabled]="fakerankLoading"
                      [style.color]="getColorHex(tempFakerankColor)"
                      (keydown)="onKeyDown($event)"
                      (keyup.enter)="saveFakerank()"
                      (keyup.escape)="cancelEditingFakerank()"
                    />
                    <div class="fakerank-char-count">
                      {{ fakerankValue.length }}/50
                    </div>
                  </div>

                  <!-- Color Picker Section -->
                  <div class="color-picker-section mt-3">
                    <label class="editor-label">üé® Farbe w√§hlen</label>
                    <div class="color-picker-container">
                      <button
                        (click)="toggleColorPicker()"
                        class="color-selector-button"
                        [disabled]="fakerankLoading"
                      >
                        <span
                          class="color-indicator"
                          [style.background-color]="
                            getColorHex(tempFakerankColor)
                          "
                        ></span>
                        {{ getColorName(tempFakerankColor) }}
                        <span class="dropdown-arrow">{{
                          showColorPicker ? '‚ñ≤' : '‚ñº'
                        }}</span>
                      </button>

                      <div
                        *ngIf="showColorPicker"
                        class="color-picker-dropdown"
                      >
                        <div class="color-options">
                          <button
                            *ngFor="let color of fakerankColors"
                            (click)="selectColor(color.key)"
                            class="color-option"
                            [class.selected]="tempFakerankColor === color.key"
                          >
                            <span
                              class="color-indicator"
                              [style.background-color]="color.hex"
                            ></span>
                            <span class="color-name">{{ color.name }}</span>
                            <span
                              *ngIf="tempFakerankColor === color.key"
                              class="selected-check"
                              >‚úì</span
                            >
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="editor-hint">
                    üí° Sei kreativ! Dies ist nur ein Spitzname zur Dekoration.
                  </div>
                </div>
                <div class="fakerank-actions">
                  <button
                    (click)="saveFakerank()"
                    class="fakerank-btn fakerank-btn-success"
                    [disabled]="
                      fakerankLoading || fakerankValue.trim().length === 0
                    "
                  >
                    {{ fakerankLoading ? 'üíæ Speichern...' : 'üíæ Speichern' }}
                  </button>
                  <button
                    (click)="cancelEditingFakerank()"
                    class="fakerank-btn fakerank-btn-secondary"
                    [disabled]="fakerankLoading"
                  >
                    ‚ùå Abbrechen
                  </button>
                </div>
              </div>

              <!-- Success Message -->
              <div
                *ngIf="fakerankSuccess"
                class="fakerank-message fakerank-success mt-3"
              >
                üéâ Spitzname erfolgreich gespeichert!
              </div>

              <!-- Error Message -->
              <div
                *ngIf="fakerankError"
                class="fakerank-message fakerank-error mt-3"
              >
                {{ fakerankError }}
              </div>
            </div>
          </div>
        </td>

        <!-- Cosmetic Customization Widget -->
        <td colspan="1" class="cosmetics-container align-top p-2">
          <div class="stats-card p-6 rounded-2xl">
            <h3
              class="text-xl font-bold text-white mb-4 cardHeader flex items-center gap-2"
            >
              ‚ú® Cosmetic Editor
              <span class="cosmetic-beta-badge">BETA</span>
            </h3>

            <!-- Cosmetic Preview Section -->
            <div class="cosmetic-preview-section mb-6">
              <div class="cosmetic-preview-card">
                <div class="cosmetic-avatar-container">
                  <div class="cosmetic-avatar-base">
                    <div class="cosmetic-player-model">üßë‚Äçüíº</div>

                    <!-- Hat Layer -->
                    <div class="cosmetic-hat-layer" *ngIf="selectedHat">
                      <span class="cosmetic-hat-emoji">{{
                        getHatEmoji(selectedHat)
                      }}</span>
                    </div>

                    <!-- Pet -->
                    <div class="cosmetic-pet-container" *ngIf="selectedPet">
                      <span class="cosmetic-pet-emoji">{{
                        getPetEmoji(selectedPet)
                      }}</span>
                    </div>

                    <!-- Aura Effect -->
                    <div
                      class="cosmetic-aura-effect"
                      [class]="'cosmetic-aura-' + selectedAura"
                      *ngIf="selectedAura && selectedAura !== 'none'"
                    ></div>
                  </div>
                </div>

                <div class="cosmetic-preview-info">
                  <h4 class="cosmetic-preview-title">Dein Look</h4>
                  <div class="cosmetic-active-items">
                    <div class="cosmetic-item-tag" *ngIf="selectedHat">
                      üé© {{ getHatName(selectedHat) }}
                    </div>
                    <div class="cosmetic-item-tag" *ngIf="selectedPet">
                      üêæ {{ getPetName(selectedPet) }}
                    </div>
                    <div
                      class="cosmetic-item-tag"
                      *ngIf="selectedAura && selectedAura !== 'none'"
                    >
                      ‚ú® {{ getAuraName(selectedAura) }}
                    </div>
                    <div
                      class="cosmetic-item-tag cosmetic-empty"
                      *ngIf="
                        !selectedHat &&
                        !selectedPet &&
                        (!selectedAura || selectedAura === 'none')
                      "
                    >
                      üí≠ Standard Look
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Cosmetic Categories -->
            <div class="cosmetic-categories">
              <div class="cosmetic-category-tabs">
                <button
                  class="cosmetic-tab"
                  [class.active]="activeTab === 'hats'"
                  (click)="activeTab = 'hats'"
                >
                  üé© H√ºte
                </button>
                <button
                  class="cosmetic-tab"
                  [class.active]="activeTab === 'pets'"
                  (click)="activeTab = 'pets'"
                >
                  üêæ Begleiter
                </button>
                <button
                  class="cosmetic-tab"
                  [class.active]="activeTab === 'auras'"
                  (click)="activeTab = 'auras'"
                >
                  ‚ú® Aura Effekte
                </button>
              </div>

              <!-- Hats Tab -->
              <div class="cosmetic-tab-content" *ngIf="activeTab === 'hats'">
                <div class="cosmetic-items-grid">
                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedHat === 'none'"
                    [class.owned]="true"
                    (click)="selectHat('none')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-no-item">üö´</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Kein Hut</h5>
                      <p class="cosmetic-item-status owned">Verf√ºgbar</p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedHat === 'cap'"
                    [class.owned]="ownedCosmetics.hats.includes('cap')"
                    [class.locked]="!ownedCosmetics.hats.includes('cap')"
                    (click)="selectHat('cap')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">üß¢</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Baseball Cap</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.hats.includes('cap')"
                        [class.locked]="!ownedCosmetics.hats.includes('cap')"
                      >
                        {{
                          ownedCosmetics.hats.includes('cap')
                            ? 'Besessen'
                            : '500 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedHat === 'crown'"
                    [class.owned]="ownedCosmetics.hats.includes('crown')"
                    [class.locked]="!ownedCosmetics.hats.includes('crown')"
                    (click)="selectHat('crown')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">üëë</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">K√∂nigskrone</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.hats.includes('crown')"
                        [class.locked]="!ownedCosmetics.hats.includes('crown')"
                      >
                        {{
                          ownedCosmetics.hats.includes('crown')
                            ? 'Besessen'
                            : '2000 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedHat === 'helmet'"
                    [class.owned]="ownedCosmetics.hats.includes('helmet')"
                    [class.locked]="!ownedCosmetics.hats.includes('helmet')"
                    (click)="selectHat('helmet')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">‚õëÔ∏è</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Schutzhelm</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.hats.includes('helmet')"
                        [class.locked]="!ownedCosmetics.hats.includes('helmet')"
                      >
                        {{
                          ownedCosmetics.hats.includes('helmet')
                            ? 'Besessen'
                            : '750 ZVC'
                        }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Pets Tab -->
              <div class="cosmetic-tab-content" *ngIf="activeTab === 'pets'">
                <div class="cosmetic-items-grid">
                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedPet === 'none'"
                    [class.owned]="true"
                    (click)="selectPet('none')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-no-item">üö´</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Kein Begleiter</h5>
                      <p class="cosmetic-item-status owned">Verf√ºgbar</p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedPet === 'cat'"
                    [class.owned]="ownedCosmetics.pets.includes('cat')"
                    [class.locked]="!ownedCosmetics.pets.includes('cat')"
                    (click)="selectPet('cat')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">üê±</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Cyber Katze</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.pets.includes('cat')"
                        [class.locked]="!ownedCosmetics.pets.includes('cat')"
                      >
                        {{
                          ownedCosmetics.pets.includes('cat')
                            ? 'Besessen'
                            : '1200 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedPet === 'dog'"
                    [class.owned]="ownedCosmetics.pets.includes('dog')"
                    [class.locked]="!ownedCosmetics.pets.includes('dog')"
                    (click)="selectPet('dog')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">üêï</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Roboter Hund</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.pets.includes('dog')"
                        [class.locked]="!ownedCosmetics.pets.includes('dog')"
                      >
                        {{
                          ownedCosmetics.pets.includes('dog')
                            ? 'Besessen'
                            : '1500 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedPet === 'bird'"
                    [class.owned]="ownedCosmetics.pets.includes('bird')"
                    [class.locked]="!ownedCosmetics.pets.includes('bird')"
                    (click)="selectPet('bird')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-item-emoji">ü¶Ö</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Drohnen Adler</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.pets.includes('bird')"
                        [class.locked]="!ownedCosmetics.pets.includes('bird')"
                      >
                        {{
                          ownedCosmetics.pets.includes('bird')
                            ? 'Besessen'
                            : '1800 ZVC'
                        }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Auras Tab -->
              <div class="cosmetic-tab-content" *ngIf="activeTab === 'auras'">
                <div class="cosmetic-items-grid">
                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedAura === 'none'"
                    [class.owned]="true"
                    (click)="selectAura('none')"
                  >
                    <div class="cosmetic-item-preview">
                      <span class="cosmetic-no-item">üö´</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Keine Aura</h5>
                      <p class="cosmetic-item-status owned">Verf√ºgbar</p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedAura === 'blue'"
                    [class.owned]="ownedCosmetics.auras.includes('blue')"
                    [class.locked]="!ownedCosmetics.auras.includes('blue')"
                    (click)="selectAura('blue')"
                  >
                    <div class="cosmetic-item-preview cosmetic-aura-preview">
                      <div class="cosmetic-aura-demo cosmetic-aura-blue"></div>
                      <span class="cosmetic-item-emoji">üíô</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Blaue Aura</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.auras.includes('blue')"
                        [class.locked]="!ownedCosmetics.auras.includes('blue')"
                      >
                        {{
                          ownedCosmetics.auras.includes('blue')
                            ? 'Besessen'
                            : '800 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedAura === 'red'"
                    [class.owned]="ownedCosmetics.auras.includes('red')"
                    [class.locked]="!ownedCosmetics.auras.includes('red')"
                    (click)="selectAura('red')"
                  >
                    <div class="cosmetic-item-preview cosmetic-aura-preview">
                      <div class="cosmetic-aura-demo cosmetic-aura-red"></div>
                      <span class="cosmetic-item-emoji">‚ù§Ô∏è</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Rote Aura</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.auras.includes('red')"
                        [class.locked]="!ownedCosmetics.auras.includes('red')"
                      >
                        {{
                          ownedCosmetics.auras.includes('red')
                            ? 'Besessen'
                            : '800 ZVC'
                        }}
                      </p>
                    </div>
                  </div>

                  <div
                    class="cosmetic-item-card"
                    [class.selected]="selectedAura === 'rainbow'"
                    [class.owned]="ownedCosmetics.auras.includes('rainbow')"
                    [class.locked]="!ownedCosmetics.auras.includes('rainbow')"
                    (click)="selectAura('rainbow')"
                  >
                    <div class="cosmetic-item-preview cosmetic-aura-preview">
                      <div
                        class="cosmetic-aura-demo cosmetic-aura-rainbow"
                      ></div>
                      <span class="cosmetic-item-emoji">üåà</span>
                    </div>
                    <div class="cosmetic-item-info">
                      <h5 class="cosmetic-item-name">Regenbogen Aura</h5>
                      <p
                        class="cosmetic-item-status"
                        [class.owned]="ownedCosmetics.auras.includes('rainbow')"
                        [class.locked]="
                          !ownedCosmetics.auras.includes('rainbow')
                        "
                      >
                        {{
                          ownedCosmetics.auras.includes('rainbow')
                            ? 'Besessen'
                            : '2500 ZVC'
                        }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="cosmetic-actions mt-6">
              <button
                class="cosmetic-action-btn cosmetic-primary-btn"
                (click)="saveCosmetics()"
                [disabled]="cosmeticLoading"
              >
                <span *ngIf="!cosmeticLoading">üíæ √Ñnderungen speichern</span>
                <span *ngIf="cosmeticLoading">üíæ Speichere...</span>
              </button>

              <button
                class="cosmetic-action-btn cosmetic-secondary-btn"
                (click)="resetToDefault()"
              >
                üîÑ Zur√ºcksetzen
              </button>

              <button
                class="cosmetic-action-btn cosmetic-shop-btn"
                (click)="openCosmeticShop()"
              >
                üõí Cosmetic Shop
              </button>
            </div>

            <!-- Info Notice -->
            <div class="cosmetic-info-notice mt-4">
              <div class="cosmetic-notice-icon">‚ÑπÔ∏è</div>
              <div class="cosmetic-notice-text">
                <strong>Beta Feature:</strong> Das Cosmetic System befindet sich
                in der Entwicklung. Einige Items sind m√∂glicherweise noch nicht
                im Spiel verf√ºgbar.
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr></tr>
      <tr>
        <!-- Session History (spans 2 columns) -->
        <td colspan="2" class="history-container align-top p-2">
          <div class="stats-card p-6 rounded-2xl">
            <div class="flex justify-between items-center mb-4 cardHeader">
              <h3 class="text-2xl font-bold text-white cardHeader">
                Verlauf & Sitzungen
              </h3>
              <button (click)="refreshStats()" class="refresh-button">
                Aktualisieren
              </button>
            </div>
            <div class="chart-placeholder">
              <div class="text-6xl mb-4">üìà</div>
              <p class="text-lg">K√ºrzliche Sitzungen und Verlauf</p>
              <p class="text-sm mt-2 opacity-75">
                Detaillierte Spielverlaufsdaten werden hier angezeigt
              </p>
            </div>
          </div>
        </td>

        <!-- Empty cell to balance the row -->
        <td class="align-top p-2"></td>
      </tr>
    </table>
  </div>
</div>

<div class="dashboard-container">
  <div class="relative z-10">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="text-center text-white">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-xl font-medium">Lade Statistiken...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-state">
      <div class="error-message max-w-md mx-auto">
        <h3 class="text-xl font-bold mb-2">Fehler beim Laden</h3>
        <p class="mb-4">{{ errorMessage }}</p>
        <button (click)="refreshStats()" class="refresh-button">Erneut versuchen</button>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && !hasError" class="dashboard-grid">
      <!-- Left Column -->
      <div class="column">
        <!-- Stats Overview -->
        <div class="grid-item stats-overview">
          <div class="stats-card p-6 rounded-2xl auto-height">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
              <!-- Kills -->
              <div class="stat-item" style="--stat-color: #10b981; --stat-color-light: #34d399">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">AbschÃ¼sse</h5>
                  <p class="stat-value m-0">
                    {{ userStatistics.kills | number: '1.0-0' }}
                  </p>
                </div>
              </div>

              <!-- Deaths -->
              <div class="stat-item" style="--stat-color: #3b82f6; --stat-color-light: #60a5fa">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">TodesfÃ¤lle</h5>
                  <p class="stat-value m-0">
                    {{ userStatistics.deaths | number: '1.0-0' }}
                  </p>
                </div>
              </div>

              <!-- Playtime -->
              <div class="stat-item" style="--stat-color: #eab308; --stat-color-light: #facc15">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">Spielzeit</h5>
                  <p class="stat-value m-0">
                    {{ playtimeFormatted }}
                  </p>
                </div>
              </div>
              <!-- K/D Ratio -->
              <div class="stat-item" style="--stat-color: #8b5cf6; --stat-color-light: #a78bfa">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                  <h5 class="stat-label m-0 mb-1">K/D Ratio</h5>
                  <p class="stat-value m-0">
                    {{ kdRatio }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- ZV Coins Widget -->
        <div class="grid-item zvcoins-container">
          <div class="zvcoins-card stats-card p-6 rounded-2xl">
            <h3 class="text-xl font-bold text-white mb-4 cardHeader flex items-center justify-between">
              <span>ğŸª™ Zeitvertreib Coins</span>
              <span class="zvcoins-balance-inline"> {{ userStatistics.experience | number: '1.0-0' }} ZVC </span>
            </h3>

            <!-- Code Redemption and Transfer Combined -->
            <div class="zvcoins-balance-code-section mb-6">
              <div class="zvcoins-combined-card">
                <!-- Code Redemption Area -->
                <div class="zvcoins-code-area">
                  <div class="zvcoins-code-header">
                    <div class="zvcoins-code-icon">ğŸ«</div>
                    <div class="zvcoins-code-info">
                      <p class="zvcoins-code-label">Code einlÃ¶sen</p>
                    </div>
                  </div>

                  <!-- Code Info Tip -->
                  <div class="zvcoins-code-tip">
                    <div class="code-tip-icon">ğŸ’¡</div>
                    <div class="code-tip-text">
                      Codes kannst du auf unserem
                      <strong>Discord-Server</strong> oder bei speziellen Events gewinnen!!
                    </div>
                  </div>

                  <div class="zvcoins-code-input-section">
                    <div class="zvcoins-code-input-group">
                      <input
                        type="text"
                        [(ngModel)]="redeemCode"
                        placeholder="Gib deinen Code hier ein..."
                        class="zvcoins-code-input"
                        (keyup.enter)="redeemCodeAction()"
                        [disabled]="codeRedemptionLoading"
                      />
                      <button
                        class="zvcoins-code-btn"
                        (click)="redeemCodeAction()"
                        [disabled]="!redeemCode || codeRedemptionLoading"
                      >
                        <span *ngIf="!codeRedemptionLoading">ğŸ EinlÃ¶sen</span>
                        <span *ngIf="codeRedemptionLoading">â³ Wird eingelÃ¶st...</span>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Vertical Divider -->
                <div class="zvcoins-divider"></div>

                <!-- ZVC Transfer Area -->
                <div class="zvcoins-transfer-area">
                  <div class="zvcoins-transfer-header">
                    <div class="zvcoins-transfer-icon">ğŸ’¸</div>
                    <div class="zvcoins-transfer-info">
                      <p class="zvcoins-transfer-label">Zeitvertreib Coins senden</p>
                    </div>
                  </div>

                  <!-- Transaction Tax Disclaimer -->
                  <div class="zvcoins-transfer-disclaimer">
                    <div class="transfer-disclaimer-icon">{{ isWeekendInBerlin() ? 'ğŸ‰' : 'âš ï¸' }}</div>
                    <div class="transfer-disclaimer-text">
                      <ng-container *ngIf="isWeekendInBerlin(); else normalTax">
                        <strong>ğŸŠ Wochenend-Aktion!</strong> Keine TransaktionsgebÃ¼hr!
                      </ng-container>
                      <ng-template #normalTax>
                        <strong>TransaktionsgebÃ¼hr:</strong> Auf jede Transaktion wird eine 5% Steuer erhoben.
                        <span style="color: #4ade80"><br />Am Wochenende (Sa & So) ist die Steuer 0%!<br /></span>
                      </ng-template>
                    </div>
                  </div>

                  <!-- Transfer Cost Info -->
                  <div *ngIf="transferAmount && transferAmount > 0" class="zvcoins-transfer-cost-info">
                    <div class="transfer-cost-item">
                      <span class="cost-label">Betrag:</span>
                      <span class="cost-value">{{ transferAmount }} ZVC</span>
                    </div>
                    <div class="transfer-cost-item">
                      <span class="cost-label">Steuer ({{ isWeekendInBerlin() ? '0% ğŸ‰' : '5%' }}):</span>
                      <span class="cost-value">{{ getTransferTax(transferAmount) }} ZVC</span>
                    </div>
                    <div class="transfer-cost-item transfer-cost-total">
                      <span class="cost-label">Gesamt:</span>
                      <span class="cost-value">{{ getTransferTotalCost(transferAmount) }} ZVC</span>
                    </div>
                  </div>

                  <div class="zvcoins-transfer-input-section">
                    <div class="zvcoins-transfer-input-group">
                      <input
                        type="text"
                        [(ngModel)]="transferRecipient"
                        placeholder="Steam ID oder Benutzername"
                        class="zvcoins-transfer-input zvcoins-transfer-recipient"
                        [disabled]="transferLoading"
                      />
                      <input
                        type="text"
                        [(ngModel)]="transferAmount"
                        placeholder="Betrag"
                        class="zvcoins-transfer-input zvcoins-transfer-amount"
                        [disabled]="transferLoading"
                      />
                      <button
                        class="zvcoins-transfer-btn"
                        (click)="transferZVC()"
                        [disabled]="
                          !transferRecipient ||
                          !transferAmount ||
                          transferAmount <= 0 ||
                          transferAmount < 100 ||
                          transferAmount > 50000 ||
                          getTransferTotalCost(transferAmount) > (userStatistics.experience || 0) ||
                          transferLoading
                        "
                      >
                        <span *ngIf="!transferLoading">ğŸ’¸ Senden</span>
                        <span *ngIf="transferLoading">â³ Wird gesendet...</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Message displays outside the card for better visibility -->
              <div
                *ngIf="codeRedemptionMessage"
                class="zvcoins-message mt-3"
                [class.success]="codeRedemptionSuccess"
                [class.error]="!codeRedemptionSuccess"
              >
                {{ codeRedemptionMessage }}
              </div>
              <div
                *ngIf="transferMessage"
                class="zvcoins-message mt-3"
                [class.success]="transferSuccess"
                [class.error]="!transferSuccess"
              >
                {{ transferMessage }}
              </div>
            </div>
          </div>
        </div>

        <!-- Two columns under ZV Coins: Sprays (left) + Fakerank (right) -->
        <div class="grid zvcoins-subgrid grid-cols-1 md:grid-cols-2 gap-2">
          <!-- Custom Sprays (moved here from right column) -->
          <div class="grid-item spray-card-container">
            <div class="stats-card p-6 rounded-2xl">
              <div class="spray-header" *ngIf="!isSprayBanned">
                <h3 class="spray-title">ğŸ¨ Custom Sprays</h3>
                <p class="spray-subtitle">Bis zu {{ isDonator ? '3' : '2' }} Sprays hochladen</p>
              </div>

              <!-- Spray Ban Warning -->
              <div *ngIf="isSprayBanned" class="spray-ban-warning">
                <div class="spray-ban-icon">ğŸ”¨</div>
                <div class="spray-ban-content">
                  <h4 class="spray-ban-title">Du wurdest von Spray-Uploads gebannt</h4>
                  <p class="spray-ban-reason"><strong>Grund:</strong> {{ sprayBanReason }}</p>
                  <p class="spray-ban-mod"><strong>Gebannt von:</strong> {{ sprayBannedBy }}</p>
                  <p class="spray-ban-contact">
                    Ã–ffne ein Ticket auf unserem
                    <a href="https://dsc.gg/zeit" target="_blank" class="spray-ban-link"
                      ><strong>Discord-Server</strong></a
                    >.
                  </p>
                </div>
              </div>

              <div class="spray-grid" *ngIf="!isSprayBanned">
                <div *ngFor="let slot of spraySlots; let i = index" class="spray-item">
                  <!-- Locked Slot -->
                  <div *ngIf="i === 2 && !isDonator" class="spray-locked">
                    <p class="spray-locked-title">ğŸ”’ Extra Slot</p>
                    <p class="spray-locked-text">Exklusiv fÃ¼r UnterstÃ¼tzer!</p>
                    <a href="https://ko-fi.com/zeitvertreib" target="_blank" class="spray-unlock-link">
                      Freischalten
                    </a>
                  </div>

                  <!-- Uploaded Spray -->
                  <div
                    *ngIf="shouldShowSpraySlot(i)"
                    class="spray-uploaded"
                    [attr.data-slot-index]="i"
                    [attr.data-spray-id]="slot.id"
                    [attr.data-is-donator]="isDonator"
                  >
                    <img [src]="slot.imageUrl" [alt]="slot.name" class="spray-image" />
                    <div class="spray-info">
                      <span class="spray-name">{{ slot.name }}</span>
                      <button
                        (click)="deleteSprayForSlot(i)"
                        class="spray-delete-btn"
                        [disabled]="slot.isUploading"
                        [attr.data-slot]="i"
                        [attr.data-id]="slot.id"
                        [attr.data-donator]="isDonator"
                      >
                        <span *ngIf="!slot.isUploading">ğŸ—‘ï¸</span>
                        <span *ngIf="slot.isUploading" class="spray-spinner"></span>
                      </button>
                    </div>
                  </div>

                  <!-- Preview & Upload (opens modal for better UX) -->
                  <div
                    *ngIf="(i < 2 || isDonator) && slot.selectedFile && !previewModalOpen && !slot.isUploading"
                    class="spray-preview"
                  >
                    <div class="spray-preview-compact">
                      <img [src]="slot.preview" alt="Preview" class="spray-image" />
                    </div>
                  </div>

                  <!-- Uploading State -->
                  <div *ngIf="slot.isUploading && !slot.id" class="spray-uploading-state">
                    <div class="spray-spinner-large"></div>
                    <div class="spray-uploading-text">Wird hochgeladen...</div>
                  </div>

                  <!-- Empty Slot -->
                  <div *ngIf="(i < 2 || isDonator) && !slot.id && !slot.selectedFile" class="spray-empty">
                    <input
                      type="file"
                      [id]="'spray' + i"
                      accept="image/png,image/jpeg,image/jpg,image/webp"
                      (change)="onSprayFileSelected($event, i)"
                      class="spray-file-input"
                    />
                    <label [for]="'spray' + i" class="spray-upload-zone">
                      <div class="spray-upload-icon">ğŸ“</div>
                      <div class="spray-upload-text">Bild wÃ¤hlen</div>
                    </label>
                  </div>
                </div>
              </div>

              <div *ngIf="sprayError" class="spray-message spray-message-error">{{ sprayError }}</div>
              <div *ngIf="spraySuccess" class="spray-message spray-message-success">{{ spraySuccess }}</div>
            </div>
          </div>

          <!-- Fakerank (moved here from right column) -->
          <div class="grid-item fakerank-container">
            <div id="fakerank-card" class="stats-card p-6 rounded-2xl auto-height">
              <div class="spray-header">
                <h3 class="spray-title">âœ¨ Fakerank</h3>
                <p class="spray-subtitle">Dein persÃ¶nlicher Rang in-game!</p>
                <span class="fakerank-cost-badge">ğŸª™ 100 ZVC / Woche</span>
              </div>

              <!-- Ban Warning -->
              <div *ngIf="isFakerankBanned" class="spray-ban-warning">
                <div class="spray-ban-icon">â›”</div>
                <div class="spray-ban-content">
                  <h4 class="spray-ban-title">Du wurdest von Fakeranks gebannt</h4>
                  <p class="spray-ban-reason">
                    <strong>Grund:</strong> {{ fakerankBanReason || 'Kein Grund angegeben' }}
                  </p>
                  <p class="spray-ban-mod"><strong>Gebannt von:</strong> {{ fakerankBannedBy }}</p>
                  <p class="spray-ban-contact">
                    Ã–ffne ein Ticket auf unserem
                    <a href="https://dsc.gg/zeit" target="_blank" class="spray-ban-link"
                      ><strong>Discord-Server</strong></a
                    >.
                  </p>
                </div>
              </div>

              <!-- Main Content (if not banned) -->
              <div *ngIf="!isFakerankBanned">
                <!-- Current Fakerank Display -->
                <div class="fakerank-slot">
                  <!-- Has Fakerank -->
                  <div *ngIf="currentFakerank" class="fakerank-display-card">
                    <div class="fakerank-content">
                      <div class="fakerank-text">
                        <span class="fakerank-label">Dein FakeRank:</span>
                        <span class="fakerank-value" [style.color]="getColorHex(currentFakerankColor)">
                          {{ currentFakerank }}
                        </span>
                        <div class="fakerank-color-badge">
                          <span class="color-dot" [style.background-color]="getColorHex(currentFakerankColor)"></span>
                          {{ getColorName(currentFakerankColor) }}
                        </div>
                      </div>
                    </div>
                    <div class="fakerank-actions-inline">
                      <button
                        (click)="openFakerankModal()"
                        class="fakerank-action-btn fakerank-edit-btn"
                        [disabled]="fakerankLoading"
                        title="Fakerank bearbeiten"
                      >
                        âœï¸ Bearbeiten
                      </button>
                      <button
                        (click)="deleteFakerank()"
                        class="fakerank-action-btn fakerank-delete-btn"
                        [disabled]="fakerankLoading"
                        title="Fakerank lÃ¶schen"
                      >
                        ğŸ—‘ï¸ LÃ¶schen
                      </button>
                    </div>
                  </div>

                  <!-- Empty Slot (styled like transparent milky sprays slot) -->
                  <div *ngIf="!currentFakerank" class="fakerank-empty-slot">
                    <div class="fakerank-empty-content">
                      <div class="fakerank-empty-icon">âœ¨</div>
                      <p class="fakerank-empty-text">Erstelle deinen persÃ¶nlichen Rang!</p>
                      <button (click)="openFakerankModal()" class="fakerank-create-btn" [disabled]="fakerankLoading">
                        âœ¨ Erstellen
                      </button>
                    </div>
                  </div>
                  <!-- Cost Disclaimer -->
                  <div class="fakerank-cost-disclaimer">
                    <div class="cost-disclaimer-icon">ğŸ’°</div>
                    <div class="cost-disclaimer-text">
                      <strong>Kosten:</strong> Das Erstellen oder Bearbeiten eines Fakeranks kostet
                      <strong>100 ZVC</strong>. Die GebÃ¼hr wird wÃ¶chentlich erneuert, solange dein Fakerank nicht von
                      dir oder einem Teammitglied gelÃ¶scht wurde.
                    </div>
                  </div>
                </div>

                <!-- Messages -->
                <div *ngIf="fakerankError" class="fakerank-message fakerank-error mt-3">{{ fakerankError }}</div>
                <div *ngIf="fakerankSuccess" class="fakerank-message fakerank-success mt-3">{{ fakerankSuccess }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="column">
        <!-- Player Card -->
        <div class="grid-item player-card-container">
          <div class="player-card">
            <!-- Avatar Header -->
            <div class="player-avatar-container" *ngIf="userStatistics.avatarFull">
              <img
                class="player-avatar"
                [src]="getAvatarUrl(userStatistics.avatarFull)"
                [alt]="userStatistics.username || 'Player Avatar'"
                loading="lazy"
                (error)="onImageError($event)"
              />
            </div>

            <!-- Player Info -->
            <div class="p-6">
              <h2 class="text-2xl font-bold text-white mb-2 cardHeader">
                Willkommen zurÃ¼ck,<br />
                <span class="text-gradient">{{ userStatistics.username || 'Spieler' }}</span>
              </h2>

              <p class="text-lg text-gray-300 mb-6">
                {{ leaderboardText }}
              </p>

              <!-- Stats List -->
              <div class="space-y-3">
                <div class="player-info-item">
                  <span class="player-info-label">Gespielte Runden:</span>
                  <span class="player-info-value">{{ userStatistics.roundsplayed | number: '1.0-0' }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Spielzeit:</span>
                  <span class="player-info-value">{{ playtimeFormatted }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Benutzte Medkits:</span>
                  <span class="player-info-value">{{ userStatistics.usedmedkits | number: '1.0-0' }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Getrunkene Colas:</span>
                  <span class="player-info-value">{{ userStatistics.usedcolas | number: '1.0-0' }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Pocket Escapes:</span>
                  <span class="player-info-value">{{ userStatistics.pocketescapes | number: '1.0-0' }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Benutzte Adrenalin:</span>
                  <span class="player-info-value">{{ userStatistics.usedadrenaline | number: '1.0-0' }}</span>
                </div>

                <div class="player-info-item">
                  <span class="player-info-label">Snake Highscore:</span>
                  <span class="player-info-value">{{ userStatistics.snakehighscore | number: '1.0-0' }}</span>
                </div>
              </div>

              <!-- Discord Stats -->
              <app-discord-stats variant="full"></app-discord-stats>
            </div>
          </div>
        </div>
      </div>

      <div class="preview-overlay" *ngIf="previewModalOpen" (click)="closePreviewModal(true)">
        <div
          class="preview-modal redesign"
          (click)="$event.stopPropagation()"
          [style.--accent-color]="previewModalAccentColor"
        >
          <div class="modal-header">
            <div class="header-content">
              <span class="header-icon">ğŸ¨</span>
              <h3 class="preview-title">Spray konfigurieren</h3>
            </div>
            <button class="modal-close-btn" (click)="closePreviewModal(true)">âœ•</button>
          </div>

          <div class="modal-body redesign-body custom-scrollbar">
            <!-- Left Column: Image (1/3) -->
            <div class="preview-left">
              <div class="preview-image-container">
                <img [src]="previewModalUrl" alt="Spray Preview" class="preview-large-image" />
              </div>
            </div>

            <!-- Right Column: Controls (2/3) -->
            <div class="preview-right">
              <div class="preview-input-group">
                <label for="sprayName">Name deines Sprays (max. 20 Zeichen, nur A-Z, 0-9, _, Leerzeichen)</label>
                <input
                  id="sprayName"
                  type="text"
                  class="spray-name-input-large"
                  [(ngModel)]="previewModalName"
                  placeholder="z.B. Mein cooles Spray"
                  maxlength="20"
                  [class.invalid-input]="previewModalName && !isNameValid(previewModalName)"
                />
                <div *ngIf="previewModalName && !isNameValid(previewModalName)" class="input-error-hint">
                  Nur Buchstaben, Zahlen, Unterstriche und Leerzeichen erlaubt.
                </div>
              </div>

              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="privacyCheck"
                    [(ngModel)]="acceptedPrivacy"
                    (change)="acceptedPrivacy ? (showPrivacyText = false) : null"
                  />
                  <label for="privacyCheck">
                    Ich akzeptiere die
                    <span class="text-link" (click)="showPrivacyText = !showPrivacyText; $event.preventDefault()">
                      Datenschutzhinweise
                    </span>
                  </label>
                </div>
                <div *ngIf="showPrivacyText" class="info-box-inline">
                  <div class="info-content">
                    <ul>
                      <li>
                        <strong>Ã–ffentliche VerfÃ¼gbarkeit:</strong> Dein Bild wird Ã¶ffentlich zugÃ¤nglich und kann an
                        unseren Discord-Server (USA) Ã¼bertragen werden.
                      </li>
                      <li>
                        <strong>DatenlÃ¶schung:</strong> Eine LÃ¶schung garantiert keine vollstÃ¤ndige Entfernung aus
                        Backups, Caches oder Drittsystemen.
                      </li>
                      <li>
                        <strong>Moderation:</strong> Bilder werden automatisiert mittels OpenAI (omni-moderation-latest)
                        geprÃ¼ft.
                      </li>
                      <li>
                        <strong>MaÃŸnahmen:</strong> Wir behalten uns vor, Bilder jederzeit zu lÃ¶schen und Accounts bei
                        VerstÃ¶ÃŸen zu sperren.
                      </li>
                      <li>
                        <strong>EinverstÃ¤ndnis:</strong> Mit dem Upload erklÃ¤rst du dich mit diesen Bedingungen
                        einverstanden.
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="rulesCheck"
                    [(ngModel)]="acceptedRules"
                    (change)="acceptedRules ? (showRulesText = false) : null"
                  />
                  <label for="rulesCheck">
                    Ich bestÃ¤tige, dass ich die
                    <span class="text-link" (click)="showRulesText = !showRulesText; $event.preventDefault()">
                      Inhaltsregeln
                    </span>
                    respektiere
                  </label>
                </div>
                <div *ngIf="showRulesText" class="info-box-inline">
                  <div class="info-content">
                    <div *ngIf="sprayRulesLoading" class="rule-section">
                      <p>Regeln werden geladen...</p>
                    </div>
                    <div *ngIf="!sprayRulesLoading && sprayRules">
                      <ol>
                        <li *ngFor="let rule of sprayRules.rules_de">
                          {{ rule }}
                        </li>
                      </ol>
                    </div>
                    <div *ngIf="!sprayRulesLoading && !sprayRules" class="rule-section">
                      <p>Fehler beim Laden der Regeln</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="upload-action">
                <button
                  class="btn-upload-confirm-large"
                  (click)="confirmUploadFromModal()"
                  [disabled]="
                    previewModalUploading || !isNameValid(previewModalName) || !acceptedPrivacy || !acceptedRules
                  "
                >
                  <span *ngIf="!previewModalUploading">ğŸš€ Jetzt hochladen</span>
                  <span *ngIf="previewModalUploading" class="spinner-small"></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fakerank Modal -->
      <div class="preview-overlay" *ngIf="fakerankModalOpen" (click)="closeFakerankModal(true)">
        <div
          class="preview-modal redesign"
          (click)="$event.stopPropagation()"
          [style.--accent-color]="fakerankAccentColor"
        >
          <div class="modal-header">
            <div class="header-content">
              <span class="header-icon">âœ¨</span>
              <h3 class="preview-title">Fakerank konfigurieren</h3>
            </div>
            <button class="modal-close-btn" (click)="closeFakerankModal(true)">âœ•</button>
          </div>

          <div class="modal-body redesign-body custom-scrollbar">
            <!-- Left Column: Preview (1/3) -->
            <div class="preview-left">
              <div
                class="preview-image-container"
                style="
                  aspect-ratio: auto;
                  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
                "
              >
                <div style="text-align: center; padding: 2rem">
                  <div style="font-size: 3rem; margin-bottom: 1rem">âœ¨</div>
                  <div
                    style="
                      font-size: 1.75rem;
                      font-weight: 900;
                      color: white;
                      word-break: break-word;
                      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
                    "
                    [style.color]="getColorHex(fakerankModalColor)"
                  >
                    {{ fakerankModalText || 'Dein Rangname' }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Right Column: Controls (2/3) -->
            <div class="preview-right">
              <div class="preview-input-group">
                <label for="fakerankText">Dein Rangname (max. 50 Zeichen)</label>
                <input
                  id="fakerankText"
                  type="text"
                  class="spray-name-input-large"
                  [(ngModel)]="fakerankModalText"
                  placeholder="z.B. Pizza Liebhaber, Sniper Pro..."
                  maxlength="50"
                />
                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); margin-top: 0.25rem">
                  {{ fakerankModalText.length }}/50 Zeichen
                </div>
              </div>

              <!-- Color Picker - Grouped by Role -->
              <div class="preview-input-group">
                <label>Farbe wÃ¤hlen</label>

                <!-- Color Groups Container -->
                <div class="color-groups-container">
                  <!-- Team Colors -->
                  <div *ngIf="fakerankColorsByRole.teamColors.length > 0" class="color-group">
                    <div class="color-group-label">ğŸ‘¥ Teammitglieder</div>
                    <div class="color-grid">
                      <button
                        *ngFor="let colorKey of fakerankColorsByRole.teamColors"
                        (click)="selectFakerankColor(colorKey)"
                        class="color-option-btn"
                        [class.selected]="fakerankModalColor === colorKey"
                        [class.disabled]="!isColorAllowed(colorKey)"
                        [style.background-color]="getColorHex(colorKey)"
                        [style.opacity]="isColorAllowed(colorKey) ? '1' : '0.3'"
                        [title]="getColorName(colorKey)"
                        [disabled]="!isColorAllowed(colorKey)"
                      ></button>
                    </div>
                  </div>

                  <!-- VIP Colors -->
                  <div *ngIf="fakerankColorsByRole.vipColors.length > 0" class="color-group">
                    <div class="color-group-label">ğŸ’ VIP's</div>
                    <div class="color-grid">
                      <button
                        *ngFor="let colorKey of fakerankColorsByRole.vipColors"
                        (click)="selectFakerankColor(colorKey)"
                        class="color-option-btn"
                        [class.selected]="fakerankModalColor === colorKey"
                        [class.disabled]="!isColorAllowed(colorKey)"
                        [style.background-color]="getColorHex(colorKey)"
                        [style.opacity]="isColorAllowed(colorKey) ? '1' : '0.3'"
                        [title]="getColorName(colorKey)"
                        [disabled]="!isColorAllowed(colorKey)"
                      ></button>
                    </div>
                  </div>

                  <!-- Donator Colors -->
                  <div *ngIf="fakerankColorsByRole.donatorColors.length > 0" class="color-group">
                    <div class="color-group-label">ğŸ Spendenlegenden</div>
                    <div class="color-grid">
                      <button
                        *ngFor="let colorKey of fakerankColorsByRole.donatorColors"
                        (click)="selectFakerankColor(colorKey)"
                        class="color-option-btn"
                        [class.selected]="fakerankModalColor === colorKey"
                        [class.disabled]="!isColorAllowed(colorKey)"
                        [style.background-color]="getColorHex(colorKey)"
                        [style.opacity]="isColorAllowed(colorKey) ? '1' : '0.3'"
                        [title]="getColorName(colorKey)"
                        [disabled]="!isColorAllowed(colorKey)"
                      ></button>
                    </div>
                  </div>

                  <!-- Booster Colors -->
                  <div *ngIf="fakerankColorsByRole.boosterColors.length > 0" class="color-group">
                    <div class="color-group-label">âš¡ Booster</div>
                    <div class="color-grid">
                      <button
                        *ngFor="let colorKey of fakerankColorsByRole.boosterColors"
                        (click)="selectFakerankColor(colorKey)"
                        class="color-option-btn"
                        [class.selected]="fakerankModalColor === colorKey"
                        [class.disabled]="!isColorAllowed(colorKey)"
                        [style.background-color]="getColorHex(colorKey)"
                        [style.opacity]="isColorAllowed(colorKey) ? '1' : '0.3'"
                        [title]="getColorName(colorKey)"
                        [disabled]="!isColorAllowed(colorKey)"
                      ></button>
                    </div>
                  </div>

                  <!-- Other Colors -->
                  <div *ngIf="fakerankColorsByRole.otherColors.length > 0" class="color-group">
                    <div class="color-group-label">ğŸŒˆ Alle anderen Spieler</div>
                    <div class="color-grid">
                      <button
                        *ngFor="let colorKey of fakerankColorsByRole.otherColors"
                        (click)="selectFakerankColor(colorKey)"
                        class="color-option-btn"
                        [class.selected]="fakerankModalColor === colorKey"
                        [class.disabled]="!isColorAllowed(colorKey)"
                        [style.background-color]="getColorHex(colorKey)"
                        [style.opacity]="isColorAllowed(colorKey) ? '1' : '0.3'"
                        [title]="getColorName(colorKey)"
                        [disabled]="!isColorAllowed(colorKey)"
                      ></button>
                    </div>
                  </div>
                </div>

                <div
                  style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.7); text-align: center; margin-top: 0.5rem"
                >
                  {{ getColorName(fakerankModalColor) }}
                </div>
              </div>

              <!-- Privacy & Rules Checkboxes -->
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="fakerankPrivacyCheck"
                    [(ngModel)]="acceptedFakerankPrivacy"
                    (change)="acceptedFakerankPrivacy ? (showFakerankPrivacyText = false) : null"
                  />
                  <label for="fakerankPrivacyCheck">
                    Ich akzeptiere die
                    <span
                      class="text-link"
                      (click)="showFakerankPrivacyText = !showFakerankPrivacyText; $event.preventDefault()"
                    >
                      Datenschutzhinweise
                    </span>
                  </label>
                </div>
                <div *ngIf="showFakerankPrivacyText" class="info-box-inline">
                  <div class="info-content">
                    <ul>
                      <li>
                        <strong>Ã–ffentliche VerfÃ¼gbarkeit:</strong> Dein Fakerank wird Ã¶ffentlich sichtbar und kann an
                        unseren Discord-Server (USA) Ã¼bertragen werden.
                      </li>
                      <li>
                        <strong>DatenlÃ¶schung:</strong> Eine LÃ¶schung garantiert keine vollstÃ¤ndige Entfernung aus
                        Backups, Caches oder Drittsystemen.
                      </li>
                      <li>
                        <strong>MaÃŸnahmen:</strong> Wir behalten uns vor, Fakeranks jederzeit zu lÃ¶schen und Accounts
                        bei VerstÃ¶ÃŸen zu sperren.
                      </li>
                      <li>
                        <strong>EinverstÃ¤ndnis:</strong> Mit dem Speichern erklÃ¤rst du dich mit diesen Bedingungen
                        einverstanden.
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="fakerankRulesCheck"
                    [(ngModel)]="acceptedFakerankRules"
                    (change)="acceptedFakerankRules ? (showFakerankRulesText = false) : null"
                  />
                  <label for="fakerankRulesCheck">
                    Ich bestÃ¤tige, dass ich die
                    <span
                      class="text-link"
                      (click)="showFakerankRulesText = !showFakerankRulesText; $event.preventDefault()"
                    >
                      Inhaltsregeln
                    </span>
                    respektiere
                  </label>
                </div>
                <div *ngIf="showFakerankRulesText" class="info-box-inline">
                  <div class="info-content">
                    <div class="rule-section">
                      <h5>I. UnzulÃ¤ssige Inhalte</h5>
                      <p>Keine Beleidigungen, Hassrede, Diskriminierung oder anstÃ¶ÃŸige Inhalte.</p>
                    </div>
                    <div class="rule-section">
                      <h5>II. Politische Inhalte</h5>
                      <p>Keine politischen Aussagen, Propaganda oder kontroverse Statements.</p>
                    </div>
                    <div class="rule-section">
                      <h5>III. Verhalten</h5>
                      <p>Respektvoller Umgang - keine persÃ¶nlichen Angriffe oder Provokationen.</p>
                    </div>
                    <div class="rule-section">
                      <h5>IV. Konsequenzen</h5>
                      <p>VerstÃ¶ÃŸe fÃ¼hren zur sofortigen Accountsperrung ohne Vorwarnung.</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Error Message -->
              <div *ngIf="fakerankError" class="input-error-hint mt-3">{{ fakerankError }}</div>

              <div class="upload-action mt-4">
                <button
                  class="btn-upload-confirm-large"
                  (click)="saveFakerankFromModal()"
                  [disabled]="
                    fakerankLoading || !fakerankModalText.trim() || !acceptedFakerankPrivacy || !acceptedFakerankRules
                  "
                >
                  <span *ngIf="!fakerankLoading">ğŸ’¾ Speichern</span>
                  <span *ngIf="fakerankLoading" class="spinner-small"></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

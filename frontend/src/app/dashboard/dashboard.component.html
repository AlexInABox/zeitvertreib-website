<div class="dashboard-container">
  <div class="p-6 relative z-10">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="text-center text-white">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-xl font-medium">Lade Statistiken...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-state">
      <div class="error-message max-w-md mx-auto">
        <h3 class="text-xl font-bold mb-2">Fehler beim Laden</h3>
        <p class="mb-4">{{ errorMessage }}</p>
        <button (click)="refreshStats()" class="refresh-button">Erneut versuchen</button>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && !hasError" class="dashboard-grid">
      <!-- Stats Overview -->
      <div class="grid-item stats-overview">
        <div class="stats-card p-6 rounded-2xl auto-height">
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Kills -->
            <div class="stat-item" style="--stat-color: #10b981; --stat-color-light: #34d399">
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">AbschÃ¼sse</h5>
                <p class="stat-value m-0">
                  {{ userStatistics.kills | number: '1.0-0' }}
                </p>
              </div>
            </div>

            <!-- Deaths -->
            <div class="stat-item" style="--stat-color: #3b82f6; --stat-color-light: #60a5fa">
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">TodesfÃ¤lle</h5>
                <p class="stat-value m-0">
                  {{ userStatistics.deaths | number: '1.0-0' }}
                </p>
              </div>
            </div>

            <!-- Playtime -->
            <div class="stat-item" style="--stat-color: #eab308; --stat-color-light: #facc15">
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">Spielzeit</h5>
                <p class="stat-value m-0">
                  {{ playtimeFormatted }}
                </p>
              </div>
            </div>
            <!-- K/D Ratio -->
            <div class="stat-item" style="--stat-color: #8b5cf6; --stat-color-light: #a78bfa">
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">K/D Ratio</h5>
                <p class="stat-value m-0">
                  {{ kdRatio }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Player Card -->
      <div class="grid-item player-card-container">
        <div class="player-card">
          <!-- Avatar Header -->
          <div class="player-avatar-container" *ngIf="userStatistics.avatarFull">
            <img
              class="player-avatar"
              [src]="getAvatarUrl(userStatistics.avatarFull)"
              [alt]="userStatistics.username || 'Player Avatar'"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>

          <!-- Player Info -->
          <div class="p-6">
            <h2 class="text-2xl font-bold text-white mb-2 cardHeader">
              Willkommen zurÃ¼ck,<br />
              <span class="text-gradient">{{ userStatistics.username || 'Spieler' }}</span>
            </h2>

            <p class="text-lg text-gray-300 mb-6">
              {{ leaderboardText }}
            </p>

            <!-- Stats List -->
            <div class="space-y-3">
              <div class="player-info-item">
                <span class="player-info-label">Gespielte Runden:</span>
                <span class="player-info-value">{{ userStatistics.roundsplayed | number: '1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Spielzeit:</span>
                <span class="player-info-value">{{ playtimeFormatted }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Medkits:</span>
                <span class="player-info-value">{{ userStatistics.usedmedkits | number: '1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Getrunkene Colas:</span>
                <span class="player-info-value">{{ userStatistics.usedcolas | number: '1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Pocket Escapes:</span>
                <span class="player-info-value">{{ userStatistics.pocketescapes | number: '1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Adrenalin:</span>
                <span class="player-info-value">{{ userStatistics.usedadrenaline | number: '1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Snake Highscore:</span>
                <span class="player-info-value">{{ userStatistics.snakehighscore | number: '1.0-0' }}</span>
              </div>
            </div>

            <!-- Discord Stats -->
            <app-discord-stats variant="full"></app-discord-stats>
          </div>
        </div>
      </div>

      <!-- ZV Coins Widget -->
      <div class="grid-item zvcoins-container">
        <div class="stats-card p-6 rounded-2xl">
          <h3 class="text-xl font-bold text-white mb-4 cardHeader flex items-center justify-between">
            <span>ğŸª™ Zeitvertreib Coins</span>
            <span class="zvcoins-balance-inline"> {{ userStatistics.experience | number: '1.0-0' }} ZVC </span>
          </h3>

          <!-- Code Redemption and Transfer Combined -->
          <div class="zvcoins-balance-code-section mb-6">
            <div class="zvcoins-combined-card">
              <!-- Code Redemption Area -->
              <div class="zvcoins-code-area">
                <div class="zvcoins-code-header">
                  <div class="zvcoins-code-icon">ğŸ«</div>
                  <div class="zvcoins-code-info">
                    <p class="zvcoins-code-label">Code einlÃ¶sen</p>
                  </div>
                </div>

                <!-- Code Info Tip -->
                <div class="zvcoins-code-tip">
                  <div class="code-tip-icon">ğŸ’¡</div>
                  <div class="code-tip-text">
                    Codes kannst du auf unserem
                    <strong>Discord-Server</strong> oder bei speziellen Events gewinnen!!
                  </div>
                </div>

                <div class="zvcoins-code-input-section">
                  <div class="zvcoins-code-input-group">
                    <input
                      type="text"
                      [(ngModel)]="redeemCode"
                      placeholder="Gib deinen Code hier ein..."
                      class="zvcoins-code-input"
                      (keyup.enter)="redeemCodeAction()"
                      [disabled]="codeRedemptionLoading"
                    />
                    <button
                      class="zvcoins-code-btn"
                      (click)="redeemCodeAction()"
                      [disabled]="!redeemCode || codeRedemptionLoading"
                    >
                      <span *ngIf="!codeRedemptionLoading">ğŸ EinlÃ¶sen</span>
                      <span *ngIf="codeRedemptionLoading">â³ Wird eingelÃ¶st...</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Vertical Divider -->
              <div class="zvcoins-divider"></div>

              <!-- ZVC Transfer Area -->
              <div class="zvcoins-transfer-area">
                <div class="zvcoins-transfer-header">
                  <div class="zvcoins-transfer-icon">ğŸ’¸</div>
                  <div class="zvcoins-transfer-info">
                    <p class="zvcoins-transfer-label">Zeitvertreib Coins senden</p>
                  </div>
                </div>

                <!-- Transaction Tax Disclaimer -->
                <div class="zvcoins-transfer-disclaimer">
                  <div class="transfer-disclaimer-icon">âš ï¸</div>
                  <div class="transfer-disclaimer-text">
                    <strong>TransaktionsgebÃ¼hr:</strong> Auf jede Transaktion wird eine 10% Steuer erhoben.
                    <strong>Mindestbetrag:</strong> 100 ZVC.
                  </div>
                </div>

                <!-- Transfer Cost Info -->
                <div *ngIf="transferAmount && transferAmount > 0" class="zvcoins-transfer-cost-info">
                  <div class="transfer-cost-item">
                    <span class="cost-label">Betrag:</span>
                    <span class="cost-value">{{ transferAmount }} ZVC</span>
                  </div>
                  <div class="transfer-cost-item">
                    <span class="cost-label">Steuer (10%):</span>
                    <span class="cost-value">{{ getTransferTax(transferAmount) }} ZVC</span>
                  </div>
                  <div class="transfer-cost-item transfer-cost-total">
                    <span class="cost-label">Gesamt:</span>
                    <span class="cost-value">{{ getTransferTotalCost(transferAmount) }} ZVC</span>
                  </div>
                </div>

                <div class="zvcoins-transfer-input-section">
                  <div class="zvcoins-transfer-input-group">
                    <input
                      type="text"
                      [(ngModel)]="transferRecipient"
                      placeholder="Steam ID oder Benutzername"
                      class="zvcoins-transfer-input zvcoins-transfer-recipient"
                      [disabled]="transferLoading"
                    />
                    <input
                      type="text"
                      [(ngModel)]="transferAmount"
                      placeholder="Betrag"
                      class="zvcoins-transfer-input zvcoins-transfer-amount"
                      [disabled]="transferLoading"
                    />
                    <button
                      class="zvcoins-transfer-btn"
                      (click)="transferZVC()"
                      [disabled]="
                        !transferRecipient ||
                        !transferAmount ||
                        transferAmount <= 0 ||
                        transferAmount < 100 ||
                        transferAmount > 50000 ||
                        getTransferTotalCost(transferAmount) > (userStatistics.experience || 0) ||
                        transferLoading
                      "
                    >
                      <span *ngIf="!transferLoading">ğŸ’¸ Senden</span>
                      <span *ngIf="transferLoading">â³ Wird gesendet...</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message displays outside the card for better visibility -->
            <div
              *ngIf="codeRedemptionMessage"
              class="zvcoins-message mt-3"
              [class.success]="codeRedemptionSuccess"
              [class.error]="!codeRedemptionSuccess"
            >
              {{ codeRedemptionMessage }}
            </div>
            <div
              *ngIf="transferMessage"
              class="zvcoins-message mt-3"
              [class.success]="transferSuccess"
              [class.error]="!transferSuccess"
            >
              {{ transferMessage }}
            </div>
          </div>

          <!-- Games Section: Slot Machine and Coming Soon -->
          <div class="zvcoins-balance-code-section mb-6">
            <div class="zvcoins-games-card">
              <!-- Slot machine-->
              <div class="slot-machine-widget">
                <div class="slot-machine-header">
                  <h4 class="zvcoins-section-title">ğŸ° Slotmaschine</h4>
                </div>

                <div class="slotcontainer">
                  <div class="slot">
                    <div class="symbols" id="slot1Symbols"></div>
                  </div>

                  <div class="slot">
                    <div class="symbols" id="slot2Symbols"></div>
                  </div>

                  <div class="slot">
                    <div class="symbols" id="slot3Symbols"></div>
                  </div>
                </div>

                <!-- Inline Compact Payout Info -->
                <div *ngIf="slotMachineInfo" class="slot-payout-compact">
                  <div class="payout-compact-grid">
                    <div
                      *ngFor="let entry of slotMachineInfo.payoutTable"
                      class="payout-compact-entry"
                      [class.jackpot-entry]="entry.tier === 'jackpot'"
                      [class.big-win-entry]="entry.tier === 'big_win'"
                    >
                      <span class="payout-compact-symbol">{{ entry.symbol }}</span>
                      <span class="payout-compact-condition">{{ entry.condition }}</span>
                      <span class="payout-compact-amount">+{{ entry.payout }}</span>
                    </div>
                  </div>
                </div>

                <div class="slot-machine-controls">
                  <button
                    (click)="testSlotMachine()"
                    class="slot-machine-btn slot-spin-btn"
                    [disabled]="isSpinning || !canAffordSlotMachine()"
                    [class.spinning]="isSpinning"
                    [class.disabled]="!canAffordSlotMachine()"
                  >
                    <span class="btn-text" *ngIf="!isSpinning && canAffordSlotMachine()">ğŸ° Start!!! ğŸ°</span>
                    <span class="btn-text" *ngIf="!isSpinning && !canAffordSlotMachine()">âŒ Nicht genug ZVC âŒ</span>
                    <span class="btn-text" *ngIf="isSpinning">ğŸ° Dreht... ğŸ°</span>
                    <span class="btn-cost">ğŸª™ {{ slotMachineInfo?.cost || 10 }} ZVC</span>
                  </button>

                  <button
                    (click)="toggleAutoSpin()"
                    class="slot-machine-btn slot-autospin-btn"
                    [class.active]="autoSpinEnabled"
                    [disabled]="!canAffordSlotMachine()"
                  >
                    <span class="btn-text" *ngIf="autoSpinEnabled">â¹ï¸ Stoppen</span>

                    <span class="btn-text" *ngIf="!autoSpinEnabled">ğŸ”„ Auto</span>
                  </button>
                </div>

                <!-- Status Messages -->
                <div *ngIf="slotMachineMessage" class="slot-machine-message">
                  {{ slotMachineMessage }}
                </div>
                <div *ngIf="slotMachineError" class="slot-machine-error">
                  {{ slotMachineError }}
                </div>

                <!-- Win Log -->
                <div *ngIf="slotWinLog.length > 0" class="slot-win-log">
                  <div class="win-log-header">
                    <span class="win-log-title">ğŸ“œ Letzte Spins</span>
                    <div class="win-log-header-controls">
                      <label class="win-log-toggle">
                        <input type="checkbox" [(ngModel)]="hideLosses" class="toggle-checkbox" />
                        <span class="toggle-slider"></span>
                      </label>
                      <span class="win-log-count">{{ getFilteredWinLog().length }}</span>
                    </div>
                  </div>
                  <div class="win-log-list">
                    <div
                      *ngFor="let entry of getFilteredWinLog(); trackBy: trackByWinLogId"
                      class="win-log-entry"
                      [class.win-log-jackpot]="entry.winType === 'jackpot'"
                      [class.win-log-big-win]="entry.winType === 'big_win'"
                      [class.win-log-win]="entry.winType === 'small_win' || entry.winType === 'mini_win'"
                      [class.win-log-loss]="entry.winType === 'loss'"
                    >
                      <div class="win-log-symbols">
                        <span class="win-symbol">{{ entry.symbols[0] }}</span>
                        <span class="win-symbol">{{ entry.symbols[1] }}</span>
                        <span class="win-symbol">{{ entry.symbols[2] }}</span>
                      </div>
                      <div class="win-log-info">
                        <span class="win-log-type" [style.color]="getWinTypeInfo(entry.winType).color">
                          {{ getWinTypeInfo(entry.winType).emoji }}
                          {{ getWinTypeInfo(entry.winType).label }}
                        </span>
                        <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
                      </div>
                      <div class="win-log-payout" [class.negative]="entry.payout === 0">
                        <span class="payout-amount"> {{ entry.payout > 0 ? '+' : '' }}{{ entry.payout }} </span>
                        <span class="payout-cost" *ngIf="entry.payout > 0">-{{ slotMachineInfo?.cost || 10 }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Lucky Wheel Widget -->
              <div class="lucky-wheel-widget">
                <div class="lucky-wheel-header">
                  <h4 class="zvcoins-section-title">ğŸ¡ GlÃ¼cksrad</h4>
                </div>

                <!-- Loading State -->
                <div *ngIf="!luckyWheelInfo && !luckyWheelError" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-4"></div>
                  <p class="text-lg text-white">Lade GlÃ¼cksrad...</p>
                </div>

                <!-- Error State -->
                <div *ngIf="luckyWheelError && !luckyWheelInfo" class="text-center py-8">
                  <div class="text-red-400 mb-4">âš ï¸</div>
                  <p class="text-red-400">{{ luckyWheelError }}</p>
                  <button
                    (click)="loadLuckyWheelInfo()"
                    class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
                  >
                    Erneut versuchen
                  </button>
                </div>

                <!-- Lucky Wheel Content -->
                <div *ngIf="luckyWheelInfo">
                  <!-- Lucky Wheel SVG -->
                  <div class="wheel-container">
                    <svg
                      class="lucky-wheel-svg"
                      [class.spinning]="isWheelSpinning"
                      [style.transform]="'rotate(' + wheelRotation + 'deg)'"
                      viewBox="0 0 200 200"
                    >
                      <!-- Wheel segments -->
                      <g *ngFor="let segment of getWheelSegments(); let i = index">
                        <path
                          class="wheel-segment"
                          [attr.d]="
                            'M 100 100 L ' +
                            (100 + 100 * Math.cos((((i * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                            ' ' +
                            (100 + 100 * Math.sin((((i * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                            ' A 100 100 0 0 1 ' +
                            (100 + 100 * Math.cos(((((i + 1) * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                            ' ' +
                            (100 + 100 * Math.sin(((((i + 1) * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                            ' Z'
                          "
                          [attr.fill]="segment.color"
                          stroke="rgba(0,0,0,0.3)"
                          stroke-width="1"
                          [class.wheel-segment-active]="winningSegmentIndex === i && showWheelResult"
                        />
                      </g>

                      <!-- Logo image in center -->
                      <defs>
                        <clipPath id="circleClip">
                          <circle cx="100" cy="100" r="22" />
                        </clipPath>
                      </defs>
                      <image
                        *ngIf="!(lastWheelMultiplier !== null && showWheelResult)"
                        href="assets/logos/logo_full_color_1to1.png"
                        x="78"
                        y="78"
                        width="44"
                        height="44"
                        clip-path="url(#circleClip)"
                      />

                      <!-- Result display circle -->
                      <circle
                        *ngIf="lastWheelMultiplier !== null && showWheelResult"
                        cx="100"
                        cy="100"
                        r="22"
                        fill="rgba(0,0,0,0.9)"
                      />
                      <text
                        *ngIf="lastWheelMultiplier !== null && showWheelResult"
                        x="100"
                        y="100"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        fill="white"
                        font-size="14"
                        font-weight="bold"
                      >
                        {{ lastWheelMultiplier + 'x' }}
                      </text>
                    </svg>

                    <!-- Pointer arrow at top -->
                    <div class="wheel-pointer"></div>
                  </div>

                  <!-- Multiplier Legend (compact colored badges) -->
                  <div class="wheel-multiplier-legend">
                    <div
                      *ngFor="let entry of luckyWheelInfo.payoutTable; let i = index"
                      class="legend-badge"
                      [style.background-color]="getMultiplierColor(entry.multiplier)"
                    >
                      {{ entry.multiplier }}x
                    </div>
                  </div>

                  <!-- Bet Controls -->
                  <div class="wheel-bet-controls">
                    <div class="wheel-bet-display">
                      <button
                        (click)="adjustLuckyWheelBet(-10)"
                        class="wheel-bet-btn"
                        [disabled]="luckyWheelLoading || luckyWheelBet <= luckyWheelInfo.minBet"
                      >
                        âˆ’
                      </button>
                      <div class="wheel-bet-amount">
                        <label class="bet-label" for="wheelBetInput">Einsatz</label>
                        <div class="bet-input-wrapper">
                          <input
                            id="wheelBetInput"
                            class="bet-input"
                            type="text"
                            inputmode="numeric"
                            pattern="[0-9]*"
                            [value]="luckyWheelBetInput"
                            (input)="onLuckyWheelBetInput($event)"
                            (keydown)="onLuckyWheelBetKeydown($event)"
                            (blur)="commitLuckyWheelBetInput()"
                            (keydown.enter)="commitLuckyWheelBetInput(); $event.preventDefault()"
                            [disabled]="luckyWheelLoading"
                            [attr.min]="luckyWheelInfo.minBet"
                            [attr.max]="luckyWheelInfo.maxBet"
                          />
                          <span class="bet-unit">ZVC</span>
                        </div>
                      </div>
                      <button
                        (click)="adjustLuckyWheelBet(10)"
                        class="wheel-bet-btn"
                        [disabled]="luckyWheelLoading || luckyWheelBet >= luckyWheelInfo.maxBet"
                      >
                        +
                      </button>
                    </div>

                    <button
                      (click)="spinLuckyWheel()"
                      class="wheel-spin-btn"
                      [class.spinning]="isWheelSpinning"
                      [disabled]="!canAffordLuckyWheel() || luckyWheelLoading"
                    >
                      <span class="btn-icon">ğŸ¡</span>
                      <span class="btn-text">{{ isWheelSpinning ? 'Dreht...' : 'Drehen!' }}</span>
                    </button>

                    <button
                      (click)="toggleAutoWheelSpin()"
                      class="wheel-autospin-btn"
                      [class.active]="autoWheelSpinEnabled"
                      [disabled]="!luckyWheelInfo"
                      title="{{ autoWheelSpinEnabled ? 'Auto-Spin deaktivieren' : 'Auto-Spin aktivieren' }}"
                    >
                      <span *ngIf="!autoWheelSpinEnabled">ğŸ”„ Auto</span>
                      <span *ngIf="autoWheelSpinEnabled">â¹ï¸ Stopp</span>
                    </button>
                  </div>

                  <!-- Status Messages -->
                  <div *ngIf="luckyWheelError && luckyWheelInfo" class="wheel-error">
                    {{ luckyWheelError }}
                  </div>

                  <!-- Lucky Wheel Spin Log -->
                  <div *ngIf="luckyWheelSpinLog.length > 0" class="slot-win-log wheel-spin-log">
                    <div class="win-log-header">
                      <span class="win-log-title">ğŸ“œ Letzte Wheel-Spins</span>
                      <div class="win-log-header-controls">
                        <label class="win-log-toggle" title="Verluste ausblenden">
                          <input type="checkbox" [(ngModel)]="hideWheelLosses" class="toggle-checkbox" />
                          <span class="toggle-slider"></span>
                        </label>
                        <span class="win-log-count">{{ getFilteredWheelSpinLog().length }}</span>
                      </div>
                    </div>
                    <div class="win-log-list">
                      <div
                        *ngFor="let entry of getFilteredWheelSpinLog(); trackBy: trackByWheelSpinId"
                        class="win-log-entry"
                        [class.win-log-win]="entry.payout > 0"
                        [class.win-log-loss]="entry.payout === 0"
                      >
                        <div class="win-log-symbols">
                          <span class="legend-badge" [style.background-color]="getMultiplierColor(entry.multiplier)"
                            >{{ entry.multiplier }}x</span
                          >
                        </div>
                        <div class="win-log-info">
                          <span class="win-log-type" [style.color]="getWheelSpinTypeInfo(entry).color">
                            {{ getWheelSpinTypeInfo(entry).emoji }}
                            {{ getWheelSpinTypeInfo(entry).label }}
                          </span>
                          <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
                        </div>
                        <div class="win-log-payout" [class.negative]="entry.payout === 0">
                          <span class="payout-amount"> {{ entry.payout > 0 ? '+' : '' }}{{ entry.payout }} </span>
                          <span class="wheel-log-bet">-{{ entry.bet }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Redeemable Items -->
          <div class="zvcoins-rewards-section mb-4">
            <h4 class="zvcoins-section-title">ğŸ Belohnungen einlÃ¶sen</h4>

            <!-- Loading State -->
            <div *ngIf="redeemablesLoading" class="text-center py-8">
              <div class="loading-spinner mx-auto mb-4"></div>
              <p class="text-lg text-white">Lade Belohnungen...</p>
            </div>

            <!-- Error State -->
            <div *ngIf="redeemablesError && !redeemablesLoading" class="text-center py-8">
              <div class="text-red-400 mb-4">âš ï¸</div>
              <p class="text-red-400">{{ redeemablesError }}</p>
              <button
                (click)="loadRedeemables()"
                class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
              >
                Erneut versuchen
              </button>
            </div>

            <!-- Redeemables Grid -->
            <div *ngIf="!redeemablesLoading && !redeemablesError" class="zvcoins-rewards-grid">
              <div
                *ngFor="let redeemable of redeemables"
                class="zvcoins-reward-card"
                [class.zvcoins-affordable]="canAfford(redeemable.price) && isAvailable(redeemable)"
                [class.zvcoins-limited-time]="isLimitedTime(redeemable)"
                [class.zvcoins-expired]="isExpired(redeemable)"
                [class.zvcoins-sold-out]="isSoldOut(redeemable)"
              >
                <!-- Limited Time Badge -->
                <div
                  *ngIf="isLimitedTime(redeemable) && !isExpired(redeemable) && !isSoldOut(redeemable)"
                  class="zvcoins-limited-badge"
                >
                  â° Limitiert: {{ getTimeLeft(redeemable.redeemableuntil) }}
                </div>

                <!-- Expired Badge -->
                <div *ngIf="isExpired(redeemable)" class="zvcoins-expired-badge">âŒ Nicht mehr verfÃ¼gbar</div>

                <!-- Sold Out Badge -->
                <div *ngIf="isSoldOut(redeemable)" class="zvcoins-sold-out-badge">ğŸš« Ausverkauft</div>

                <div class="zvcoins-reward-header">
                  <div class="zvcoins-reward-icon-large">
                    {{ redeemable.emoji }}
                  </div>
                  <div class="zvcoins-reward-details">
                    <h5 class="zvcoins-reward-title">
                      {{ redeemable.name }}
                    </h5>
                    <p class="zvcoins-reward-description">
                      {{ redeemable.description }}
                    </p>
                  </div>
                  <div class="zvcoins-reward-price">
                    <span class="zvcoins-price-amount">{{ redeemable.price | number: '1.0-0' }}</span>
                    <span class="zvcoins-price-currency">ZVC</span>
                  </div>
                </div>
                <div class="zvcoins-reward-progress">
                  <div class="zvcoins-progress-container">
                    <div class="zvcoins-progress-track">
                      <div
                        class="zvcoins-progress-bar-fill"
                        [style.width.%]="getProgressPercentage(userStatistics.experience || 0, redeemable.price)"
                      ></div>
                    </div>
                    <span class="zvcoins-progress-text">
                      {{ getProgressPercentage(userStatistics.experience || 0, redeemable.price) | number: '1.0-0' }}%
                    </span>
                  </div>
                  <button
                    class="zvcoins-redeem-btn"
                    [disabled]="!canRedeem(redeemable)"
                    [class.zvcoins-redeem-available]="canRedeem(redeemable)"
                    [class.zvcoins-expired]="isExpired(redeemable)"
                    [class.zvcoins-sold-out]="isSoldOut(redeemable)"
                    (click)="redeemItem(redeemable)"
                  >
                    {{ getAvailabilityText(redeemable) }}
                  </button>
                </div>
              </div>

              <!-- No redeemables available message -->
              <div *ngIf="redeemables.length === 0" class="text-center py-8 col-span-full">
                <div class="text-6xl mb-4">ğŸ</div>
                <p class="text-lg text-gray-300">Keine Belohnungen verfÃ¼gbar</p>
                <p class="text-sm text-gray-400 mt-2">Schau spÃ¤ter wieder vorbei!</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Sprays -->
      <div class="grid-item spray-card-container">
        <div class="stats-card p-6 rounded-2xl">
          <div class="spray-header">
            <h3 class="spray-title">ğŸ¨ Custom Sprays</h3>
            <p class="spray-subtitle">Bis zu {{ isDonator ? '3' : '2' }} Sprays hochladen</p>
          </div>

          <div class="spray-grid">
            <div *ngFor="let slot of spraySlots; let i = index" class="spray-item">
              <!-- Locked Slot -->
              <div *ngIf="i === 2 && !isDonator" class="spray-locked">
                <p class="spray-locked-title">ğŸ”’ Extra Slot</p>
                <p class="spray-locked-text">Exklusiv fÃ¼r UnterstÃ¼tzer!</p>
                <a href="https://ko-fi.com/zeitvertreib" target="_blank" class="spray-unlock-link"> Freischalten </a>
              </div>

              <!-- Uploaded Spray -->
              <div *ngIf="(i < 2 || isDonator) && slot.id && !slot.selectedFile" class="spray-uploaded">
                <img [src]="slot.imageUrl" [alt]="slot.name" class="spray-image" />
                <div class="spray-info">
                  <span class="spray-name">{{ slot.name }}</span>
                  <button (click)="deleteSprayForSlot(i)" class="spray-delete-btn" [disabled]="slot.isUploading">
                    <span *ngIf="!slot.isUploading">ğŸ—‘ï¸</span>
                    <span *ngIf="slot.isUploading" class="spray-spinner"></span>
                  </button>
                </div>
              </div>

              <!-- Preview & Upload (opens modal for better UX) -->
              <div
                *ngIf="(i < 2 || isDonator) && slot.selectedFile && !previewModalOpen && !slot.isUploading"
                class="spray-preview"
              >
                <div class="spray-preview-compact">
                  <img [src]="slot.preview" alt="Preview" class="spray-image" />
                </div>
              </div>

              <!-- Uploading State -->
              <div *ngIf="slot.isUploading && !slot.id" class="spray-uploading-state">
                <div class="spray-spinner-large"></div>
                <div class="spray-uploading-text">Wird hochgeladen...</div>
              </div>

              <!-- Empty Slot -->
              <div *ngIf="(i < 2 || isDonator) && !slot.id && !slot.selectedFile" class="spray-empty">
                <input
                  type="file"
                  [id]="'spray' + i"
                  accept="image/png,image/jpeg,image/jpg,image/webp"
                  (change)="onSprayFileSelected($event, i)"
                  class="spray-file-input"
                />
                <label [for]="'spray' + i" class="spray-upload-zone">
                  <div class="spray-upload-icon">ğŸ“</div>
                  <div class="spray-upload-text">Bild wÃ¤hlen</div>
                </label>
              </div>
            </div>
          </div>

          <div *ngIf="sprayError" class="spray-message spray-message-error">{{ sprayError }}</div>
          <div *ngIf="spraySuccess" class="spray-message spray-message-success">{{ spraySuccess }}</div>
        </div>
      </div>

      <div class="preview-overlay" *ngIf="previewModalOpen" (click)="closePreviewModal(true)">
        <div
          class="preview-modal redesign"
          (click)="$event.stopPropagation()"
          [style.--accent-color]="previewModalAccentColor"
        >
          <div class="modal-header">
            <div class="header-content">
              <span class="header-icon">ğŸ¨</span>
              <h3 class="preview-title">Spray konfigurieren</h3>
            </div>
            <button class="modal-close-btn" (click)="closePreviewModal(true)">âœ•</button>
          </div>

          <div class="modal-body redesign-body custom-scrollbar">
            <!-- Left Column: Image (1/3) -->
            <div class="preview-left">
              <div class="preview-image-container">
                <img [src]="previewModalUrl" alt="Spray Preview" class="preview-large-image" />
              </div>
            </div>

            <!-- Right Column: Controls (2/3) -->
            <div class="preview-right">
              <div class="preview-input-group">
                <label for="sprayName">Name deines Sprays (max. 20 Zeichen, nur A-Z, 0-9, _, Leerzeichen)</label>
                <input
                  id="sprayName"
                  type="text"
                  class="spray-name-input-large"
                  [(ngModel)]="previewModalName"
                  placeholder="z.B. Mein cooles Spray"
                  maxlength="20"
                  [class.invalid-input]="previewModalName && !isNameValid(previewModalName)"
                />
                <div *ngIf="previewModalName && !isNameValid(previewModalName)" class="input-error-hint">
                  Nur Buchstaben, Zahlen, Unterstriche und Leerzeichen erlaubt.
                </div>
              </div>

              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="privacyCheck"
                    [(ngModel)]="acceptedPrivacy"
                    (change)="acceptedPrivacy ? (showPrivacyText = false) : null"
                  />
                  <label for="privacyCheck">
                    Ich akzeptiere die
                    <span class="text-link" (click)="showPrivacyText = !showPrivacyText; $event.preventDefault()">
                      Datenschutzhinweise
                    </span>
                  </label>
                </div>
                <div *ngIf="showPrivacyText" class="info-box-inline">
                  <div class="info-content">
                    <ul>
                      <li>
                        <strong>Ã–ffentliche VerfÃ¼gbarkeit:</strong> Dein Bild wird Ã¶ffentlich zugÃ¤nglich und kann an
                        unseren Discord-Server (USA) Ã¼bertragen werden.
                      </li>
                      <li>
                        <strong>DatenlÃ¶schung:</strong> Eine LÃ¶schung garantiert keine vollstÃ¤ndige Entfernung aus
                        Backups, Caches oder Drittsystemen.
                      </li>
                      <li>
                        <strong>Moderation:</strong> Bilder werden automatisiert mittels OpenAI (omni-moderation-latest)
                        geprÃ¼ft.
                      </li>
                      <li>
                        <strong>MaÃŸnahmen:</strong> Wir behalten uns vor, Bilder jederzeit zu lÃ¶schen und Accounts bei
                        VerstÃ¶ÃŸen zu sperren.
                      </li>
                      <li>
                        <strong>EinverstÃ¤ndnis:</strong> Mit dem Upload erklÃ¤rst du dich mit diesen Bedingungen
                        einverstanden.
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="rulesCheck"
                    [(ngModel)]="acceptedRules"
                    (change)="acceptedRules ? (showRulesText = false) : null"
                  />
                  <label for="rulesCheck">
                    Ich bestÃ¤tige, dass ich die
                    <span class="text-link" (click)="showRulesText = !showRulesText; $event.preventDefault()">
                      Inhaltsregeln
                    </span>
                    respektiere
                  </label>
                </div>
                <div *ngIf="showRulesText" class="info-box-inline">
                  <div class="info-content">
                    <div class="rule-section">
                      <h5>I. UnzulÃ¤ssige Inhalte</h5>
                      <p>Keine Pornographie, Erotik, Nacktheit oder politische Inhalte jeglicher Art.</p>
                    </div>
                    <div class="rule-section">
                      <h5>II. Flaggen</h5>
                      <p>Nur UN-anerkannte Staatsflaggen oder neutrale EigenentwÃ¼rfe erlaubt.</p>
                    </div>
                    <div class="rule-section">
                      <h5>III. Verhalten</h5>
                      <p>Kein Hass, keine Diskriminierung oder Beleidigungen.</p>
                    </div>
                    <div class="rule-section">
                      <h5>IV. Personen</h5>
                      <p>Abbildungen von Kindern oder Jugendlichen (auch wirkend) sind strikt untersagt.</p>
                    </div>
                    <div class="rule-section">
                      <h5>V. Konsequenzen</h5>
                      <p>VerstÃ¶ÃŸe fÃ¼hren zur sofortigen Accountsperrung ohne Vorwarnung.</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="upload-action">
                <button
                  class="btn-upload-confirm-large"
                  (click)="confirmUploadFromModal()"
                  [disabled]="
                    previewModalUploading || !isNameValid(previewModalName) || !acceptedPrivacy || !acceptedRules
                  "
                >
                  <span *ngIf="!previewModalUploading">ğŸš€ Jetzt hochladen</span>
                  <span *ngIf="previewModalUploading" class="spinner-small"></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fakerank Card -->
      <div class="grid-item fakerank-container">
        <div id="fakerank-card" class="stats-card p-6 rounded-2xl auto-height">
          <!-- Help Popup (replaces entire card content when shown) -->
          <div *ngIf="showFakerankHelp" class="help-popup h-full">
            <div class="help-content h-full">
              <div class="help-title">Fakerank - Dein persÃ¶nlicher Spitzname! âœ¨</div>
              <div class="help-text">
                Ein Fakerank ist einfach ein cooler Spitzname, den du dir selbst geben kannst! Es hat nichts mit deinem
                echten Rang im Spiel zu tun - es ist nur zur Dekoration und macht dein Profil persÃ¶nlicher.
              </div>
              <div class="help-text">
                <strong>Wann kannst du es nutzen?</strong><br />
                Jederzeit! Sei kreativ - ob "Pizza Liebhaber", "Sniper Pro" oder "Chaos KÃ¶nig" - es ist dein
                persÃ¶nlicher Touch.
              </div>
              <div class="help-text">
                <strong>Tipp:</strong> WÃ¤hle etwas, das deine PersÃ¶nlichkeit oder deinen Spielstil widerspiegelt. Andere
                Spieler werden es sehen kÃ¶nnen!
              </div>
              <button (click)="showFakerankHelp = false" class="help-close-btn">Verstanden! âœ¨</button>
            </div>
          </div>

          <!-- Regular Card Content -->
          <div *ngIf="!showFakerankHelp">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2 justify-between cardHeader">
              <div class="flex items-center gap-2">
                âœ¨ <span>Fakerank</span>
                <!-- Timer Badge -->
                <span *ngIf="fakerankTimeRemaining > 0" class="fakerank-timer-badge">
                  {{ formatTimeRemaining(fakerankTimeRemaining) }}
                </span>
                <!-- Admin Badge -->
                <span *ngIf="authService.isFakerankAdmin()" class="fakerank-admin-badge"> Admin </span>
              </div>
              <div class="flex items-center gap-2">
                <button (click)="showFakerankHelp = true" class="help-button" title="Was ist ein Fakerank?">?</button>
              </div>
            </h3>

            <!-- Display Mode -->
            <div *ngIf="!isEditingFakerank" class="fakerank-display">
              <!-- Check if user can edit fakeranks -->
              <div *ngIf="fakerankAllowed">
                <!-- Show override info if user has override (but can still edit) -->
                <div *ngIf="hasFakerankOverride && !isFakerankReadOnly" class="override-info-banner">
                  <div class="override-banner-icon">ğŸ›¡ï¸</div>
                  <div class="override-banner-text">
                    <span class="override-banner-title">Admin-Override aktiv</span>
                    <span class="override-banner-subtitle" *ngIf="fakerankOverrideTimeRemaining > 0">
                      Du kannst trotzdem bearbeiten Â· Verbleibt:
                      {{ formatTimeRemaining(fakerankOverrideTimeRemaining) }}
                    </span>
                  </div>
                </div>

                <div class="nickname-container mb-4">
                  <div class="nickname-preview" [class.nickname-empty]="!currentFakerank">
                    <div *ngIf="currentFakerank" class="nickname-display">
                      <div class="nickname-icon">âœ¨</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Dein Spitzname:</span>
                        <span class="nickname-value" [style.color]="getColorHex(currentFakerankColor)">{{
                          currentFakerank
                        }}</span>
                        <div class="nickname-color-info">
                          <span
                            class="color-indicator"
                            [style.background-color]="getColorHex(currentFakerankColor)"
                          ></span>
                          {{ getColorName(currentFakerankColor) }}
                        </div>
                      </div>
                    </div>
                    <div *ngIf="!currentFakerank" class="nickname-empty-state">
                      <div class="nickname-icon">ğŸ’­</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Noch kein Spitzname</span>
                        <span class="nickname-subtitle">Gib dir einen coolen Namen!</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="fakerank-actions">
                  <button
                    (click)="startEditingFakerank()"
                    class="fakerank-btn fakerank-btn-primary"
                    [disabled]="fakerankLoading"
                  >
                    {{ currentFakerank ? 'âœï¸ Ã„ndern' : 'â• Erstellen' }}
                  </button>
                  <button
                    *ngIf="currentFakerank"
                    (click)="deleteFakerank()"
                    class="fakerank-btn fakerank-btn-danger"
                    [disabled]="fakerankLoading"
                  >
                    ğŸ—‘ï¸ LÃ¶schen
                  </button>
                </div>
              </div>

              <!-- Override fakerank (read-only, set by admin) -->
              <div *ngIf="isFakerankReadOnly" class="fakerank-override">
                <div class="nickname-container mb-4">
                  <div class="nickname-preview" [class.nickname-empty]="!currentFakerank">
                    <div *ngIf="currentFakerank" class="nickname-display override-display">
                      <div class="nickname-icon">ğŸ”’</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Admin-Spitzname:</span>
                        <span class="nickname-value" [style.color]="getColorHex(currentFakerankColor)">{{
                          currentFakerank
                        }}</span>
                      </div>
                      <div class="override-badge">
                        <span class="override-text">Override</span>
                        <span class="override-timer" *ngIf="fakerankOverrideTimeRemaining > 0">
                          {{ formatTimeRemaining(fakerankOverrideTimeRemaining) }}
                        </span>
                      </div>
                    </div>
                    <div *ngIf="!currentFakerank" class="nickname-empty-display">
                      <div class="nickname-icon">ğŸ”’</div>
                      <span class="nickname-placeholder">Admin kann dir einen Spitzname zuweisen</span>
                    </div>
                  </div>
                </div>

                <div class="override-info">
                  <div class="override-icon">ğŸ›¡ï¸</div>
                  <div class="override-message">
                    <p class="override-title">Admin-Override aktiv</p>
                    <p class="override-text">
                      Dein Spitzname wurde von einem Admin gesetzt und kann nicht bearbeitet werden.
                      <span *ngIf="fakerankOverrideTimeRemaining > 0">
                        Verbleibt:
                        <strong>{{ formatTimeRemaining(fakerankOverrideTimeRemaining) }}</strong>
                      </span>
                    </p>
                  </div>
                </div>
              </div>

              <!-- Not allowed message -->
              <div *ngIf="!fakerankAllowed" class="fakerank-not-allowed">
                <div class="not-allowed-icon">ğŸ”’</div>
                <div class="not-allowed-message">
                  <p class="not-allowed-title">Noch nicht freigeschaltet!</p>
                  <p class="not-allowed-text">
                    Du bist noch nicht fÃ¼r diese Zeitvertreib-Funktion freigeschaltet! Du kannst entweder den
                    Discord-Server
                    <strong>boosten</strong>, Ã¼ber
                    <strong style="white-space: nowrap">ko-fi.com</strong>
                    spenden oder durch sehr aktives Spielen auf dem SCP-Server
                    <strong>VIP</strong> werden.
                  </p>
                  <p class="not-allowed-link">
                    Tritt dem Discord unter
                    <a href="https://dsc.gg/zeit" style="text-decoration: none"><strong>dsc.gg/zeit</strong></a>
                    bei fÃ¼r weitere Informationen.
                  </p>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div *ngIf="isEditingFakerank && fakerankAllowed" class="fakerank-edit">
              <div class="nickname-editor mb-4">
                <label class="editor-label"> âœ¨ Dein neuer Spitzname </label>
                <div class="fakerank-input-container">
                  <input
                    type="text"
                    [(ngModel)]="fakerankValue"
                    placeholder="z.B. Pizza Liebhaber, Sniper Pro, Chaos KÃ¶nig..."
                    maxlength="50"
                    class="nickname-input"
                    [disabled]="fakerankLoading"
                    [style.color]="getColorHex(tempFakerankColor)"
                    (keydown)="onKeyDown($event)"
                    (keyup.enter)="saveFakerank()"
                    (keyup.escape)="cancelEditingFakerank()"
                  />
                  <div class="fakerank-char-count">{{ fakerankValue.length }}/50</div>
                </div>

                <!-- Color Picker Section -->
                <div class="color-picker-section mt-3">
                  <label class="editor-label">ğŸ¨ Farbe wÃ¤hlen</label>
                  <div class="color-picker-container">
                    <button (click)="toggleColorPicker()" class="color-selector-button" [disabled]="fakerankLoading">
                      <span class="color-indicator" [style.background-color]="getColorHex(tempFakerankColor)"></span>
                      {{ getColorName(tempFakerankColor) }}
                      <span class="dropdown-arrow">{{ showColorPicker ? 'â–²' : 'â–¼' }}</span>
                    </button>

                    <div *ngIf="showColorPicker" class="color-picker-dropdown">
                      <div class="color-options">
                        <button
                          *ngFor="let color of fakerankColors"
                          (click)="selectColor(color.key)"
                          class="color-option"
                          [class.selected]="tempFakerankColor === color.key"
                        >
                          <span class="color-indicator" [style.background-color]="color.hex"></span>
                          <span class="color-name">{{ color.name }}</span>
                          <span *ngIf="tempFakerankColor === color.key" class="selected-check">âœ“</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="editor-hint">ğŸ’¡ Sei kreativ! Dies ist nur ein Spitzname zur Dekoration.</div>
              </div>
              <div class="fakerank-actions">
                <button
                  (click)="saveFakerank()"
                  class="fakerank-btn fakerank-btn-success"
                  [disabled]="fakerankLoading || fakerankValue.trim().length === 0"
                >
                  {{ fakerankLoading ? 'ğŸ’¾ Speichern...' : 'ğŸ’¾ Speichern' }}
                </button>
                <button
                  (click)="cancelEditingFakerank()"
                  class="fakerank-btn fakerank-btn-secondary"
                  [disabled]="fakerankLoading"
                >
                  âŒ Abbrechen
                </button>
              </div>
            </div>

            <!-- Success Message -->
            <div *ngIf="fakerankSuccess" class="fakerank-message fakerank-success mt-3">
              ğŸ‰ Spitzname erfolgreich gespeichert!
            </div>

            <!-- Error Message -->
            <div *ngIf="fakerankError" class="fakerank-message fakerank-error mt-3">
              {{ fakerankError }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

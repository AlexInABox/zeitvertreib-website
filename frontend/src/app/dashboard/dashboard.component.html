<div class="dashboard-container">
  <div class="grid grid-cols-3 grid-rows-6 gap-4 p-6 dashboard-grid relative z-10">

    <!-- Loading State -->
    <div *ngIf="isLoading" class="col-span-3 row-span-6 flex items-center justify-center">
      <div class="text-center text-white">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-xl font-medium">Lade Statistiken...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="col-span-3 row-span-6 flex items-center justify-center">
      <div class="error-message max-w-md">
        <h3 class="text-xl font-bold mb-2">Fehler beim Laden</h3>
        <p class="mb-4">{{ errorMessage }}</p>
        <button (click)="refreshStats()" class="refresh-button">
          Erneut versuchen
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <ng-container *ngIf="!isLoading && !hasError">

      <!-- Stats Overview -->
      <div class="col-span-2 row-span-1 stats-overview">
        <div class="stats-card p-6 rounded-2xl h-full">
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 h-full">

            <!-- Kills -->
            <div class="stat-item" style="--stat-color: #10b981; --stat-color-light: #34d399;">
              <div class="flex items-center gap-4">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0">
                  <h5 class="stat-label">AbschÃ¼sse</h5>
                  <p class="stat-value">
                    {{ userStatistics.kills | number:'1.0-0' }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Deaths -->
            <div class="stat-item" style="--stat-color: #3b82f6; --stat-color-light: #60a5fa;">
              <div class="flex items-center gap-4">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0">
                  <h5 class="stat-label">TodesfÃ¤lle</h5>
                  <p class="stat-value">
                    {{ userStatistics.deaths | number:'1.0-0' }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Experience -->
            <div class="stat-item" style="--stat-color: #f59e0b; --stat-color-light: #fbbf24;">
              <div class="flex items-center gap-4">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0">
                  <h5 class="stat-label">Erfahrung</h5>
                  <p class="stat-value">
                    {{ userStatistics.experience | number:'1.0-0' }}XP
                  </p>
                </div>
              </div>
            </div>

            <!-- K/D Ratio -->
            <div class="stat-item" style="--stat-color: #8b5cf6; --stat-color-light: #a78bfa;">
              <div class="flex items-center gap-4">
                <div class="stat-indicator"></div>
                <div class="flex-1 min-w-0">
                  <h5 class="stat-label">K/D Ratio</h5>
                  <p class="stat-value">
                    {{ kdRatio }}
                  </p>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Player Card -->
      <div class="col-span-1 row-span-3 player-card-container">
        <div class="player-card h-full">

          <!-- Avatar Header -->
          <div class="player-avatar-container" *ngIf="userStatistics?.avatarFull">
            <img class="player-avatar" [src]="getAvatarUrl(userStatistics.avatarFull)"
              [alt]="userStatistics.username || 'Player Avatar'" loading="lazy" (error)="onImageError($event)" />
          </div>

          <!-- Player Info -->
          <div class="p-6">
            <h2 class="text-2xl font-bold text-white mb-2">
              Willkommen zurÃ¼ck,<br>
              <span class="text-gradient">{{ userStatistics.username || 'Spieler' }}</span>
            </h2>

            <p class="text-lg text-gray-300 mb-6">
              {{ leaderboardText }}
            </p>

            <!-- Stats List -->
            <div class="space-y-3">
              <div class="player-info-item">
                <span class="player-info-label">Gespielte Runden:</span>
                <span class="player-info-value">{{ userStatistics.roundsplayed | number:'1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Spielzeit:</span>
                <span class="player-info-value">{{ playtimeFormatted }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Medkits:</span>
                <span class="player-info-value">{{ userStatistics.usedmedkits | number:'1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Getrunkene Colas:</span>
                <span class="player-info-value">{{ userStatistics.usedcolas | number:'1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Pocket Escapes:</span>
                <span class="player-info-value">{{ userStatistics.pocketescapes | number:'1.0-0' }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Adrenalin:</span>
                <span class="player-info-value">{{ userStatistics.usedadrenaline | number:'1.0-0' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="col-span-2 row-span-2 charts-container">
        <div class="stats-card p-6 rounded-2xl h-full">
          <h3 class="text-2xl font-bold text-white mb-4">Performance Ãœbersicht</h3>
          <div class="chart-placeholder">
            <div class="text-6xl mb-4">ğŸ“Š</div>
            <p class="text-lg">SchÃ¶ne Ãœbersichtsgrafiken kommen bald!</p>
            <p class="text-sm mt-2 opacity-75">Hier werden detaillierte Statistiken und Trends angezeigt</p>
          </div>
        </div>
      </div>

      <!-- Session History -->
      <div class="col-span-2 row-span-3 history-container">
        <div class="stats-card p-6 rounded-2xl h-full">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold text-white">Verlauf & Sitzungen</h3>
            <button (click)="refreshStats()" class="refresh-button">
              Aktualisieren
            </button>
          </div>
          <div class="chart-placeholder">
            <div class="text-6xl mb-4">ğŸ“ˆ</div>
            <p class="text-lg">KÃ¼rzliche Sitzungen und Verlauf</p>
            <p class="text-sm mt-2 opacity-75">Detaillierte Spielverlaufsdaten werden hier angezeigt</p>
          </div>
        </div>
      </div>

      <!-- Last Killers -->
      <div class="col-span-1 row-span-3 killers-container">
        <div class="stats-card p-6 rounded-2xl h-full">
          <h3 class="text-xl font-bold text-white mb-4">Diese Leute haben dich getÃ¶tet!</h3>

          <div *ngIf="!hasKillers" class="text-center py-8">
            <div class="text-4xl mb-4">ğŸ¯</div>
            <p class="text-gray-300">Noch keine Killer-Daten verfÃ¼gbar</p>
          </div>

          <div *ngIf="hasKillers" class="killers-list">
            <div *ngFor="let killer of userStatistics?.lastkillers; let i = index; trackBy: trackByKiller"
              class="killer-item">
              <img class="killer-avatar" [src]="getAvatarUrl(killer?.avatarmedium)"
                [alt]="killer?.displayname || 'Unknown Player'" loading="lazy" (error)="onImageError($event)" />
              <div class="flex-1 min-w-0">
                <p class="killer-name" [title]="killer?.displayname">
                  {{ truncateDisplayName(killer?.displayname) }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </ng-container>
  </div>
</div>
<!-- Games Page -->
<div class="games-page-wrapper">
  <!-- Games Grid -->
  <div class="zvcoins-games-card">
    <!-- Slot machine-->
    <div class="slot-machine-widget">
      <div class="slot-machine-header">
        <h4 class="zvcoins-section-title">üé∞ Slotmaschine</h4>
      </div>

      <div class="slotcontainer">
        <div class="slot">
          <div class="symbols" id="slot1Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot2Symbols"></div>
        </div>

        <div class="slot">
          <div class="symbols" id="slot3Symbols"></div>
        </div>
      </div>

      <!-- Inline Compact Payout Info -->
      <div *ngIf="slotMachineInfo" class="slot-payout-compact">
        <div class="payout-compact-grid">
          <div
            *ngFor="let entry of slotMachineInfo.payoutTable"
            class="payout-compact-entry"
            [class.jackpot-entry]="entry.tier === 'jackpot'"
            [class.big-win-entry]="entry.tier === 'big_win'"
          >
            <span class="payout-compact-symbol">{{ entry.symbol }}</span>
            <span class="payout-compact-condition">{{ entry.condition }}</span>
            <span class="payout-compact-amount">+{{ entry.payout }}</span>
          </div>
        </div>
      </div>

      <div
        class="slot-machine-controls wheel-bet-controls"
        style="display: flex; flex-direction: column; gap: 0.5rem; align-items: stretch"
      >
        <button
          (click)="testSlotMachine()"
          class="wheel-spin-btn slot-spin-btn"
          [disabled]="isSpinning || !canAffordSlotMachine()"
          [class.spinning]="isSpinning"
          [class.disabled]="!canAffordSlotMachine()"
        >
          <span class="btn-text" *ngIf="!isSpinning">Drehen!</span>
          <span class="btn-text" *ngIf="isSpinning">Dreht...</span>
          <span class="btn-cost">ü™ô {{ slotMachineInfo?.cost || 10 }} ZVC</span>
        </button>

        <button
          (click)="toggleAutoSpin()"
          class="wheel-autospin-btn slot-autospin-btn"
          [class.active]="autoSpinEnabled"
          [disabled]="!canAffordSlotMachine()"
        >
          <span *ngIf="!autoSpinEnabled">üîÑ Auto</span>
          <span *ngIf="autoSpinEnabled">‚èπÔ∏è Stoppen</span>
        </button>
      </div>

      <!-- Status Messages -->
      <div *ngIf="slotMachineMessage" class="slot-machine-message">{{ slotMachineMessage }}</div>
      <div *ngIf="slotMachineError" class="slot-machine-error">{{ slotMachineError }}</div>

      <!-- Win Log -->
      <div *ngIf="slotWinLog.length > 0" class="slot-win-log">
        <div class="win-log-header">
          <span class="win-log-title">üìú Letzte Spins</span>
          <div class="win-log-header-controls">
            <label class="win-log-toggle">
              <input type="checkbox" [(ngModel)]="hideLosses" class="toggle-checkbox" />
              <span class="toggle-slider"></span>
            </label>
            <span class="win-log-count">{{ getFilteredWinLog().length }}</span>
          </div>
        </div>
        <div class="win-log-list">
          <div
            *ngFor="let entry of getFilteredWinLog(); trackBy: trackByWinLogId"
            class="win-log-entry"
            [class.win-log-jackpot]="entry.winType === 'jackpot'"
            [class.win-log-big-win]="entry.winType === 'big_win'"
            [class.win-log-win]="entry.winType === 'small_win' || entry.winType === 'mini_win'"
            [class.win-log-loss]="entry.winType === 'loss'"
          >
            <div class="win-log-symbols">
              <span class="win-symbol">{{ entry.symbols[0] }}</span>
              <span class="win-symbol">{{ entry.symbols[1] }}</span>
              <span class="win-symbol">{{ entry.symbols[2] }}</span>
            </div>
            <div class="win-log-info">
              <span class="win-log-type" [style.color]="getWinTypeInfo(entry.winType).color">
                {{ getWinTypeInfo(entry.winType).emoji }} {{ getWinTypeInfo(entry.winType).label }}
              </span>
              <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
            </div>
            <div class="win-log-payout" [class.negative]="entry.payout === 0">
              <span class="payout-amount"> {{ entry.payout > 0 ? '+' : '' }}{{ entry.payout }} </span>
              <span class="payout-cost" *ngIf="entry.payout > 0">-{{ slotMachineInfo?.cost || 10 }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Roulette Widget -->
    <div class="roulette-widget">
      <div class="roulette-header">
        <h4 class="zvcoins-section-title">üé∞ Roulette</h4>
      </div>

      <!-- Loading State -->
      <div *ngIf="!rouletteInfo && !rouletteError" class="text-center py-8">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-lg text-white">Lade Roulette...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="rouletteError && !rouletteInfo" class="text-center py-8">
        <div class="text-red-400 mb-4">‚ö†Ô∏è</div>
        <p class="text-red-400">{{ rouletteError }}</p>
        <button
          (click)="loadRouletteInfo()"
          class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
        >
          Erneut versuchen
        </button>
      </div>

      <!-- Roulette Content -->
      <div *ngIf="rouletteInfo">
        <!-- Roulette Wheel Visualization -->
        <div class="roulette-wheel-container">
          <!-- Pointer at top (outside the rotating wheel) -->
          <div class="roulette-pointer"></div>
          <div
            class="roulette-wheel"
            [class.spinning]="isRouletteSpinning"
            [attr.data-result]="rouletteSpinResult"
            [style.transform]="'rotate(' + rouletteRotation + 'deg)'"
          >
            <!-- SVG Wheel Background -->
            <svg class="roulette-wheel-svg" viewBox="0 0 200 200">
              <g *ngFor="let segment of rouletteWheelSegments; let i = index">
                <path [attr.d]="segment.path" [attr.fill]="segment.color" />
              </g>
            </svg>
            <!-- Roulette logo center -->
            <div class="roulette-logo">
              <img src="/assets/logos/logo_full_color_1to1.png" alt="Zeitvertreib Logo" />
            </div>
            <!-- Roulette numbers 0-36 arranged in a circle -->
            <div class="roulette-numbers">
              <div
                *ngFor="
                  let num of rouletteWheelSequence;
                  let i = index
                "
                class="roulette-number"
                [ngStyle]="getRouletteNumberPosition(num)"
              >
                {{ num }}
              </div>
            </div>
          </div>
        </div>

        <!-- Result Display removed - no popup -->

        <!-- Bet Type Selection -->
        <div class="roulette-bet-type-section">
          <label class="bet-type-label">Wettart</label>
          <div class="bet-type-grid">
            <button
              class="bet-type-btn bet-type-btn-primary"
              [class.active]="rouletteBetType === 'red'"
              (click)="rouletteBetType = 'red'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              üî¥ Rot
            </button>
            <button
              class="bet-type-btn bet-type-btn-primary"
              [class.active]="rouletteBetType === 'black'"
              (click)="rouletteBetType = 'black'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              ‚ö´ Schwarz
            </button>
            <button
              class="bet-type-btn"
              [class.active]="rouletteBetType === 'odd'"
              (click)="rouletteBetType = 'odd'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              Ungerade
            </button>
            <button
              class="bet-type-btn"
              [class.active]="rouletteBetType === 'even'"
              (click)="rouletteBetType = 'even'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              Gerade
            </button>
            <button
              class="bet-type-btn"
              [class.active]="rouletteBetType === '1to18'"
              (click)="rouletteBetType = '1to18'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              1-18
            </button>
            <button
              class="bet-type-btn"
              [class.active]="rouletteBetType === '19to36'"
              (click)="rouletteBetType = '19to36'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 2x deinen Einsatz"
            >
              19-36
            </button>
            <button
              class="bet-type-btn bet-type-btn-special"
              [class.active]="rouletteBetType === 'number'"
              (click)="rouletteBetType = 'number'"
              [disabled]="isRouletteSpinning"
              title="Gewinn: 36x deinen Einsatz"
            >
              Nummer
            </button>
          </div>

          <!-- Number input for specific number bet -->
          <div *ngIf="rouletteBetType === 'number'" class="number-input-section">
            <input
              type="number"
              [(ngModel)]="rouletteBetValue"
              (input)="onRouletteNumberInput($event)"
              min="1"
              max="36"
              placeholder="1-36"
              class="number-input"
              [disabled]="isRouletteSpinning"
            />
          </div>
        </div>

        <!-- Bet Controls -->
        <div class="roulette-bet-controls">
          <div class="roulette-bet-display">
            <button
              (click)="adjustRouletteBet(-10)"
              class="roulette-bet-btn"
              [disabled]="isRouletteSpinning || rouletteBet <= rouletteInfo.minBet"
            >
              ‚àí
            </button>
            <div class="roulette-bet-amount">
              <label class="bet-label" for="rouletteBetInput">Einsatz</label>
              <div class="bet-input-wrapper">
                <input
                  id="rouletteBetInput"
                  class="bet-input"
                  type="text"
                  inputmode="numeric"
                  pattern="[0-9]*"
                  [value]="rouletteBetInput"
                  (input)="onRouletteBetInput($event)"
                  (keydown)="onRouletteBetKeydown($event)"
                  (blur)="commitRouletteBetInput()"
                  (keydown.enter)="commitRouletteBetInput(); $event.preventDefault()"
                  [disabled]="isRouletteSpinning"
                  [attr.min]="rouletteInfo.minBet"
                  [attr.max]="rouletteInfo.maxBet"
                />
                <span class="bet-unit">ZVC</span>
              </div>
            </div>
            <button
              (click)="adjustRouletteBet(10)"
              class="roulette-bet-btn"
              [disabled]="isRouletteSpinning || rouletteBet >= rouletteInfo.maxBet"
            >
              +
            </button>
          </div>

          <button
            (click)="spinRoulette()"
            class="roulette-spin-btn"
            [class.spinning]="isRouletteSpinning"
            [disabled]="!canAffordRoulette() || isRouletteSpinning"
          >
            <span class="btn-icon">üé∞</span>
            <span class="btn-text">{{ isRouletteSpinning ? 'Dreht...' : 'Drehen!' }}</span>
          </button>
        </div>

        <!-- Status Messages -->
        <div *ngIf="rouletteError && rouletteInfo" class="roulette-error">{{ rouletteError }}</div>

        <!-- Roulette Spin Log -->
        <div *ngIf="rouletteSpinLog.length > 0" class="slot-win-log roulette-spin-log">
          <div class="win-log-header">
            <span class="win-log-title">üìú Letzte Spins</span>
            <div class="win-log-header-controls">
              <label class="win-log-toggle" title="Verluste ausblenden">
                <input type="checkbox" [(ngModel)]="hideRouletteLosses" class="toggle-checkbox" />
                <span class="toggle-slider"></span>
              </label>
              <span class="win-log-count">{{ getFilteredRouletteSpinLog().length }}</span>
            </div>
          </div>
          <div class="win-log-list">
            <div
              *ngFor="let entry of getFilteredRouletteSpinLog(); trackBy: trackByRouletteSpinId"
              class="win-log-entry"
              [class.win-log-win]="entry.won"
              [class.win-log-loss]="!entry.won"
            >
              <div class="win-log-symbols">
                <span
                  class="roulette-number-badge"
                  [style.background-color]="
                    getRouletteNumberColor(entry.spinResult) === 'red'
                      ? '#ef4444'
                      : getRouletteNumberColor(entry.spinResult) === 'black'
                        ? '#1f2937'
                        : '#10b981'
                  "
                >
                  {{ entry.spinResult }}
                </span>
              </div>
              <div class="win-log-info">
                <span class="win-log-type" [style.color]="getRouletteSpinTypeInfo(entry).color">
                  {{ getRouletteSpinTypeInfo(entry).emoji }} {{ getRouletteSpinTypeInfo(entry).label }}
                </span>
                <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
              </div>
              <div class="win-log-payout" [class.negative]="!entry.won">
                <span class="payout-amount"> {{ entry.won ? '+' : '' }}{{ entry.payout }} </span>
                <span class="roulette-log-bet">-{{ entry.betAmount }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Lucky Wheel Widget -->
    <div class="lucky-wheel-widget">
      <div class="lucky-wheel-header">
        <h4 class="zvcoins-section-title">üé° Gl√ºcksrad</h4>
      </div>

      <!-- Loading State -->
      <div *ngIf="!luckyWheelInfo && !luckyWheelError" class="text-center py-8">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-lg text-white">Lade Gl√ºcksrad...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="luckyWheelError && !luckyWheelInfo" class="text-center py-8">
        <div class="text-red-400 mb-4">‚ö†Ô∏è</div>
        <p class="text-red-400">{{ luckyWheelError }}</p>
        <button
          (click)="loadLuckyWheelInfo()"
          class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
        >
          Erneut versuchen
        </button>
      </div>

      <!-- Lucky Wheel Content -->
      <div *ngIf="luckyWheelInfo">
        <!-- Lucky Wheel SVG -->
        <div class="wheel-container">
          <svg
            class="lucky-wheel-svg"
            [class.spinning]="isWheelSpinning"
            [style.transform]="'rotate(' + wheelRotation + 'deg)'"
            viewBox="0 0 200 200"
          >
            <!-- Wheel segments -->
            <g *ngFor="let segment of getWheelSegments(); let i = index">
              <path
                class="wheel-segment"
                [attr.d]="
                  'M 100 100 L ' +
                  (100 + 100 * Math.cos((((i * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                  ' ' +
                  (100 + 100 * Math.sin((((i * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                  ' A 100 100 0 0 1 ' +
                  (100 + 100 * Math.cos(((((i + 1) * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                  ' ' +
                  (100 + 100 * Math.sin(((((i + 1) * 360) / getTotalSegments() - 90) * Math.PI) / 180)) +
                  ' Z'
                "
                [attr.fill]="segment.color"
                stroke="rgba(0,0,0,0.3)"
                stroke-width="1"
                [class.wheel-segment-active]="winningSegmentIndex === i && showWheelResult"
              />
            </g>

            <!-- Logo image in center -->
            <defs>
              <clipPath id="circleClip">
                <circle cx="100" cy="100" r="22" />
              </clipPath>
            </defs>
            <image
              *ngIf="!(lastWheelMultiplier !== null && showWheelResult)"
              href="assets/logos/logo_full_color_1to1.png"
              x="78"
              y="78"
              width="44"
              height="44"
              clip-path="url(#circleClip)"
            />

            <!-- Result display circle -->
            <circle
              *ngIf="lastWheelMultiplier !== null && showWheelResult"
              cx="100"
              cy="100"
              r="22"
              fill="rgba(0,0,0,0.9)"
            />
            <text
              *ngIf="lastWheelMultiplier !== null && showWheelResult"
              x="100"
              y="100"
              text-anchor="middle"
              dominant-baseline="middle"
              fill="white"
              font-size="14"
              font-weight="bold"
            >
              {{ lastWheelMultiplier + 'x' }}
            </text>
          </svg>

          <!-- Pointer arrow at top -->
          <div class="wheel-pointer"></div>
        </div>

        <!-- Multiplier Legend (compact colored badges) -->
        <div class="wheel-multiplier-legend">
          <div
            *ngFor="let entry of luckyWheelInfo.payoutTable; let i = index"
            class="legend-badge"
            [style.background-color]="getMultiplierColor(entry.multiplier)"
          >
            {{ entry.multiplier }}x
          </div>
        </div>

        <!-- Bet Controls -->
        <div class="wheel-bet-controls">
          <div class="wheel-bet-display">
            <button
              (click)="adjustLuckyWheelBet(-10)"
              class="wheel-bet-btn"
              [disabled]="luckyWheelLoading || luckyWheelBet <= luckyWheelInfo.minBet"
            >
              ‚àí
            </button>
            <div class="wheel-bet-amount">
              <label class="bet-label" for="wheelBetInput">Einsatz</label>
              <div class="bet-input-wrapper">
                <input
                  id="wheelBetInput"
                  class="bet-input"
                  type="text"
                  inputmode="numeric"
                  pattern="[0-9]*"
                  [value]="luckyWheelBetInput"
                  (input)="onLuckyWheelBetInput($event)"
                  (keydown)="onLuckyWheelBetKeydown($event)"
                  (blur)="commitLuckyWheelBetInput()"
                  (keydown.enter)="commitLuckyWheelBetInput(); $event.preventDefault()"
                  [disabled]="luckyWheelLoading"
                  [attr.min]="luckyWheelInfo.minBet"
                  [attr.max]="luckyWheelInfo.maxBet"
                />
                <span class="bet-unit">ZVC</span>
              </div>
            </div>
            <button
              (click)="adjustLuckyWheelBet(10)"
              class="wheel-bet-btn"
              [disabled]="luckyWheelLoading || luckyWheelBet >= luckyWheelInfo.maxBet"
            >
              +
            </button>
          </div>

          <button
            (click)="spinLuckyWheel()"
            class="wheel-spin-btn"
            [class.spinning]="isWheelSpinning"
            [disabled]="!canAffordLuckyWheel() || luckyWheelLoading"
          >
            <span class="btn-icon">üé°</span>
            <span class="btn-text">{{ isWheelSpinning ? 'Dreht...' : 'Drehen!' }}</span>
          </button>

          <button
            (click)="toggleAutoWheelSpin()"
            class="wheel-autospin-btn"
            [class.active]="autoWheelSpinEnabled"
            [disabled]="!luckyWheelInfo"
            title="{{ autoWheelSpinEnabled ? 'Auto-Spin deaktivieren' : 'Auto-Spin aktivieren' }}"
          >
            <span *ngIf="!autoWheelSpinEnabled">üîÑ Auto</span>
            <span *ngIf="autoWheelSpinEnabled">‚èπÔ∏è Stopp</span>
          </button>
        </div>

        <!-- Status Messages -->
        <div *ngIf="luckyWheelError && luckyWheelInfo" class="wheel-error">{{ luckyWheelError }}</div>

        <!-- Lucky Wheel Spin Log -->
        <div *ngIf="luckyWheelSpinLog.length > 0" class="slot-win-log wheel-spin-log">
          <div class="win-log-header">
            <span class="win-log-title">üìú Letzte Wheel-Spins</span>
            <div class="win-log-header-controls">
              <label class="win-log-toggle" title="Verluste ausblenden">
                <input type="checkbox" [(ngModel)]="hideWheelLosses" class="toggle-checkbox" />
                <span class="toggle-slider"></span>
              </label>
              <span class="win-log-count">{{ getFilteredWheelSpinLog().length }}</span>
            </div>
          </div>
          <div class="win-log-list">
            <div
              *ngFor="let entry of getFilteredWheelSpinLog(); trackBy: trackByWheelSpinId"
              class="win-log-entry"
              [class.win-log-win]="entry.payout > 0"
              [class.win-log-loss]="entry.payout === 0"
            >
              <div class="win-log-symbols">
                <span class="legend-badge" [style.background-color]="getMultiplierColor(entry.multiplier)"
                  >{{ entry.multiplier }}x</span
                >
              </div>
              <div class="win-log-info">
                <span class="win-log-type" [style.color]="getWheelSpinTypeInfo(entry).color">
                  {{ getWheelSpinTypeInfo(entry).emoji }} {{ getWheelSpinTypeInfo(entry).label }}
                </span>
                <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
              </div>
              <div class="win-log-payout" [class.negative]="entry.payout === 0">
                <span class="payout-amount"> {{ entry.payout > 0 ? '+' : '' }}{{ entry.payout }} </span>
                <span class="wheel-log-bet">-{{ entry.bet }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Chicken Cross Widget -->
    <div class="chicken-cross-widget">
      <div class="chicken-cross-header">
        <h4 class="zvcoins-section-title">üêî Chicken Cross</h4>
        <div *ngIf="hasActiveChickenCrossGame()" class="chicken-payout-display">
          <span class="payout-label">Auszahlung:</span>
          <span class="payout-value">{{ chickenCrossGame!.currentPayout }} ZVC</span>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="!chickenCrossInfo && !chickenCrossError" class="text-center py-8">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-lg text-white">Lade Spiel...</p>
      </div>

      <!-- Error State (no info) -->
      <div *ngIf="chickenCrossError && !chickenCrossInfo" class="text-center py-8">
        <div class="text-red-400 mb-4">‚ö†Ô∏è</div>
        <p class="text-red-400">{{ chickenCrossError }}</p>
        <button
          (click)="loadChickenCrossInfo()"
          class="mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors"
        >
          Erneut versuchen
        </button>
      </div>

      <!-- Game Content -->
      <div *ngIf="chickenCrossInfo">
        <!-- Game Board Visualization -->
        <div class="chicken-game-board">
          <div
            class="chicken-road"
            #chickenRoad
            [attr.data-has-game]="hasActiveChickenCrossGame() || chickenCrossDeadGame"
          >
            <!-- Starting position (home) -->
            <div
              class="chicken-lane chicken-home"
              [class.chicken-current]="hasActiveChickenCrossGame() && chickenCrossGame!.step === 0"
              [class.chicken-dead-home]="chickenCrossDeadGame && !hasActiveChickenCrossGame()"
            >
              <span
                class="chicken-lane-marker"
                [class.chicken-emoji]="hasActiveChickenCrossGame() && chickenCrossGame!.step === 0"
              >
                {{ hasActiveChickenCrossGame() && chickenCrossGame!.step === 0 ? 'üêî' : 'üè†' }}
              </span>
              <span class="chicken-lane-label">Start</span>
            </div>

            <!-- Active game: passed steps + next 4 steps -->
            <ng-container *ngIf="hasActiveChickenCrossGame()">
              <!-- Passed steps (1 to current step) -->
              <div
                *ngFor="let step of [].constructor(chickenCrossGame!.step); let i = index"
                class="chicken-lane"
                [class.chicken-passed]="i + 1 < chickenCrossGame!.step"
                [class.chicken-current]="
                  i + 1 === chickenCrossGame!.step && chickenCrossGame!.state !== 'LOST'
                "
                [class.chicken-suspense]="
                  chickenCrossIsAnimating &&
                  i + 1 === chickenCrossGame!.step &&
                  chickenCrossGame!.state !== 'LOST'
                "
                [class.chicken-dead]="
                  chickenCrossGame!.state === 'LOST' && i + 1 === chickenCrossGame!.step
                "
                [class.chicken-success]="
                  !chickenCrossIsAnimating &&
                  i + 1 === chickenCrossGame!.step &&
                  chickenCrossGame!.state === 'ACTIVE'
                "
              >
                <span
                  class="chicken-lane-marker"
                  [class.chicken-emoji]="
                    i + 1 === chickenCrossGame!.step &&
                    chickenCrossGame!.state !== 'LOST' &&
                    !chickenCrossIsAnimating
                  "
                  [class.chicken-suspense-emoji]="
                    chickenCrossIsAnimating &&
                    i + 1 === chickenCrossGame!.step &&
                    chickenCrossGame!.state !== 'LOST'
                  "
                >
                  {{ chickenCrossGame!.state === 'LOST' && i + 1 === chickenCrossGame!.step ? 'üíÄ' : i + 1 ===
                  chickenCrossGame!.step ? 'üêî' : '‚úÖ' }}
                </span>
                <span class="chicken-lane-multiplier"
                  >{{ getChickenMultiplierForStep(chickenCrossGame!.seed, i + 1) }}x</span
                >
                <!-- Explosion particles inside the dead lane -->
                <div
                  *ngIf="chickenCrossLostAnimation && i + 1 === chickenCrossGame!.step"
                  class="chicken-explosion-inline"
                >
                  <div class="explosion-particle-inline" *ngFor="let p of [1, 2, 3, 4, 5, 6, 7, 8]"></div>
                </div>
              </div>

              <!-- Next 4 steps with multipliers -->
              <div
                *ngFor="let nextStep of getNextChickenSteps(); let i = index"
                class="chicken-lane chicken-future"
                [class.chicken-next-immediate]="i === 0"
              >
                <span class="chicken-lane-marker">{{ i === 0 ? '‚ùì' : '¬∑' }}</span>
                <span class="chicken-lane-multiplier">{{ nextStep.multiplier }}x</span>
              </div>
            </ng-container>

            <!-- Dead game display (show the lost state while bet controls appear) -->
            <ng-container *ngIf="!hasActiveChickenCrossGame() && chickenCrossDeadGame">
              <div
                *ngFor="let step of [].constructor(chickenCrossDeadGame.step); let i = index"
                class="chicken-lane"
                [class.chicken-passed]="i + 1 < chickenCrossDeadGame.step"
                [class.chicken-dead]="i + 1 === chickenCrossDeadGame.step"
              >
                <span class="chicken-lane-marker" [class.chicken-dead-emoji]="i + 1 === chickenCrossDeadGame.step">
                  {{ i + 1 === chickenCrossDeadGame.step ? 'üíÄ' : '‚úÖ' }}
                </span>
                <span class="chicken-lane-multiplier"
                  >{{ getChickenMultiplierForStep(chickenCrossDeadGame.seed, i + 1) }}x</span
                >
              </div>

              <!-- Show the next 4 steps that could have been -->
              <div
                *ngFor="let nextStep of getDeadChickenNextSteps(); let i = index"
                class="chicken-lane chicken-future"
                [class.chicken-next-immediate]="i === 0"
              >
                <span class="chicken-lane-marker">{{ i === 0 ? '‚ùì' : '¬∑' }}</span>
                <span class="chicken-lane-multiplier">{{ nextStep.multiplier }}x</span>
              </div>
            </ng-container>

            <!-- No active game and no dead game: show start position + preview steps -->
            <ng-container *ngIf="!hasActiveChickenCrossGame() && !chickenCrossDeadGame">
              <div class="chicken-lane chicken-preview">
                <span class="chicken-lane-marker">‚ùì</span>
              </div>
              <div class="chicken-lane chicken-preview">
                <span class="chicken-lane-marker">‚ùì</span>
              </div>
              <div class="chicken-lane chicken-preview">
                <span class="chicken-lane-marker">‚ùì</span>
              </div>
              <div class="chicken-lane chicken-preview">
                <span class="chicken-lane-marker">‚ùì</span>
              </div>
              <div class="chicken-lane chicken-preview">
                <span class="chicken-lane-marker">‚ùì</span>
              </div>
            </ng-container>
          </div>
        </div>

        <!-- Bet Controls (only shown when no active game) -->
        <div *ngIf="!hasActiveChickenCrossGame()" class="wheel-bet-controls chicken-bet-controls">
          <div class="wheel-bet-display">
            <button
              (click)="adjustChickenCrossBet(-10)"
              class="wheel-bet-btn"
              [disabled]="chickenCrossLoading || chickenCrossBet <= chickenCrossInfo.minBet"
            >
              ‚àí
            </button>
            <div class="wheel-bet-amount">
              <label class="bet-label" for="chickenBetInput">Einsatz</label>
              <div class="bet-input-wrapper">
                <input
                  id="chickenBetInput"
                  class="bet-input"
                  type="text"
                  inputmode="numeric"
                  pattern="[0-9]*"
                  [value]="chickenCrossBetInput"
                  (input)="onChickenCrossBetInput($event)"
                  (keydown)="onChickenCrossBetKeydown($event)"
                  (blur)="commitChickenCrossBetInput()"
                  (keydown.enter)="commitChickenCrossBetInput(); $event.preventDefault()"
                  [disabled]="chickenCrossLoading"
                  [attr.min]="chickenCrossInfo.minBet"
                  [attr.max]="chickenCrossInfo.maxBet"
                />
                <span class="bet-unit">ZVC</span>
              </div>
            </div>
            <button
              (click)="adjustChickenCrossBet(10)"
              class="wheel-bet-btn"
              [disabled]="chickenCrossLoading || chickenCrossBet >= chickenCrossInfo.maxBet"
            >
              +
            </button>
          </div>

          <button
            (click)="startChickenCrossGame()"
            class="chicken-start-btn"
            [disabled]="!canAffordChickenCross() || chickenCrossLoading"
          >
            <span class="btn-icon">üêî</span>
            <span class="btn-text">{{ chickenCrossLoading ? 'Startet...' : 'Spiel starten!' }}</span>
          </button>
        </div>

        <!-- Game Actions (only shown during active game) -->
        <div *ngIf="hasActiveChickenCrossGame()" class="chicken-game-actions">
          <button
            (click)="chickenCrossMove()"
            class="chicken-action-btn chicken-move-btn"
            [disabled]="chickenCrossLoading || chickenCrossIsMoving || chickenCrossIsAnimating"
            [class.moving]="chickenCrossIsMoving || chickenCrossIsAnimating"
          >
            <span class="btn-icon">üêî</span>
            <span class="btn-text">Weiter!</span>
          </button>
          <button
            (click)="chickenCrossCashout()"
            class="chicken-action-btn chicken-cashout-btn"
            [disabled]="chickenCrossLoading || chickenCrossIsMoving || chickenCrossIsAnimating"
          >
            Cashout
          </button>
        </div>

        <!-- Error message only -->
        <div *ngIf="chickenCrossError && chickenCrossInfo" class="chicken-error">{{ chickenCrossError }}</div>

        <!-- Game History Log -->
        <div *ngIf="chickenCrossHistory.length > 0" class="slot-win-log chicken-history-log">
          <div class="win-log-header">
            <span class="win-log-title">üìú Letzte Spiele</span>
            <div class="win-log-header-controls">
              <label class="win-log-toggle" title="Verluste ausblenden">
                <input type="checkbox" [(ngModel)]="hideChickenLosses" class="toggle-checkbox" />
                <span class="toggle-slider"></span>
              </label>
              <span class="win-log-count">{{ getFilteredChickenHistory().length }}</span>
            </div>
          </div>
          <div class="win-log-list">
            <div
              *ngFor="let entry of getFilteredChickenHistory(); trackBy: trackByChickenHistoryId"
              class="win-log-entry"
              [class.win-log-win]="entry.state === 'CASHED_OUT'"
              [class.win-log-loss]="entry.state === 'LOST'"
            >
              <div class="win-log-symbols">
                <span class="chicken-history-multiplier">{{ entry.multiplier.toFixed(2) }}x üêî</span>
              </div>
              <div class="win-log-info">
                <span class="win-log-type" [style.color]="getChickenHistoryTypeInfo(entry).color">
                  {{ getChickenHistoryTypeInfo(entry).emoji }} {{ getChickenHistoryTypeInfo(entry).label }}
                </span>
                <span class="win-log-time">{{ getTimeAgo(entry.timestamp) }}</span>
              </div>
              <div class="win-log-payout" [class.negative]="entry.state === 'LOST'">
                <span class="payout-amount"> {{ entry.state === 'CASHED_OUT' ? '+' + entry.finalPayout : '0' }} </span>
                <span class="payout-cost">-{{ entry.initialWager }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dashboard-container">
  <div class="p-6 relative z-10">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="text-center text-white">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-xl font-medium">Lade Statistiken...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-state">
      <div class="error-message max-w-md mx-auto">
        <h3 class="text-xl font-bold mb-2">Fehler beim Laden</h3>
        <p class="mb-4">{{ errorMessage }}</p>
        <button (click)="refreshStats()" class="refresh-button">
          Erneut versuchen
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && !hasError" class="dashboard-grid">
      <!-- Stats Overview -->
      <div class="grid-item stats-overview">
        <div class="stats-card p-6 rounded-2xl auto-height">
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Kills -->
            <div
              class="stat-item"
              style="--stat-color: #10b981; --stat-color-light: #34d399"
            >
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">AbschÃ¼sse</h5>
                <p class="stat-value m-0">
                  {{ userStatistics.kills | number: '1.0-0' }}
                </p>
              </div>
            </div>

            <!-- Deaths -->
            <div
              class="stat-item"
              style="--stat-color: #3b82f6; --stat-color-light: #60a5fa"
            >
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">TodesfÃ¤lle</h5>
                <p class="stat-value m-0">
                  {{ userStatistics.deaths | number: '1.0-0' }}
                </p>
              </div>
            </div>

            <!-- Playtime -->
            <div
              class="stat-item"
              style="--stat-color: #eab308; --stat-color-light: #facc15"
            >
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">Spielzeit</h5>
                <p class="stat-value m-0">
                  {{ playtimeFormatted }}
                </p>
              </div>
            </div>
            <!-- K/D Ratio -->
            <div
              class="stat-item"
              style="--stat-color: #8b5cf6; --stat-color-light: #a78bfa"
            >
              <div class="stat-indicator"></div>
              <div class="flex-1 min-w-0 ml-4 flex flex-col justify-center">
                <h5 class="stat-label m-0 mb-1">K/D Ratio</h5>
                <p class="stat-value m-0">
                  {{ kdRatio }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Player Card -->
      <div class="grid-item player-card-container">
        <div class="player-card">
          <!-- Avatar Header -->
          <div
            class="player-avatar-container"
            *ngIf="userStatistics?.avatarFull"
          >
            <img
              class="player-avatar"
              [src]="getAvatarUrl(userStatistics.avatarFull)"
              [alt]="userStatistics.username || 'Player Avatar'"
              loading="lazy"
              (error)="onImageError($event)"
            />
          </div>

          <!-- Player Info -->
          <div class="p-6">
            <h2 class="text-2xl font-bold text-white mb-2 cardHeader">
              Willkommen zurÃ¼ck,<br />
              <span class="text-gradient">{{
                userStatistics.username || 'Spieler'
              }}</span>
            </h2>

            <p class="text-lg text-gray-300 mb-6">
              {{ leaderboardText }}
            </p>

            <!-- Stats List -->
            <div class="space-y-3">
              <div class="player-info-item">
                <span class="player-info-label">Gespielte Runden:</span>
                <span class="player-info-value">{{
                  userStatistics.roundsplayed | number: '1.0-0'
                }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Spielzeit:</span>
                <span class="player-info-value">{{ playtimeFormatted }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Medkits:</span>
                <span class="player-info-value">{{
                  userStatistics.usedmedkits | number: '1.0-0'
                }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Getrunkene Colas:</span>
                <span class="player-info-value">{{
                  userStatistics.usedcolas | number: '1.0-0'
                }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Pocket Escapes:</span>
                <span class="player-info-value">{{
                  userStatistics.pocketescapes | number: '1.0-0'
                }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Benutzte Adrenalin:</span>
                <span class="player-info-value">{{
                  userStatistics.usedadrenaline | number: '1.0-0'
                }}</span>
              </div>

              <div class="player-info-item">
                <span class="player-info-label">Snake Highscore:</span>
                <span class="player-info-value">{{
                  userStatistics.snakehighscore | number: '1.0-0'
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ZV Coins Widget -->
      <div class="grid-item zvcoins-container">
        <div class="stats-card p-6 rounded-2xl">
          <h3
            class="text-xl font-bold text-white mb-4 cardHeader flex items-center justify-between"
          >
            <span>ğŸª™ Zeitvertreib Coins</span>
            <span class="zvcoins-balance-inline">
              {{ userStatistics.experience | number: '1.0-0' }} ZVC
            </span>
          </h3>

          <!-- Code Redemption and Transfer Combined -->
          <div class="zvcoins-balance-code-section mb-6">
            <div class="zvcoins-combined-card">
              <!-- Code Redemption Area -->
              <div class="zvcoins-code-area">
                <div class="zvcoins-code-header">
                  <div class="zvcoins-code-icon">ğŸ«</div>
                  <div class="zvcoins-code-info">
                    <p class="zvcoins-code-label">Code einlÃ¶sen</p>
                  </div>
                </div>

                <!-- Code Info Tip -->
                <div class="zvcoins-code-tip">
                  <div class="code-tip-icon">ğŸ’¡</div>
                  <div class="code-tip-text">
                    Codes kannst du auf unserem
                    <strong>Discord-Server</strong> oder bei speziellen Events
                    gewinnen!!
                  </div>
                </div>

                <div class="zvcoins-code-input-section">
                  <div class="zvcoins-code-input-group">
                    <input
                      type="text"
                      [(ngModel)]="redeemCode"
                      placeholder="Gib deinen Code hier ein..."
                      class="zvcoins-code-input"
                      (keyup.enter)="redeemCodeAction()"
                      [disabled]="codeRedemptionLoading"
                    />
                    <button
                      class="zvcoins-code-btn"
                      (click)="redeemCodeAction()"
                      [disabled]="!redeemCode || codeRedemptionLoading"
                    >
                      <span *ngIf="!codeRedemptionLoading">ğŸ EinlÃ¶sen</span>
                      <span *ngIf="codeRedemptionLoading"
                        >â³ Wird eingelÃ¶st...</span
                      >
                    </button>
                  </div>
                </div>
              </div>

              <!-- Vertical Divider -->
              <div class="zvcoins-divider"></div>

              <!-- ZVC Transfer Area -->
              <div class="zvcoins-transfer-area">
                <div class="zvcoins-transfer-header">
                  <div class="zvcoins-transfer-icon">ğŸ’¸</div>
                  <div class="zvcoins-transfer-info">
                    <p class="zvcoins-transfer-label">
                      Zeitvertreib Coins senden
                    </p>
                  </div>
                </div>

                <!-- Transaction Tax Disclaimer -->
                <div class="zvcoins-transfer-disclaimer">
                  <div class="transfer-disclaimer-icon">âš ï¸</div>
                  <div class="transfer-disclaimer-text">
                    <strong>TransaktionsgebÃ¼hr:</strong> Auf jede Transaktion
                    wird eine 10% Steuer erhoben.
                    <strong>Mindestbetrag:</strong> 100 ZVC.
                  </div>
                </div>

                <!-- Transfer Cost Info -->
                <div
                  *ngIf="transferAmount && transferAmount > 0"
                  class="zvcoins-transfer-cost-info"
                >
                  <div class="transfer-cost-item">
                    <span class="cost-label">Betrag:</span>
                    <span class="cost-value">{{ transferAmount }} ZVC</span>
                  </div>
                  <div class="transfer-cost-item">
                    <span class="cost-label">Steuer (10%):</span>
                    <span class="cost-value"
                      >{{ getTransferTax(transferAmount) }} ZVC</span
                    >
                  </div>
                  <div class="transfer-cost-item transfer-cost-total">
                    <span class="cost-label">Gesamt:</span>
                    <span class="cost-value"
                      >{{ getTransferTotalCost(transferAmount) }} ZVC</span
                    >
                  </div>
                </div>

                <div class="zvcoins-transfer-input-section">
                  <div class="zvcoins-transfer-input-group">
                    <input
                      type="text"
                      [(ngModel)]="transferRecipient"
                      placeholder="Steam ID oder Benutzername"
                      class="zvcoins-transfer-input zvcoins-transfer-recipient"
                      [disabled]="transferLoading"
                    />
                    <input
                      type="text"
                      [(ngModel)]="transferAmount"
                      placeholder="Betrag"
                      class="zvcoins-transfer-input zvcoins-transfer-amount"
                      [disabled]="transferLoading"
                    />
                    <button
                      class="zvcoins-transfer-btn"
                      (click)="transferZVC()"
                      [disabled]="
                        !transferRecipient ||
                        !transferAmount ||
                        transferAmount <= 0 ||
                        transferAmount < 100 ||
                        transferAmount > 50000 ||
                        getTransferTotalCost(transferAmount) >
                          (userStatistics.experience || 0) ||
                        transferLoading
                      "
                    >
                      <span *ngIf="!transferLoading">ğŸ’¸ Senden</span>
                      <span *ngIf="transferLoading">â³ Wird gesendet...</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message displays outside the card for better visibility -->
            <div
              *ngIf="codeRedemptionMessage"
              class="zvcoins-message mt-3"
              [class.success]="codeRedemptionSuccess"
              [class.error]="!codeRedemptionSuccess"
            >
              {{ codeRedemptionMessage }}
            </div>
            <div
              *ngIf="transferMessage"
              class="zvcoins-message mt-3"
              [class.success]="transferSuccess"
              [class.error]="!transferSuccess"
            >
              {{ transferMessage }}
            </div>
          </div>

          <!-- Games Section: Slot Machine and Coming Soon -->
          <div class="zvcoins-balance-code-section mb-6">
            <div class="zvcoins-games-card">
              <!-- Slot machine-->
              <div class="slot-machine-widget">
                <div class="slot-machine-header">
                  <h4 class="zvcoins-section-title">ğŸ° Slotmaschine</h4>
                  <div class="slot-machine-header-right">
                    <button
                      (click)="togglePayoutInfo()"
                      class="slot-info-icon"
                      title="Gewinntabelle anzeigen"
                    >
                      <span *ngIf="!showPayoutInfo">?</span>
                      <span *ngIf="showPayoutInfo">âœ•</span>
                    </button>
                    <div class="slot-machine-badge">BETA</div>
                  </div>
                </div>

                <!-- Winning Animation Overlay -->
                <div
                  *ngIf="showWinningAnimation && !showPayoutInfo"
                  class="winning-animation-overlay"
                  [class.jackpot]="currentWinType === 'jackpot'"
                  [class.big-win]="currentWinType === 'big_win'"
                  [class.small-win]="currentWinType === 'small_win'"
                >
                  <div class="winning-animation-content">
                    <div class="confetti">ğŸ‰</div>
                    <div class="confetti">ğŸŠ</div>
                    <div class="confetti">âœ¨</div>
                    <div class="confetti" *ngIf="currentWinType === 'jackpot'">
                      ï¿½
                    </div>
                    <div class="confetti" *ngIf="currentWinType === 'big_win'">
                      ğŸ”¥
                    </div>
                    <div
                      class="confetti"
                      *ngIf="
                        currentWinType !== 'jackpot' &&
                        currentWinType !== 'big_win'
                      "
                    >
                      ï¿½ğŸ’°
                    </div>
                    <div class="confetti">ğŸ†</div>
                    <div class="winning-text">
                      <span *ngIf="currentWinType === 'jackpot'"
                        >ğŸ’ JACKPOT! ğŸ’</span
                      >
                      <span *ngIf="currentWinType === 'big_win'"
                        >ğŸ”¥ GROSSER GEWINN! ğŸ”¥</span
                      >
                      <span *ngIf="currentWinType === 'small_win'"
                        >âœ¨ GEWINN! âœ¨</span
                      >
                    </div>
                    <div class="winning-amount">{{ slotMachineMessage }}</div>
                  </div>
                </div>

                <div class="slotcontainer" *ngIf="!showPayoutInfo">
                  <div class="slot">
                    <div class="symbols" id="slot1Symbols"></div>
                  </div>

                  <div class="slot">
                    <div class="symbols" id="slot2Symbols"></div>
                  </div>

                  <div class="slot">
                    <div class="symbols" id="slot3Symbols"></div>
                  </div>
                </div>

                <div class="slot-machine-controls" *ngIf="!showPayoutInfo">
                  <button
                    (click)="testSlotMachine()"
                    class="slot-machine-btn slot-spin-btn"
                    [disabled]="isSpinning || !canAffordSlotMachine()"
                    [class.spinning]="isSpinning"
                    [class.disabled]="!canAffordSlotMachine()"
                  >
                    <span
                      class="btn-text"
                      *ngIf="!isSpinning && canAffordSlotMachine()"
                      >ğŸ° Start!!! ğŸ°</span
                    >
                    <span
                      class="btn-text"
                      *ngIf="!isSpinning && !canAffordSlotMachine()"
                      >âŒ Nicht genug ZVC âŒ</span
                    >
                    <span class="btn-text" *ngIf="isSpinning"
                      >ğŸ° Dreht... ğŸ°</span
                    >
                    <span class="btn-cost"
                      >ğŸª™ {{ slotMachineInfo?.cost || 10 }} ZVC</span
                    >
                  </button>
                </div>

                <!-- Payout Info Section -->
                <div
                  *ngIf="showPayoutInfo && slotMachineInfo"
                  class="slot-payout-info"
                >
                  <div class="payout-info-header">
                    <h5>ğŸ’° Gewinntabelle</h5>
                  </div>
                  <p class="payout-description">
                    {{ slotMachineInfo.description }}
                  </p>
                  <div class="payout-table">
                    <div
                      *ngFor="let entry of slotMachineInfo.payoutTable"
                      class="payout-entry"
                      [class.jackpot-entry]="entry.tier === 'jackpot'"
                      [class.big-win-entry]="entry.tier === 'big_win'"
                      [class.small-win-entry]="entry.tier === 'small_win'"
                      [class.mini-win-entry]="entry.tier === 'mini_win'"
                    >
                      <div class="payout-symbol">{{ entry.symbol }}</div>
                      <div class="payout-details">
                        <div class="payout-condition">
                          {{ entry.condition }}
                        </div>
                        <div class="payout-description-text">
                          {{ entry.description }}
                        </div>
                      </div>
                      <div class="payout-amount">+{{ entry.payout }} ZVC</div>
                    </div>
                  </div>
                  <div class="payout-footer">
                    <p>ğŸ’¡ Kosten pro Dreh: {{ slotMachineInfo.cost }} ZVC</p>
                  </div>
                </div>

                <!-- Status Messages -->
                <div
                  *ngIf="slotMachineMessage && !showPayoutInfo"
                  class="slot-machine-message"
                  [class.success]="showWinningAnimation"
                >
                  {{ slotMachineMessage }}
                </div>
                <div
                  *ngIf="slotMachineError && !showPayoutInfo"
                  class="slot-machine-error"
                >
                  {{ slotMachineError }}
                </div>
              </div>

              <!-- Coming Soon Widget -->
              <div class="coming-soon-widget">
                <div class="coming-soon-placeholder">
                  <div class="placeholder-icon">ğŸ²</div>
                  <div class="placeholder-icon">ğŸƒ</div>
                  <div class="placeholder-icon">ğŸ¯</div>
                </div>
                <div class="coming-soon-blur-overlay">
                  <div class="coming-soon-content">
                    <div class="coming-soon-icon">ğŸ®</div>
                    <h4 class="coming-soon-title">Bald verfÃ¼gbar!</h4>
                    <p class="coming-soon-subtitle">
                      Neue Spiele kommen bald...
                    </p>
                    <div class="coming-soon-badge">COMING SOON</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Redeemable Items -->
          <div class="zvcoins-rewards-section mb-4">
            <h4 class="zvcoins-section-title">ğŸ Belohnungen einlÃ¶sen</h4>

            <!-- Loading State -->
            <div *ngIf="redeemablesLoading" class="text-center py-8">
              <div class="loading-spinner mx-auto mb-4"></div>
              <p class="text-lg text-white">Lade Belohnungen...</p>
            </div>

            <!-- Error State -->
            <div
              *ngIf="redeemablesError && !redeemablesLoading"
              class="text-center py-8"
            >
              <div class="text-red-400 mb-4">âš ï¸</div>
              <p class="text-red-400">{{ redeemablesError }}</p>
              <button
                (click)="loadRedeemables()"
                class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
              >
                Erneut versuchen
              </button>
            </div>

            <!-- Redeemables Grid -->
            <div
              *ngIf="!redeemablesLoading && !redeemablesError"
              class="zvcoins-rewards-grid"
            >
              <div
                *ngFor="let redeemable of redeemables"
                class="zvcoins-reward-card"
                [class.zvcoins-affordable]="
                  canAfford(redeemable.price) && isAvailable(redeemable)
                "
                [class.zvcoins-limited-time]="isLimitedTime(redeemable)"
                [class.zvcoins-expired]="isExpired(redeemable)"
                [class.zvcoins-sold-out]="isSoldOut(redeemable)"
              >
                <!-- Limited Time Badge -->
                <div
                  *ngIf="
                    isLimitedTime(redeemable) &&
                    !isExpired(redeemable) &&
                    !isSoldOut(redeemable)
                  "
                  class="zvcoins-limited-badge"
                >
                  â° Limitiert: {{ getTimeLeft(redeemable.redeemableuntil) }}
                </div>

                <!-- Expired Badge -->
                <div
                  *ngIf="isExpired(redeemable)"
                  class="zvcoins-expired-badge"
                >
                  âŒ Nicht mehr verfÃ¼gbar
                </div>

                <!-- Sold Out Badge -->
                <div
                  *ngIf="isSoldOut(redeemable)"
                  class="zvcoins-sold-out-badge"
                >
                  ğŸš« Ausverkauft
                </div>

                <div class="zvcoins-reward-header">
                  <div class="zvcoins-reward-icon-large">
                    {{ redeemable.emoji }}
                  </div>
                  <div class="zvcoins-reward-details">
                    <h5 class="zvcoins-reward-title">
                      {{ redeemable.name }}
                    </h5>
                    <p class="zvcoins-reward-description">
                      {{ redeemable.description }}
                    </p>
                  </div>
                  <div class="zvcoins-reward-price">
                    <span class="zvcoins-price-amount">{{
                      redeemable.price | number: '1.0-0'
                    }}</span>
                    <span class="zvcoins-price-currency">ZVC</span>
                  </div>
                </div>
                <div class="zvcoins-reward-progress">
                  <div class="zvcoins-progress-container">
                    <div class="zvcoins-progress-track">
                      <div
                        class="zvcoins-progress-bar-fill"
                        [style.width.%]="
                          getProgressPercentage(
                            userStatistics.experience || 0,
                            redeemable.price
                          )
                        "
                      ></div>
                    </div>
                    <span class="zvcoins-progress-text">
                      {{
                        getProgressPercentage(
                          userStatistics.experience || 0,
                          redeemable.price
                        ) | number: '1.0-0'
                      }}%
                    </span>
                  </div>
                  <button
                    class="zvcoins-redeem-btn"
                    [disabled]="!canRedeem(redeemable)"
                    [class.zvcoins-redeem-available]="canRedeem(redeemable)"
                    [class.zvcoins-expired]="isExpired(redeemable)"
                    [class.zvcoins-sold-out]="isSoldOut(redeemable)"
                    (click)="redeemItem(redeemable)"
                  >
                    {{ getAvailabilityText(redeemable) }}
                  </button>
                </div>
              </div>

              <!-- No redeemables available message -->
              <div
                *ngIf="redeemables.length === 0"
                class="text-center py-8 col-span-full"
              >
                <div class="text-6xl mb-4">ğŸ</div>
                <p class="text-lg text-gray-300">Keine Belohnungen verfÃ¼gbar</p>
                <p class="text-sm text-gray-400 mt-2">
                  Schau spÃ¤ter wieder vorbei!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Spray Card -->
      <div class="grid-item spray-card-container">
        <div class="stats-card p-6 rounded-2xl auto-height">
          <!-- Help Popup (replaces entire card content when shown) -->
          <div *ngIf="showSprayHelp" class="help-popup h-full">
            <div class="help-content h-full">
              <div class="help-title">
                Custom Spray - Dein persÃ¶nliches Zeichen! ğŸ¨
              </div>
              <div class="help-text">
                Mit einem Custom Spray kannst du dein eigenes Bild als
                persÃ¶nliches Zeichen im Spiel verwenden.
              </div>
              <div class="help-text">
                <strong>Wie funktioniert es?</strong><br />
                â€¢ Lade ein beliebiges Bild oder GIF hoch<br />
                â€¢ PNG/JPG bis 10MB, GIFs bis 2MB (max. 20 Frames)<br />
                â€¢ Das Bild wird automatisch optimiert und ins Spiel
                Ã¼bertragen<br />
                â€¢ Nutze es, um WÃ¤nde oder OberflÃ¤chen zu markieren
              </div>
              <div class="help-text">
                <strong>Tipp:</strong> Einfache Designs und klare Formen
                funktionieren am besten! GIFs werden animiert dargestellt.
              </div>
              <button (click)="showSprayHelp = false" class="help-close-btn">
                Verstanden! âœ¨
              </button>
            </div>
          </div>

          <!-- Regular Card Content -->
          <div *ngIf="!showSprayHelp">
            <h3
              class="text-xl font-bold text-white flex items-center justify-between cardHeader"
            >
              <div class="flex items-center gap-2">
                ğŸ¨ <span>Custom Spray</span>
              </div>
              <button
                (click)="showSprayHelp = true"
                class="help-button"
                title="Hilfe anzeigen"
              >
                ?
              </button>
            </h3>

            <!-- Banned State -->
            <div *ngIf="isSprayBanned" class="fakerank-not-allowed">
              <div class="not-allowed-icon">ğŸš«</div>
              <div class="not-allowed-message">
                <p class="not-allowed-title">Spray-Uploads gesperrt!</p>
                <p class="not-allowed-text">
                  Du wurdest von Spray-Uploads ausgeschlossen.
                  <span *ngIf="sprayBanStatus && sprayBanStatus.banReason">
                    <br /><strong>Grund:</strong>
                    {{ sprayBanStatus.banReason }}
                  </span>
                </p>
                <p
                  class="not-allowed-link"
                  *ngIf="sprayBanStatus && sprayBanStatus.permanent"
                >
                  <strong>Diese Sperre ist permanent.</strong>
                </p>
                <p
                  class="not-allowed-link"
                  *ngIf="sprayBanStatus && !sprayBanStatus.permanent"
                >
                  Kontaktiere die Moderation unter
                  <a href="https://dsc.gg/zeit" style="text-decoration: none"
                    ><strong>dsc.gg/zeit</strong></a
                  >
                  fÃ¼r weitere Informationen.
                </p>
              </div>
            </div>

            <!-- Normal Spray Functionality (only if not banned) -->
            <div *ngIf="!isSprayBanned">
              <!-- Current Spray Display -->
              <div *ngIf="hasSpray" class="current-spray mb-4 text-center">
                <div class="spray-preview-container mx-auto relative">
                  <div class="spray-preview">
                    <img
                      [src]="currentSprayImage"
                      alt="Current Spray"
                      class="spray-image"
                    />
                  </div>
                  <button
                    (click)="removeSpray()"
                    class="remove-spray-button"
                    [disabled]="sprayUploadLoading"
                    title="Spray lÃ¶schen"
                  >
                    Ã—
                  </button>
                </div>
              </div>

              <!-- No Spray State -->
              <div *ngIf="!hasSpray && !selectedFile" class="text-center py-4">
                <div class="text-4xl mb-2">ğŸ¨</div>
                <p class="text-gray-300 text-sm">Kein Spray hochgeladen</p>
              </div>

              <!-- Upload Section with Drag & Drop -->
              <div class="spray-upload">
                <div
                  class="upload-area"
                  [class.has-file]="selectedFile && !sprayUploadLoading"
                  [class.loading]="sprayUploadLoading"
                  [class.drag-over]="isDragOver"
                  (dragover)="onDragOver($event)"
                  (dragleave)="onDragLeave($event)"
                  (drop)="onDrop($event)"
                >
                  <input
                    type="file"
                    id="sprayFileInput"
                    accept="image/png,image/jpeg,image/jpg,image/webp"
                    (change)="onFileSelected($event)"
                    class="file-input"
                  />
                  <label for="sprayFileInput" class="upload-label">
                    <div class="upload-content">
                      <div
                        *ngIf="
                          !sprayUploadLoading &&
                          !selectedFile &&
                          !backgroundRemovalProcessing
                        "
                        class="text-center"
                      >
                        <div class="text-2xl mb-2">ğŸ“</div>
                        <p class="font-medium">Klicken oder hierher ziehen</p>
                        <p class="text-sm opacity-75">PNG, JPG, WEBP</p>
                        <p class="text-xs opacity-60 mt-1" *ngIf="uploadLimits">
                          {{ uploadLimits.message }}
                        </p>
                        <p
                          class="text-xs opacity-60 mt-1"
                          *ngIf="!uploadLimits"
                        >
                          Max: 5MB (Bilder)
                        </p>
                      </div>

                      <!-- Original File Preview -->
                      <div
                        *ngIf="
                          selectedFile &&
                          selectedFilePreview &&
                          !sprayUploadLoading &&
                          !backgroundRemovalProcessing
                        "
                        class="text-center"
                      >
                        <div class="file-preview-container mb-2">
                          <div
                            class="preview-wrapper"
                            [class.bg-removed]="processedImagePreview"
                          >
                            <img
                              [src]="
                                processedImagePreview || selectedFilePreview
                              "
                              alt="Selected Image Preview"
                              class="file-preview-image"
                            />
                            <!-- Subtle glow effect for background removed images -->
                            <div
                              *ngIf="processedImagePreview"
                              class="bg-removed-glow"
                            ></div>
                          </div>
                        </div>
                        <p class="font-medium">{{ selectedFileName }}</p>
                        <div class="preview-status">
                          <p class="text-sm opacity-75">
                            {{
                              processedImagePreview
                                ? 'Bereit zum Upload'
                                : 'Bereit zum Upload'
                            }}
                          </p>
                          <!-- Clean status indicator below the image -->
                          <div
                            *ngIf="processedImagePreview"
                            class="bg-removed-status"
                          >
                            <span class="status-icon">âœ¨</span>
                            <span class="status-text"
                              >Hintergrund entfernt</span
                            >
                          </div>
                        </div>
                        <p
                          *ngIf="removeBackground && !processedImagePreview"
                          class="text-xs mt-1 px-2 py-1 rounded bg-emerald-500/20 text-emerald-300 border border-emerald-500/30"
                        >
                          ğŸª„ Hintergrund wird entfernt
                        </p>
                      </div>

                      <div
                        *ngIf="backgroundRemovalProcessing"
                        class="text-center"
                      >
                        <div class="loading-spinner mx-auto mb-2"></div>
                        <p class="font-medium">Entferne Hintergrund...</p>
                        <p class="text-sm opacity-75">
                          Dies kann einen Moment dauern
                        </p>
                      </div>
                      <div *ngIf="sprayUploadLoading" class="text-center">
                        <div class="loading-spinner mx-auto mb-2"></div>
                        <p class="font-medium">Wird hochgeladen...</p>
                      </div>
                    </div>
                  </label>
                </div>

                <div
                  *ngIf="selectedFile && !sprayUploadLoading"
                  class="upload-actions mt-3"
                >
                  <button
                    (click)="uploadSpray()"
                    class="upload-button"
                    [disabled]="backgroundRemovalProcessing"
                    [class.disabled]="backgroundRemovalProcessing"
                  >
                    {{
                      backgroundRemovalProcessing
                        ? 'Wird verarbeitet...'
                        : 'Hochladen'
                    }}
                  </button>
                  <button (click)="clearAllPreviews()" class="cancel-button">
                    Abbrechen
                  </button>
                </div>
              </div>

              <!-- Background Removal Toggle -->
              <div class="background-removal-toggle mt-4">
                <div class="toggle-container">
                  <div class="toggle-header">
                    <div class="toggle-info">
                      <div class="toggle-icon">ğŸª„</div>
                      <div class="toggle-content">
                        <h4 class="toggle-title">
                          Automatische Hintergrundentfernung
                        </h4>
                        <p class="toggle-description">
                          Entfernt automatisch den Hintergrund mit KI - Ã¼ber
                          unseren Server!
                        </p>
                      </div>
                    </div>
                    <div class="toggle-switch-container">
                      <label class="toggle-switch">
                        <input
                          type="checkbox"
                          [(ngModel)]="removeBackground"
                          [disabled]="
                            sprayUploadLoading || backgroundRemovalProcessing
                          "
                          (change)="onBackgroundRemovalToggle()"
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>

                  <!-- Status indicator -->
                  <div class="toggle-status" [class.active]="removeBackground">
                    <span class="status-indicator"></span>
                    <span class="status-text">
                      {{
                        removeBackground
                          ? 'Aktiviert - Hintergrund wird mit KI entfernt'
                          : 'Deaktiviert - Originalbild wird verwendet'
                      }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Privacy Policy Notice -->
              <div
                class="privacy-warning mt-4 bg-yellow-900/30 border border-yellow-500/50 rounded-lg"
              >
                <!-- Compact Default State -->
                <div
                  *ngIf="!showPrivacyDetails"
                  class="flex items-center gap-3 p-4 md:p-5"
                >
                  <div class="text-yellow-400 text-xl leading-none">âš ï¸</div>
                  <div class="text-sm text-yellow-100 leading-relaxed">
                    <strong>Datenschutzhinweis:</strong>
                    <span
                      class="text-yellow-300 underline decoration-yellow-400/70 hover:text-yellow-200 cursor-pointer ml-1"
                      (click)="showPrivacyDetails = true"
                      >Details anzeigen
                    </span>
                  </div>
                </div>

                <!-- Expanded Privacy Details -->
                <div
                  *ngIf="showPrivacyDetails"
                  id="privacy-details"
                  class="privacy-expanded p-4 md:p-5"
                >
                  <div class="flex items-start gap-3 mb-3">
                    <div class="text-yellow-400 text-xl leading-none">âš ï¸</div>
                    <h4
                      class="text-sm md:text-base font-semibold text-yellow-100 flex-1 cardHeader"
                    >
                      Datenschutzhinweis - Wichtige Informationen
                    </h4>

                    <span
                      class="privacy-close-btn text-yellow-300 hover:text-yellow-200 text-xs md:text-sm cursor-pointer"
                      (click)="showPrivacyDetails = false"
                      title="SchlieÃŸen"
                      role="button"
                      aria-label="Datenschutzhinweis schlieÃŸen"
                      aria-expanded="true"
                      aria-controls="privacy-details"
                    >
                      âœ•
                    </span>
                  </div>

                  <ul
                    class="privacy-list text-sm text-yellow-100 space-y-3 pl-1"
                  >
                    <li class="leading-relaxed">
                      <span class="font-semibold"
                        >Ã–ffentliche VerfÃ¼gbarkeit und DatenÃ¼bertragung:</span
                      >
                      Ihr hochgeladenes Bild wird Ã¶ffentlich zugÃ¤nglich und kann
                      an unseren Discord-Server Ã¼bertragen werden, welcher auf
                      US-amerikanischen Servern auÃŸerhalb unserer direkten
                      Kontrolle gehostet wird. Diese Ãœbertragung erfolgt zur
                      technischen Bereitstellung des Services.
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold"
                        >DatenlÃ¶schung und Persistenz:</span
                      >
                      Eine LÃ¶schung des Bildes durch Sie garantiert nicht die
                      vollstÃ¤ndige und endgÃ¼ltige Entfernung von unseren
                      Systemen, Discord-Servern oder beteiligten Drittsystemen.
                      Kopien kÃ¶nnen in Backups, Caches oder anderen technischen
                      Systemen verbleiben.
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold"
                        >Automatisierte Inhaltsmoderation:</span
                      >
                      Alle hochgeladenen Bilder werden automatisiert mittels
                      OpenAI-Moderation (Modell â€omni-moderation-latestâ€œ)
                      geprÃ¼ft. Dabei kÃ¶nnen Ihre Bilddaten an OpenAI Ã¼bermittelt
                      werden. Die Verarbeitung erfolgt zur Erkennung und
                      Vermeidung unzulÃ¤ssiger Inhalte.
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold"
                        >ModerationsmaÃŸnahmen und Account-Sperrung:</span
                      >
                      Wir behalten uns vor, hochgeladene Bilder jederzeit und
                      ohne VorankÃ¼ndigung zu lÃ¶schen. Bei VerstÃ¶ÃŸen gegen diese
                      Hinweise, gegen gesetzliche Vorgaben oder bei
                      missbrÃ¤uchlicher Nutzung kann Ihr Account ohne vorherige
                      Warnung gesperrt werden.
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold"
                        >Internationale DatenÃ¼bertragung:</span
                      >
                      Durch die Nutzung von Discord-Servern und die Einbindung
                      des OpenAI-Moderationsdienstes kann eine Ãœbertragung Ihrer
                      Daten in die USA und ggf. weitere DrittlÃ¤nder erfolgen, in
                      denen ein anderes Datenschutzniveau als in Deutschland/EU
                      gilt.
                    </li>

                    <li class="leading-relaxed font-semibold p-2 rounded">
                      <span class="font-semibold"
                        >EinverstÃ¤ndniserklÃ¤rung:</span
                      >
                      Durch das Hochladen eines Bildes erklÃ¤ren Sie sich mit den
                      oben genannten Bedingungen einverstanden und bestÃ¤tigen,
                      dass Sie die rechtlichen Konsequenzen verstanden haben.
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Rules Widget -->
              <div
                class="privacy-warning mt-4 bg-yellow-900/30 border border-yellow-500/50 rounded-lg"
              >
                <!-- Compact Default State -->
                <div
                  *ngIf="!showRulesDetails"
                  class="flex items-center gap-3 p-4 md:p-5"
                >
                  <div class="text-yellow-400 text-xl leading-none">ğŸ“‹</div>
                  <div class="text-sm text-yellow-100 leading-relaxed">
                    <strong>Regeln fÃ¼r Inhalte:</strong>
                    <span
                      class="text-yellow-300 underline decoration-yellow-400/70 hover:text-yellow-200 cursor-pointer ml-1"
                      (click)="showRulesDetails = true"
                      >Details anzeigen
                    </span>
                  </div>
                </div>

                <!-- Expanded Rules Details -->
                <div
                  *ngIf="showRulesDetails"
                  id="rules-details"
                  class="privacy-expanded p-4 md:p-5"
                >
                  <div class="flex items-start gap-3 mb-3">
                    <div class="text-yellow-400 text-xl leading-none">ğŸ“‹</div>
                    <h4
                      class="text-sm md:text-base font-semibold text-yellow-100 flex-1 cardHeader"
                    >
                      Inhaltsregeln - Was ist nicht erlaubt
                    </h4>

                    <span
                      class="privacy-close-btn text-yellow-300 hover:text-yellow-200 text-xs md:text-sm cursor-pointer"
                      (click)="showRulesDetails = false"
                      title="SchlieÃŸen"
                      role="button"
                      aria-label="Regeln schlieÃŸen"
                      aria-expanded="true"
                      aria-controls="rules-details"
                    >
                      âœ•
                    </span>
                  </div>

                  <ul
                    class="privacy-list text-sm text-yellow-100 space-y-3 pl-1"
                  >
                    <li class="leading-relaxed">
                      <span class="font-semibold block text-yellow-200"
                        >I. UnzulÃ¤ssige Inhalte:</span
                      >
                      <ul class="pl-4 space-y-2 list-disc">
                        <li>
                          Pornographische, erotische oder sexuelle Inhalte sowie
                          Darstellungen von Nacktheit.
                        </li>
                        <li>
                          Politische Inhalte jeglicher Art, unabhÃ¤ngig von der
                          Ausrichtung.
                        </li>
                        <li>
                          Ausschnitte oder Teilansichten aus verbotenem
                          Material, auch wenn diese keine explizite Darstellung
                          enthalten.
                        </li>
                      </ul>
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold block text-yellow-200"
                        >II. Flaggen:</span
                      >
                      <ul class="pl-4 space-y-2 list-disc">
                        <li>
                          ZulÃ¤ssig sind ausschlieÃŸlich Flaggen existierender
                          Staaten, die von den Vereinten Nationen anerkannt
                          sind.
                        </li>
                        <li>
                          Eigene, selbst entworfene Flaggen sind erlaubt, sofern
                          sie keinen Bezug zu bestehenden Nationen aufweisen.
                        </li>
                      </ul>
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold block text-yellow-200"
                        >III. Kommunikation und Verhalten:</span
                      >
                      <ul class="pl-4 space-y-2 list-disc">
                        <li>
                          HasserfÃ¼llte Aussagen, diskriminierende Ã„uÃŸerungen
                          oder Beleidigungen sind nicht gestattet.
                        </li>
                      </ul>
                    </li>

                    <li class="leading-relaxed">
                      <span class="font-semibold block text-yellow-200"
                        >IV. Abbildungen von Personen:</span
                      >
                      <ul class="pl-4 space-y-2 list-disc">
                        <li>
                          Darstellungen von Kindern oder Jugendlichen sind
                          strikt untersagt.
                        </li>
                        <li>
                          Dies gilt auch fÃ¼r Personen, die minderjÃ¤hrig wirken,
                          selbst wenn sie tatsÃ¤chlich volljÃ¤hrig sind.
                        </li>
                      </ul>
                    </li>

                    <li
                      class="leading-relaxed font-semibold p-2 rounded bg-yellow-800/30"
                    >
                      <span class="font-semibold"
                        >V. Konsequenzen bei VerstÃ¶ÃŸen:</span
                      >
                      Bei Zuwiderhandlungen wird der betreffende Account ohne
                      vorherige AnkÃ¼ndigung gesperrt.
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Messages -->
              <div *ngIf="sprayUploadError" class="error-message mt-3">
                {{ sprayUploadError }}
              </div>
              <div *ngIf="sprayUploadSuccess" class="success-message mt-3">
                Spray erfolgreich hochgeladen!
              </div>
              <div *ngIf="sprayDeleteSuccess" class="success-message mt-3">
                Spray erfolgreich gelÃ¶scht!
              </div>
            </div>
            <!-- End of non-banned functionality -->
          </div>
        </div>
      </div>

      <!-- Fakerank Card -->
      <div class="grid-item fakerank-container">
        <div id="fakerank-card" class="stats-card p-6 rounded-2xl auto-height">
          <!-- Help Popup (replaces entire card content when shown) -->
          <div *ngIf="showFakerankHelp" class="help-popup h-full">
            <div class="help-content h-full">
              <div class="help-title">
                Fakerank - Dein persÃ¶nlicher Spitzname! âœ¨
              </div>
              <div class="help-text">
                Ein Fakerank ist einfach ein cooler Spitzname, den du dir selbst
                geben kannst! Es hat nichts mit deinem echten Rang im Spiel zu
                tun - es ist nur zur Dekoration und macht dein Profil
                persÃ¶nlicher.
              </div>
              <div class="help-text">
                <strong>Wann kannst du es nutzen?</strong><br />
                Jederzeit! Sei kreativ - ob "Pizza Liebhaber", "Sniper Pro" oder
                "Chaos KÃ¶nig" - es ist dein persÃ¶nlicher Touch.
              </div>
              <div class="help-text">
                <strong>Tipp:</strong> WÃ¤hle etwas, das deine PersÃ¶nlichkeit
                oder deinen Spielstil widerspiegelt. Andere Spieler werden es
                sehen kÃ¶nnen!
              </div>
              <button (click)="showFakerankHelp = false" class="help-close-btn">
                Verstanden! âœ¨
              </button>
            </div>
          </div>

          <!-- Regular Card Content -->
          <div *ngIf="!showFakerankHelp">
            <h3
              class="text-xl font-bold text-white mb-4 flex items-center gap-2 justify-between cardHeader"
            >
              <div class="flex items-center gap-2">
                âœ¨ <span>Fakerank</span>
                <!-- Timer Badge -->
                <span
                  *ngIf="fakerankTimeRemaining > 0"
                  class="fakerank-timer-badge"
                >
                  {{ formatTimeRemaining(fakerankTimeRemaining) }}
                </span>
                <!-- Admin Badge -->
                <span
                  *ngIf="fakerankAdminTimeRemaining > 0"
                  class="fakerank-admin-badge"
                >
                  Admin
                </span>
              </div>
              <div class="flex items-center gap-2">
                <button
                  (click)="showFakerankHelp = true"
                  class="help-button"
                  title="Was ist ein Fakerank?"
                >
                  ?
                </button>
              </div>
            </h3>

            <!-- Display Mode -->
            <div *ngIf="!isEditingFakerank" class="fakerank-display">
              <!-- Check if user can edit fakeranks -->
              <div *ngIf="fakerankAllowed">
                <!-- Show override info if user has override (but can still edit) -->
                <div
                  *ngIf="hasFakerankOverride && !isFakerankReadOnly"
                  class="override-info-banner"
                >
                  <div class="override-banner-icon">ğŸ›¡ï¸</div>
                  <div class="override-banner-text">
                    <span class="override-banner-title"
                      >Admin-Override aktiv</span
                    >
                    <span
                      class="override-banner-subtitle"
                      *ngIf="fakerankOverrideTimeRemaining > 0"
                    >
                      Du kannst trotzdem bearbeiten Â· Verbleibt:
                      {{ formatTimeRemaining(fakerankOverrideTimeRemaining) }}
                    </span>
                  </div>
                </div>

                <div class="nickname-container mb-4">
                  <div
                    class="nickname-preview"
                    [class.nickname-empty]="!currentFakerank"
                  >
                    <div *ngIf="currentFakerank" class="nickname-display">
                      <div class="nickname-icon">âœ¨</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Dein Spitzname:</span>
                        <span
                          class="nickname-value"
                          [style.color]="getColorHex(currentFakerankColor)"
                          >{{ currentFakerank }}</span
                        >
                        <div class="nickname-color-info">
                          <span
                            class="color-indicator"
                            [style.background-color]="
                              getColorHex(currentFakerankColor)
                            "
                          ></span>
                          {{ getColorName(currentFakerankColor) }}
                        </div>
                      </div>
                    </div>
                    <div *ngIf="!currentFakerank" class="nickname-empty-state">
                      <div class="nickname-icon">ğŸ’­</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Noch kein Spitzname</span>
                        <span class="nickname-subtitle"
                          >Gib dir einen coolen Namen!</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <div class="fakerank-actions">
                  <button
                    (click)="startEditingFakerank()"
                    class="fakerank-btn fakerank-btn-primary"
                    [disabled]="fakerankLoading"
                  >
                    {{ currentFakerank ? 'âœï¸ Ã„ndern' : 'â• Erstellen' }}
                  </button>
                  <button
                    *ngIf="currentFakerank"
                    (click)="deleteFakerank()"
                    class="fakerank-btn fakerank-btn-danger"
                    [disabled]="fakerankLoading"
                  >
                    ğŸ—‘ï¸ LÃ¶schen
                  </button>
                </div>
              </div>

              <!-- Override fakerank (read-only, set by admin) -->
              <div *ngIf="isFakerankReadOnly" class="fakerank-override">
                <div class="nickname-container mb-4">
                  <div
                    class="nickname-preview"
                    [class.nickname-empty]="!currentFakerank"
                  >
                    <div
                      *ngIf="currentFakerank"
                      class="nickname-display override-display"
                    >
                      <div class="nickname-icon">ğŸ”’</div>
                      <div class="nickname-text">
                        <span class="nickname-label">Admin-Spitzname:</span>
                        <span
                          class="nickname-value"
                          [style.color]="getColorHex(currentFakerankColor)"
                          >{{ currentFakerank }}</span
                        >
                      </div>
                      <div class="override-badge">
                        <span class="override-text">Override</span>
                        <span
                          class="override-timer"
                          *ngIf="fakerankOverrideTimeRemaining > 0"
                        >
                          {{
                            formatTimeRemaining(fakerankOverrideTimeRemaining)
                          }}
                        </span>
                      </div>
                    </div>
                    <div
                      *ngIf="!currentFakerank"
                      class="nickname-empty-display"
                    >
                      <div class="nickname-icon">ğŸ”’</div>
                      <span class="nickname-placeholder"
                        >Admin kann dir einen Spitzname zuweisen</span
                      >
                    </div>
                  </div>
                </div>

                <div class="override-info">
                  <div class="override-icon">ğŸ›¡ï¸</div>
                  <div class="override-message">
                    <p class="override-title">Admin-Override aktiv</p>
                    <p class="override-text">
                      Dein Spitzname wurde von einem Admin gesetzt und kann
                      nicht bearbeitet werden.
                      <span *ngIf="fakerankOverrideTimeRemaining > 0">
                        Verbleibt:
                        <strong>{{
                          formatTimeRemaining(fakerankOverrideTimeRemaining)
                        }}</strong>
                      </span>
                    </p>
                  </div>
                </div>
              </div>

              <!-- Not allowed message -->
              <div *ngIf="!fakerankAllowed" class="fakerank-not-allowed">
                <div class="not-allowed-icon">ğŸ”’</div>
                <div class="not-allowed-message">
                  <p class="not-allowed-title">Noch nicht freigeschaltet!</p>
                  <p class="not-allowed-text">
                    Du bist noch nicht fÃ¼r diese Zeitvertreib-Funktion
                    freigeschaltet! Du kannst entweder den Discord-Server
                    <strong>boosten</strong>, Ã¼ber
                    <strong style="white-space: nowrap">ko-fi.com</strong>
                    spenden oder durch sehr aktives Spielen auf dem SCP-Server
                    <strong>VIP</strong> werden.
                  </p>
                  <p class="not-allowed-link">
                    Tritt dem Discord unter
                    <a href="https://dsc.gg/zeit" style="text-decoration: none"
                      ><strong>dsc.gg/zeit</strong></a
                    >
                    bei fÃ¼r weitere Informationen.
                  </p>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div
              *ngIf="isEditingFakerank && fakerankAllowed"
              class="fakerank-edit"
            >
              <div class="nickname-editor mb-4">
                <label class="editor-label"> âœ¨ Dein neuer Spitzname </label>
                <div class="fakerank-input-container">
                  <input
                    type="text"
                    [(ngModel)]="fakerankValue"
                    placeholder="z.B. Pizza Liebhaber, Sniper Pro, Chaos KÃ¶nig..."
                    maxlength="50"
                    class="nickname-input"
                    [disabled]="fakerankLoading"
                    [style.color]="getColorHex(tempFakerankColor)"
                    (keydown)="onKeyDown($event)"
                    (keyup.enter)="saveFakerank()"
                    (keyup.escape)="cancelEditingFakerank()"
                  />
                  <div class="fakerank-char-count">
                    {{ fakerankValue.length }}/50
                  </div>
                </div>

                <!-- Color Picker Section -->
                <div class="color-picker-section mt-3">
                  <label class="editor-label">ğŸ¨ Farbe wÃ¤hlen</label>
                  <div class="color-picker-container">
                    <button
                      (click)="toggleColorPicker()"
                      class="color-selector-button"
                      [disabled]="fakerankLoading"
                    >
                      <span
                        class="color-indicator"
                        [style.background-color]="
                          getColorHex(tempFakerankColor)
                        "
                      ></span>
                      {{ getColorName(tempFakerankColor) }}
                      <span class="dropdown-arrow">{{
                        showColorPicker ? 'â–²' : 'â–¼'
                      }}</span>
                    </button>

                    <div *ngIf="showColorPicker" class="color-picker-dropdown">
                      <div class="color-options">
                        <button
                          *ngFor="let color of fakerankColors"
                          (click)="selectColor(color.key)"
                          class="color-option"
                          [class.selected]="tempFakerankColor === color.key"
                        >
                          <span
                            class="color-indicator"
                            [style.background-color]="color.hex"
                          ></span>
                          <span class="color-name">{{ color.name }}</span>
                          <span
                            *ngIf="tempFakerankColor === color.key"
                            class="selected-check"
                            >âœ“</span
                          >
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="editor-hint">
                  ğŸ’¡ Sei kreativ! Dies ist nur ein Spitzname zur Dekoration.
                </div>
              </div>
              <div class="fakerank-actions">
                <button
                  (click)="saveFakerank()"
                  class="fakerank-btn fakerank-btn-success"
                  [disabled]="
                    fakerankLoading || fakerankValue.trim().length === 0
                  "
                >
                  {{ fakerankLoading ? 'ğŸ’¾ Speichern...' : 'ğŸ’¾ Speichern' }}
                </button>
                <button
                  (click)="cancelEditingFakerank()"
                  class="fakerank-btn fakerank-btn-secondary"
                  [disabled]="fakerankLoading"
                >
                  âŒ Abbrechen
                </button>
              </div>
            </div>

            <!-- Success Message -->
            <div
              *ngIf="fakerankSuccess"
              class="fakerank-message fakerank-success mt-3"
            >
              ğŸ‰ Spitzname erfolgreich gespeichert!
            </div>

            <!-- Error Message -->
            <div
              *ngIf="fakerankError"
              class="fakerank-message fakerank-error mt-3"
            >
              {{ fakerankError }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
